<!doctype html>
<meta charset="utf-8">
<title>数刘徽模拟器</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="stylesheet" href="css/head.css">
<style>
  body{margin:0;font-family:"Microsoft YaHei";background:#fff;color:#000;text-align:center;padding:40px}
  #piBox{display:inline-block;font-size:36px;font-family:monospace;letter-spacing:4px}
  #piFirst{
    color:#d00;
    border:2px solid #000;
    padding:4px 8px;
    display:inline-block; 
  }
  #piRest{color:#000}
  #log{margin-top:20px;height:100px;overflow-y:auto;text-align:left;display:inline-block;width:400px;border:1px solid #666;padding:10px;background:#fff;color:#000}
</style>
<section class="hero-section">
			<h1 class="hero-title">数刘徽模拟器</h1>
			<div class="nav-buttons">
				<button class="nav-button"><a href="index.html">返回新版主页</a></button>
				<button class="nav-button"><a href="indexjd.html">返回经典版主页</a></button>
			</div>
			<h3 class="hero-title">请尽量使用Windows系统以获得最优的体验效果</h3>
			<h3 class="hero-title">该页面可以脱离head.css独立运行</h3>
			<h3 class="hero-title">该页面使用接口的方式实现π的动态计算，理论可达到小数点后31.4万亿位</h3>
			<h4 class="hero-title">你能玩坏了算我输（滑稽）</h4>
		</section>
<div class="header-placeholder"></div>
<div><span id="piBox"><span id="piFirst">1</span><span id="piRest">415</span></span></div>
<div id="posInfo" style="margin-top:10px;font-size:18px;color:#666;">
  当前：小数点后第 <span id="posNum">1</span> 位数
</div>
<div>
  <button id="skill">割圆</button>
  <button id="back">重差</button>
  <button id="end">回合结束</button>
  <button id="reset">重置游戏</button>
</div>
<div id="log"></div>
<footer class="site-footer">
		<div class="author-info">
			<p>
				作者： <a href="https://space.bilibili.com/87412647?spm_id_from=333.1007.0.0"
					target="_blank">bilibili月が綺麗ですね_</a><br />
				联系方式：<a href="mailto:3099637681@qq.com" target="_blank">3099637681@qq.com（QQ同号）</a><br />
				有什么新功能或建议欢迎骚扰（著名来意）<br />
				<a href="https://1145141919810tonny.github.io/sgsmoniqi/" target="_blank">点击此处使用GitHub Pages在线服务</a>
			</p>
		</div>
		<div class="code-update">
			<a href="https://www.bilibili.com/read/readlist/rl929858?spm_id_from=333.1387.0.0" target="_blank"
				class="bili-btn" rel="noopener noreferrer">
				[bilibili]获取更新动态
			</a>
			<a href="https://github.com/1145141919810TONNY/sgsmoniqi/" target="_blank" class="github-btn"
				rel="noopener noreferrer">
				[GitHub]获取后续代码更新
			</a>
			<a href="https://gitcode.com/TONNY114514/sgsmnq?source_module=search_project" target="_blank"
				class="gitcode-btn" rel="noopener noreferrer">
				[GitCode]获取V7.8.3.62镜像文件
			</a>
		</div>
		<div class="license-notice">
			<p>
				Copyright &copy; <span id="copyright-year">2025</span> bilibili 月が綺麗ですね_<br />
				Released under the
				<a href="MIT LICENSE.html" title="查看MIT许可证" class="license-link" target="_blank">
					MIT License
				</a>
			</p>
			<p class="i18n-annotation">
				(法律条款以英文版<a href="MIT LICENSE.html" target="_blank">LICENSE</a>文件为准)
			</p>
		</div>
	</footer>
<script>
let piStr = '', pos = 1, step = 1000;
async function fetchSegment(start){
  const r = await fetch(`https://api.pi.delivery/v1/pi?start=${start}&numberOfDigits=${step}`);
  return (await r.json()).content;
}
async function ensurePiSegment(needPos){
  while(piStr.length < needPos + 4) piStr += await fetchSegment(pos + piStr.length);
}
let roundTriggerCnt = 0, backUsedThisTurn = false;
const $first = document.getElementById('piFirst');
const $rest  = document.getElementById('piRest');
const $log   = document.getElementById('log');
const $skill = document.getElementById('skill');
const $back  = document.getElementById('back');
const $end   = document.getElementById('end');
const $reset = document.getElementById('reset');
function log(msg){
  $log.insertAdjacentHTML('beforeend',`<div>${msg}</div>`);
  $log.scrollTop = 1e9;
}
function render(){
  const s = piStr.slice(pos-1, pos+3);
  $first.textContent = s[0];
  $rest.textContent  = s.slice(1);
  document.getElementById('posNum').textContent = pos;
}
$skill.onclick = async () => {
  await ensurePiSegment(pos+4);
  pos++;
  roundTriggerCnt = Math.min(roundTriggerCnt+1, 3);
  render();
  log(`技能触发！π 后移 1 位，本回合已触发割圆 ${roundTriggerCnt} 次 → 摸 ${roundTriggerCnt} 张牌`);
};
$back.onclick = async () => {
  if(backUsedThisTurn) return;
  await ensurePiSegment(pos+4);
  pos++;
  render();
  backUsedThisTurn = true; $back.disabled = true;
  log('触发技能“重差”，位数往后移 1 位（不触发摸牌）');
};
$end.onclick = () => {
  roundTriggerCnt = 0; backUsedThisTurn = false; $back.disabled = false;
  log('回合结束，触发次数清零，【重差】次数刷新');
};
$reset.onclick = () => {
  pos = 1; roundTriggerCnt = 0; backUsedThisTurn = false; $back.disabled = false;
  render(); $log.innerHTML = ''; log('=== 游戏重置 ===');
};
(async ()=>{ await ensurePiSegment(5); render(); log('游戏开始，初始显示 1415'); })();
			function updateHeaderPlaceholder() {
				const header = document.querySelector('.header');
				const placeholder = document.querySelector('.header-placeholder');
				if (header && placeholder) {
					const height = header.offsetHeight + 5;
					placeholder.style.height = `${height}px`;
				}
			}
			window.addEventListener('DOMContentLoaded', updateHeaderPlaceholder);
			window.addEventListener('resize', updateHeaderPlaceholder);
</script>

<!DOCTYPE html>
<!-- æ–‡æ¡£ç±»å‹å£°æ˜ï¼šæŒ‡å®šä¸ºHTML5æ–‡æ¡£ -->
<html lang="en">
	<!-- HTMLæ–‡æ¡£æ ¹å…ƒç´ ï¼Œlangå±æ€§æŒ‡å®šæ–‡æ¡£è¯­è¨€ä¸ºè‹±è¯­ -->
	<head>
		<!-- æ–‡æ¡£å¤´éƒ¨ï¼šåŒ…å«å…ƒæ•°æ®ã€è„šæœ¬å’Œæ ·å¼è¡¨ -->
		<meta charset="UTF-8">
		<!-- å­—ç¬¦ç¼–ç å£°æ˜ï¼šæŒ‡å®šæ–‡æ¡£ä½¿ç”¨UTF-8ç¼–ç ï¼Œæ”¯æŒå¤šè¯­è¨€å­—ç¬¦ -->
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<!-- è§†å£è®¾ç½®ï¼šç¡®ä¿é¡µé¢åœ¨ä¸åŒè®¾å¤‡ä¸Šæ­£ç¡®ç¼©æ”¾å’Œæ˜¾ç¤º -->
		<script src="js/card.js"></script>
		<!-- å¼•å…¥æœ¬åœ°JavaScriptæ–‡ä»¶ï¼šåŒ…å«å¡ç‰Œç›¸å…³é€»è¾‘ -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
		<!-- å¼•å…¥CryptoJSåº“ï¼šæä¾›åŠ å¯†åŠŸèƒ½ï¼ˆMD5/AESï¼‰ -->
		<title>æ²®çˆ¹çº¢åˆ©æœŸæ¨¡æ‹Ÿå™¨</title>
		<!-- é¡µé¢æ ‡é¢˜ï¼šæ˜¾ç¤ºåœ¨æµè§ˆå™¨æ ‡ç­¾é¡µä¸Š -->
		<link rel="stylesheet" href="css/head.css">
		<!-- å¼•å…¥å¤–éƒ¨CSSæ–‡ä»¶ï¼šå®šä¹‰é¡µé¢æ ·å¼ -->
	</head>
	<body>
		<!-- é¡µé¢ä¸»ä½“å†…å®¹ -->
		<div class="header">
			<!-- é¡¶éƒ¨æ“ä½œæ å®¹å™¨ -->
			<p>æ“ä½œå°</p>
			<!-- æ“ä½œå°æ ‡é¢˜ -->
			<button id="reloadButton" style="margin-left: 15px; background-color: #ff4444; color: white;">
				å¼ºåˆ¶åˆ·æ–°ï¼ˆQï¼‰
				<!-- å¼ºåˆ¶åˆ·æ–°æŒ‰é’®ï¼ˆå¿«æ·é”®Qï¼‰ -->
			</button>
			<button id="draw1Button">å‘1å¼ ç‰Œï¼ˆ1ï¼‰</button>
			<!-- å‘1å¼ ç‰ŒæŒ‰é’®ï¼ˆå¿«æ·é”®1ï¼‰ -->
			<button id="draw2Button">å‘2å¼ ç‰Œï¼ˆ2ï¼‰</button>
			<!-- å‘2å¼ ç‰ŒæŒ‰é’®ï¼ˆå¿«æ·é”®2ï¼‰ -->
			<button id="draw3Button">å‘3å¼ ç‰Œï¼ˆ3ï¼‰</button>
			<!-- å‘3å¼ ç‰ŒæŒ‰é’®ï¼ˆå¿«æ·é”®3ï¼‰ -->
			<button id="draw4Button">å‘4å¼ ç‰Œï¼ˆ4ï¼‰</button>
			<!-- å‘4å¼ ç‰ŒæŒ‰é’®ï¼ˆå¿«æ·é”®4ï¼‰ -->
			<button id="revealButton">æŸ¥çœ‹å‰©ä½™ç‰Œå †ï¼ˆWï¼‰</button>
			<!-- æŸ¥çœ‹ç‰Œå †æŒ‰é’®ï¼ˆå¿«æ·é”®Wï¼‰ -->
			<button id="highlightButton">é«˜äº®è¯¸è‘›è¿å¼©ï¼ˆEï¼‰</button>
			<!-- é«˜äº®æ­¦å™¨æŒ‰é’®ï¼ˆå¿«æ·é”®Eï¼‰ -->
			<button id="shuffleButton">é‡æ–°æ´—ç‰Œï¼ˆRï¼‰</button>
			<!-- æ´—ç‰ŒæŒ‰é’®ï¼ˆå¿«æ·é”®Rï¼‰ -->
			<button id="reshuffleBtn" disabled>ä½¿ç”¨è„šæ°”å¡ï¼ˆTï¼‰</button>
			<!-- è„šæ°”å¡æŒ‰é’®ï¼ˆåˆå§‹ç¦ç”¨ï¼Œå¿«æ·é”®Tï¼‰ -->
			<button id="drawBtn">è¿›å…¥æ‘¸ç‰Œé˜¶æ®µï¼ˆAï¼‰</button>
			<!-- æ‘¸ç‰Œé˜¶æ®µæŒ‰é’®ï¼ˆå¿«æ·é”®Aï¼‰ -->
			<button id="playBtn" disabled>è¿›å…¥å‡ºç‰Œé˜¶æ®µï¼ˆSï¼‰</button>
			<!-- å‡ºç‰Œé˜¶æ®µæŒ‰é’®ï¼ˆåˆå§‹ç¦ç”¨ï¼Œå¿«æ·é”®Sï¼‰ -->
			<button id="endPlayBtn" disabled>ç»“æŸå‡ºç‰Œé˜¶æ®µï¼ˆDï¼‰</button>
			<!-- ç»“æŸå‡ºç‰ŒæŒ‰é’®ï¼ˆåˆå§‹ç¦ç”¨ï¼Œå¿«æ·é”®Dï¼‰ -->
			<button id="testCardBtn">æµ‹è¯•åŠŸèƒ½ï¼šæ·»åŠ æŒ‡å®šç‰Œ</button>
			<!-- æµ‹è¯•åŠŸèƒ½æŒ‰é’® -->
			<button id="testUniformBtn">æ´—ç‰Œå‡åŒ€æ€§æµ‹è¯•</button>
			<!-- æ´—ç‰Œæµ‹è¯•æŒ‰é’® -->
		</div>
		<div class="header-placeholder"></div>
		<!-- å ä½å…ƒç´ ï¼šç¡®ä¿å†…å®¹ä¸è¢«é¡¶éƒ¨æ“ä½œæ é®æŒ¡ -->
		<section class="hero-section">
			<h1 class="hero-title">æ²®çˆ¹çº¢åˆ©æœŸæ¨¡æ‹Ÿå™¨çº¯éšæœºç‰ˆ</h1>
			<!-- ä¸»æ ‡é¢˜ï¼šæ˜¾ç¤ºåº”ç”¨åç§°å’Œç‰ˆæœ¬ -->
			<div class="tooltip-container">
				<!-- å¯¼èˆªæŒ‰é’®å®¹å™¨ -->
				<div class="nav-buttons">
					<button class="nav-button"><a href="index.html">è¿”å›ä¸»é¡µ</a></button>
					<!-- ä¸»é¡µå¯¼èˆªæŒ‰é’® -->
					<button class="nav-button"><a href="versionjs.html">è·³è½¬åˆ°æ›´æ–°æ—¥å¿—</a></button>
					<!-- æ›´æ–°æ—¥å¿—å¯¼èˆªæŒ‰é’® -->
					<button class="nav-button"><a href="OSjushou.html">è¿›å…¥æ²®çˆ¹æ¨¡æ‹Ÿå™¨å¼€æºæ•™å­¦ç½‘é¡µ</a></button>
					<!--æ•™å­¦ç½‘é¡µå¯¼èˆªæŒ‰é’®-->
				</div>
			</div>

			<button id="backToTopBtn">å›åˆ°é¡¶éƒ¨</button>
			<h3 class="hero-title">
				<!-- ä½¿ç”¨è¯´æ˜ -->
				è¯´æ˜ï¼š<br />
				1.æœ¬ä»£ç çš„ç‰Œå †æ˜¯çœŸæ­£çš„çº¯éšæœºï¼Œä¸“æ²»å„ç§å˜´ç¡¬<br />
				<!-- æ¢è¡Œï¼šå¼ºè°ƒç‰Œå †éšæœºæ€§ -->
				2.è¯·å…ˆæŸ¥çœ‹å‰©ä½™ç‰Œå †ï¼Œå†ç‚¹é«˜äº®akã€‚<br />
				<!-- æ“ä½œæç¤ºï¼šæŸ¥çœ‹ç‰Œå †åå†é«˜äº®æ­¦å™¨ -->
				3.ç”±äºæ˜¯çº¯éšæœºåºåˆ—ï¼Œæœ‰ä¸€å¤§å †æ€é—ªæ‰å †å±äºæ­£å¸¸ç°è±¡ï¼ˆæ­å–œä½ åˆ·åˆ°äº†æ²™æ‘©æŸ¯çš„ç‰Œå †ï¼ˆbushiï¼‰ï¼‰ï¼Œä¸æƒ³çœ‹åˆ°æ­¤ç±»æƒ…å†µçš„ï¼Œé‡æ–°æ´—ç‰Œå³å¯<br />
				<!-- è§£é‡Šéšæœºç°è±¡åŠè§£å†³æ–¹æ³• -->
				4.åˆ·æ–°æŒ‰é’®å¯åœ¨ç½‘é¡µæœ‰ä¸å¯é€†çš„bugæ—¶å°†ç½‘é¡µæ¢å¤åˆ°åˆå§‹çŠ¶æ€
				<!-- åˆ·æ–°æŒ‰é’®çš„åŠŸèƒ½è¯´æ˜ -->
			</h3>
		</section>

		<h2>å®‰å…¨æ ¡éªŒåŒºMD5/AESç¼–ç 
			<button id="toggleMD5AES" style="font-size: 12px; padding: 2px 5px;">â–¼ æ”¶èµ·</button>
			<!-- å®‰å…¨åŒºåŸŸæ ‡é¢˜å’ŒæŠ˜å æŒ‰é’® -->
		</h2>
		<div id="md5aes-container">
			<!-- åŠ å¯†ä¿¡æ¯å®¹å™¨ -->
			<div class="md5-panel">
				<!-- MD5é¢æ¿ -->
				<div class="md5-display">
					<div id="md5Value">â€‹**â€‹*â€‹**â€‹*</div>
					<!-- MD5å€¼æ˜¾ç¤ºåŒºåŸŸï¼ˆåˆå§‹éšè—ï¼‰ -->
					<div class="md5-buttons">
						<button id="toggleMD5" class="md5-button">æ˜¾ç¤ºMD5</button>
						<!-- åˆ‡æ¢MD5æ˜¾ç¤ºçŠ¶æ€çš„æŒ‰é’® -->
						<button id="copyMD5" class="md5-button">å¤åˆ¶</button>
						<!-- å¤åˆ¶MD5çš„æŒ‰é’® -->
					</div>
				</div>
				<p class="md5-caption">è¯¥æ ‡è¯†ç¬¦åŸºäºå½“å‰ç‰Œå †ç”Ÿæˆï¼Œç”¨äºéªŒè¯ç‰Œå †å”¯ä¸€æ€§</p>
				<!-- MD5åŠŸèƒ½è¯´æ˜ -->
				<div class="verify-panel">
					<!-- éªŒè¯é¢æ¿ -->
					<input type="text" id="verifyMD5" placeholder="è¾“å…¥MD5éªŒè¯ç‰Œå †" class="verify-input">
					<!-- MD5è¾“å…¥æ¡† -->
					<button onclick="verifyDeck()" class="md5-button">éªŒè¯</button>
					<!-- è§¦å‘éªŒè¯çš„æŒ‰é’® -->
					<span id="verifyResult" class="verify-result"></span>
					<!-- éªŒè¯ç»“æœæ˜¾ç¤ºåŒºåŸŸ -->
				</div>
			</div>
			<div class="aes-panel">
				<!-- AESé¢æ¿ -->
				<div class="md5-display">
					<div id="aesValue" class="aes-value">â€‹**â€‹*â€‹**â€‹*</div>
					<!-- AESå€¼æ˜¾ç¤ºåŒºåŸŸï¼ˆåˆå§‹éšè—ï¼‰ -->
					<div class="md5-buttons">
						<button id="toggleAES" class="md5-button">æ˜¾ç¤ºAES</button>
						<!-- åˆ‡æ¢AESæ˜¾ç¤ºçŠ¶æ€çš„æŒ‰é’® -->
						<button id="copyAES" class="md5-button">å¤åˆ¶</button>
						<!-- å¤åˆ¶AESçš„æŒ‰é’® -->
					</div>
				</div>
				<p class="aes-caption">åŒ…å«å¯†é’¥çš„AESç¼–ç ï¼Œå¯åå‘è§£æç‰Œå †</p>
				<!-- AESåŠŸèƒ½è¯´æ˜ -->
				<div class="verify-panel">
					<!-- éªŒè¯é¢æ¿ -->
					<input type="text" id="verifyAES" placeholder="è¾“å…¥AESç¼–ç éªŒè¯ç‰Œå †" class="verify-input">
					<!-- AESè¾“å…¥æ¡† -->
					<button onclick="verifyAESDeck()" class="md5-button">è§£å¯†éªŒè¯</button>
					<!-- è§¦å‘éªŒè¯çš„æŒ‰é’® -->
					<span id="verifyAESResult" class="verify-result"></span>
					<!-- éªŒè¯ç»“æœæ˜¾ç¤ºåŒºåŸŸ -->
				</div>
				<div class="log-panel">
					<button id="exportLog" class="md5-button log-button">
						ğŸ“„ ç”Ÿæˆå®‰å…¨æ—¥å¿—æ–‡ä»¶
						<!-- æ—¥å¿—å¯¼å‡ºæŒ‰é’® -->
					</button>
				</div>
			</div>
		</div>
		<h2>è®°ç‰Œå™¨
			<button id="toggleCounter" style="font-size: 12px; padding: 2px 5px;">â–¼ æ”¶èµ·</button>
			<!-- è®°ç‰Œå™¨æ ‡é¢˜å’ŒæŠ˜å æŒ‰é’® -->
		</h2>
		<div id="remaining-counts"></div>
		<!-- è®°ç‰Œå™¨å†…å®¹åŒºåŸŸï¼ˆåŠ¨æ€ç”Ÿæˆï¼‰ -->
		<h3>çŠ¶æ€ä¿¡æ¯</h3>
		<!-- çŠ¶æ€ä¿¡æ¯æ ‡é¢˜ -->
		<div id="status-area">
			<!-- çŠ¶æ€ä¿¡æ¯å®¹å™¨ -->
			<div id="kill-counter">æ€å¯ç”¨æ¬¡æ•°ï¼š2</div>
			<!-- æ€ç‰Œè®¡æ•°æ˜¾ç¤º -->
			<div id="zhuge-status">è¯¸è‘›è¿å¼©ï¼šæœªè£…å¤‡</div>
			<!-- æ­¦å™¨çŠ¶æ€æ˜¾ç¤º -->
			<div id="peach-counter">æ¡ƒå¯ç”¨æ¬¡æ•°ï¼š1</div>
			<!-- æ¡ƒç‰Œè®¡æ•°æ˜¾ç¤º -->
			<div id="wine-counter">é…’å¯ç”¨æ¬¡æ•°ï¼š1</div>
			<!-- é…’ç‰Œè®¡æ•°æ˜¾ç¤º -->
			<div id="delay-area">
				<div class="delay-section">
					<h4>å…µç²®å¯¸æ–­</h4>
					<div id="bingliang-container" class="delay-cards"></div>
				</div>
				<div class="delay-section">
					<h4>ä¹ä¸æ€èœ€</h4>
					<div id="lebu-container" class="delay-cards"></div>
				</div>
				<div class="delay-section">
				    <h4>é—ªç”µ</h4>
				    <div id="shandian-container" class="delay-cards"></div>
				</div>
			</div>
		</div>
		<div id="testProgress" style="display:none;">
			<!-- æµ‹è¯•è¿›åº¦æ¡ï¼ˆé»˜è®¤éšè—ï¼‰ -->
			<progress value="0" max="100"></progress>
			<!-- HTML5è¿›åº¦æ¡å…ƒç´  -->
			<span>0%</span>
			<!-- è¿›åº¦ç™¾åˆ†æ¯”æ˜¾ç¤º -->
		</div>
		<div id="deck"></div>
		<!-- ç‰Œå †æ˜¾ç¤ºåŒºåŸŸ -->
		<div id="remaining"></div>
		<!-- å‰©ä½™ç‰Œå †æ˜¾ç¤ºåŒºåŸŸ -->
		<div id="hand"></div>
		<!-- ç©å®¶æ‰‹ç‰Œæ˜¾ç¤ºåŒºåŸŸ -->
		<h3>æ“ä½œæ—¥å¿—</h3>
		<!-- æ—¥å¿—åŒºåŸŸæ ‡é¢˜ -->
		<div id="log-container">
			<!-- æ—¥å¿—å®¹å™¨ -->
			<div id="log"></div>
			<!-- æ—¥å¿—å†…å®¹åŒºåŸŸï¼ˆåŠ¨æ€å¡«å……ï¼‰ -->
		</div>
		<div id="stageInfo" class="phase"></div>
		<!-- æ¸¸æˆé˜¶æ®µä¿¡æ¯æ˜¾ç¤ºåŒºåŸŸ -->
		<script>
			// å®šä¹‰æ¸¸æˆçŠ¶æ€å˜é‡
			let deck = []; // å­˜å‚¨å½“å‰ç‰Œå †çš„æ•°ç»„
			let drawnCards = []; // å­˜å‚¨å·²æŠ½å–å¡ç‰Œçš„æ•°ç»„
			let discardPile = []; // å­˜å‚¨å¼ƒç‰Œå †çš„æ•°ç»„
			let hand = []; // å­˜å‚¨ç©å®¶æ‰‹ç‰Œçš„æ•°ç»„
			let phase = ''; // å½“å‰æ¸¸æˆé˜¶æ®µï¼ˆå‡†å¤‡/æ‘¸ç‰Œ/å‡ºç‰Œï¼‰
			let lastUsedCard = null; // ä¸Šä¸€æ¬¡ä½¿ç”¨çš„å¡ç‰Œå¯¹è±¡
			let reshuffleUsed = 0; // è„šæ°”å¡ä½¿ç”¨æ¬¡æ•°è®¡æ•°å™¨
			const MAX_RESHUFLE = 7; // è„šæ°”å¡æœ€å¤§ä½¿ç”¨æ¬¡æ•°é™åˆ¶
			let currentMD5 = ''; // å½“å‰ç‰Œå †çš„MD5å“ˆå¸Œå€¼
			let showMD5 = false; // æ§åˆ¶MD5å€¼æ˜¯å¦æ˜¾ç¤ºçš„æ ‡å¿—
			let currentAES = ''; // å½“å‰ç‰Œå †çš„AESåŠ å¯†å€¼
			let showAES = false; // æ§åˆ¶AESå€¼æ˜¯å¦æ˜¾ç¤ºçš„æ ‡å¿—
			let originalDeck = []; // åŸå§‹ç‰Œå †å¤‡ä»½ï¼ˆæœªä½¿ç”¨ï¼‰
			let isCounterCollapsed = false; // è®°ç‰Œå™¨æ˜¯å¦æŠ˜å çš„æ ‡å¿—
			let isMD5AESCollapsed = false; // å®‰å…¨æ ¡éªŒåŒºæ˜¯å¦æŠ˜å çš„æ ‡å¿—
			let killCount = 2; // å¯ç”¨çš„"æ€"æ¬¡æ•°
			let hasZhugeLianNu = false; // æ˜¯å¦è£…å¤‡è¯¸è‘›è¿å¼©çš„æ ‡å¿—
			let currentWeapon = null; // å½“å‰è£…å¤‡çš„æ­¦å™¨
			let peachCount = 1; // å¯ç”¨çš„"æ¡ƒ"æ¬¡æ•°
			let wineCount = 1; // å¯ç”¨çš„"é…’"æ¬¡æ•°

			let bingliangArea = []; // å…µç²®å¯¸æ–­å­˜æ”¾åŒº
			let lebuArea = []; // ä¹ä¸æ€èœ€å­˜æ”¾åŒº
			const MAX_DELAY_CARDS = 2; // æ¯ç§ç‰Œä¸Šé™2å¼ 
			
			let shandianArea = []; // é—ªç”µå­˜æ”¾åŒº
			const MAX_SHANDIAN = 1; // é—ªç”µä¸Šé™1å¼ 

			// åˆå§‹åŒ–ç‰Œå †å‡½æ•°
			function initializeDeck() {
				// æ¸…ç©ºæ“ä½œæ—¥å¿—
				document.getElementById('log').innerHTML = '';
				log("ç‰Œå †åˆå§‹åŒ–å¼€å§‹");

				// é‡ç½®æ‰€æœ‰ç‰Œå †ç›¸å…³å˜é‡
				deck = [];
				drawnCards = [];
				discardPile = [];
				hand = [];
				document.getElementById('deck').innerHTML = ''; // æ¸…ç©ºç‰Œå †æ˜¾ç¤ºåŒºåŸŸ
				reshuffleUsed = 0; // é‡ç½®è„šæ°”å¡ä½¿ç”¨æ¬¡æ•°
				phase = ''; // é‡ç½®æ¸¸æˆé˜¶æ®µ
				lastUsedCard = null; // é‡ç½®æœ€åä½¿ç”¨çš„å¡ç‰Œ
				peachCount = 1; // é‡ç½®æ¡ƒä½¿ç”¨æ¬¡æ•°
				wineCount = 1; // é‡ç½®é…’ä½¿ç”¨æ¬¡æ•°
				
				// é‡ç½®å»¶æ—¶é”¦å›ŠåŒº
				    bingliangArea = [];
				    lebuArea = [];

				// ä½¿ç”¨å¤–éƒ¨å®šä¹‰çš„standardDeckï¼ˆåœ¨card.jsä¸­ï¼‰åˆ›å»ºç‰Œå †
				standardDeck.forEach(card => {
					// å¤„ç†æ¯å¼ å¡ç‰Œçš„èŠ±è‰²å’Œç‚¹æ•°
					card.suits.forEach(suitStr => {
						// ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è§£æèŠ±è‰²å’Œç‚¹æ•°
						const match = suitStr.match(/^([â™ â™¥â™£â™¦]ï¸?)([JQKA]|\d+)$/);
						if (match) {
							const suitPart = match[1]; // æå–èŠ±è‰²éƒ¨åˆ†
							let point = match[2]; // æå–ç‚¹æ•°éƒ¨åˆ†

							// å°†å­—æ¯ç‚¹æ•°è½¬æ¢ä¸ºæ•°å­—
							switch (point) {
								case 'J':
									point = 11;
									break;
								case 'Q':
									point = 12;
									break;
								case 'K':
									point = 13;
									break;
								case 'A':
									point = 1;
									break;
								default:
									point = parseInt(point, 10); // æ•°å­—ç‚¹æ•°ç›´æ¥è½¬æ¢ä¸ºæ•´æ•°
							}

							// æ ¹æ®å¡ç‰Œæ•°é‡åˆ›å»ºå¤šä¸ªå‰¯æœ¬
							for (let i = 0; i < card.count; i++) {
								// åˆ›å»ºå¡ç‰Œå¯¹è±¡å¹¶æ·»åŠ åˆ°ç‰Œå †
								deck.push({
									name: card.name, // å¡ç‰Œåç§°
									suit: suitPart, // èŠ±è‰²
									point: point, // ç‚¹æ•°
									uid: CryptoJS.lib.WordArray.random(16).toString() // å”¯ä¸€ID
								});
							}
						}
					});
				});

				// é‡ç½®æ­¦å™¨å’Œæ”»å‡»çŠ¶æ€
				currentWeapon = null;
				killCount = 2;
				hasZhugeLianNu = false;

				// é‡ç½®å»¶æ—¶é”¦å›ŠåŒº
				bingliangArea = [];
				lebuArea = [];
				shandianArea = [];

				// æ›´æ–°çŠ¶æ€æ˜¾ç¤º
				updateStatus();
				// æ´—ç‰Œ
				shuffleDeck();
				// ç”Ÿæˆç‰Œå †MD5
				generateDeckMD5();
				// æ›´æ–°MD5æ˜¾ç¤º
				updateMD5Display();
				// ç”Ÿæˆç‰Œå †AES
				generateDeckAES();
				// æ›´æ–°AESæ˜¾ç¤º
				updateAESDisplay();
				// æ›´æ–°å‰©ä½™ç‰Œæ•°æ˜¾ç¤º
				updateRemaining();
				// å¼€å§‹æ¸¸æˆ
				startGame();
				log("ç‰Œå †åˆå§‹åŒ–å®Œæˆ");
			}

			// å°†å¡ç‰Œç‚¹æ•°è½¬æ¢ä¸ºæ˜¾ç¤ºæ ¼å¼çš„å‡½æ•°
			function getPointDisplay(point) {
				switch (point) {
					case 11:
						return 'J'; // 11ç‚¹æ˜¾ç¤ºä¸ºJ
					case 12:
						return 'Q'; // 12ç‚¹æ˜¾ç¤ºä¸ºQ
					case 13:
						return 'K'; // 13ç‚¹æ˜¾ç¤ºä¸ºK
					case 1:
						return 'A'; // 1ç‚¹æ˜¾ç¤ºä¸ºA
					default:
						return point; // å…¶ä»–ç‚¹æ•°ç›´æ¥æ˜¾ç¤ºæ•°å­—
				}
			}

			// ç”Ÿæˆç‰Œå †çš„MD5å“ˆå¸Œå€¼
			function generateDeckMD5() {
				// å°†ç‰Œå †æŒ‰å¡ç‰ŒUIDæ’åºï¼Œç¡®ä¿é¡ºåºä¸€è‡´
				const deckString = deck
					.sort((a, b) => a.uid.localeCompare(b.uid))
					// å°†æ¯å¼ å¡ç‰Œè½¬æ¢ä¸ºå­—ç¬¦ä¸²æ ¼å¼ï¼šåç§°|èŠ±è‰²|ç‚¹æ•°|UID
					.map(c => `${c.name}|${c.suit}|${c.point}|${c.uid}`)
					// ç”¨"@@"è¿æ¥æ‰€æœ‰å¡ç‰Œå­—ç¬¦ä¸²
					.join('@@');

				// ç”Ÿæˆç‰Œå †å­—ç¬¦ä¸²çš„MD5å“ˆå¸Œï¼ˆç¬¬ä¸€æ¬¡å“ˆå¸Œï¼‰
				const firstHash = CryptoJS.MD5(deckString).toString();

				// è·å–å½“å‰æ—¶é—´æˆ³å¹¶è½¬æ¢ä¸º16è¿›åˆ¶å­—ç¬¦ä¸²ï¼ˆå¡«å……åˆ°16ä½ï¼‰
				const timestamp = Date.now().toString(16).padStart(16, '0');

				// å°†ç¬¬ä¸€æ¬¡å“ˆå¸Œç»“æœä¸æ—¶é—´æˆ³ç»“åˆï¼Œç”Ÿæˆæœ€ç»ˆçš„MD5å€¼
				currentMD5 = CryptoJS.MD5(firstHash + timestamp).toString();

				// æ£€æŸ¥URLå‚æ•°ä¸­æ˜¯å¦æœ‰debugæ ‡å¿—
				const isDebug = new URLSearchParams(window.location.search).has('debug');

				// è°ƒè¯•æ¨¡å¼ä¸‹ä½¿ç”¨åŸå§‹å“ˆå¸Œï¼ˆä¸å«æ—¶é—´æˆ³ï¼‰ï¼Œå¦åˆ™ä½¿ç”¨å¸¦æ—¶é—´æˆ³çš„å“ˆå¸Œ
				currentMD5 = isDebug ? firstHash : CryptoJS.MD5(firstHash + timestamp).toString();

				// åœ¨è°ƒè¯•æ¨¡å¼ä¸‹è¾“å‡ºåŸå§‹å“ˆå¸Œå€¼
				if (isDebug) console.log("è°ƒè¯•æ¨¡å¼MD5ï¼ˆä¸å«æ—¶é—´æˆ³ï¼‰:", currentMD5);
			}

			// å­˜å‚¨ç‰Œå †å¿«ç…§çš„å¯¹è±¡
			const deckSnapshots = {};

			// ä¿å­˜å½“å‰ç‰Œå †å¿«ç…§
			function saveSnapshot() {
				// åˆ›å»ºç‰Œå †å¿«ç…§å¯¹è±¡
				const snapshot = {
					deck: deck.map(c => ({
						...c
					})), // åˆ›å»ºç‰Œå †çš„æ·±æ‹·è´
					md5: currentMD5, // å½“å‰MD5å€¼
					timestamp: Date.now() // å½“å‰æ—¶é—´æˆ³
				};

				// ä»¥MD5ä¸ºé”®å­˜å‚¨å¿«ç…§
				deckSnapshots[currentMD5] = snapshot;

				// å°†å¿«ç…§ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
				localStorage.setItem('md5Snapshots', JSON.stringify(deckSnapshots));

				// è®°å½•æ—¥å¿—
				log(`ç‰Œå †å¿«ç…§å·²ä¿å­˜ (MD5: ${currentMD5})`);
			}

			// åŠ è½½æŒ‡å®šMD5å¯¹åº”çš„ç‰Œå †å¿«ç…§
			function loadSnapshot(targetMD5) {
				// è·å–å¯¹åº”MD5çš„å¿«ç…§
				const snapshot = deckSnapshots[targetMD5];

				// å¦‚æœæ²¡æœ‰æ‰¾åˆ°å¿«ç…§åˆ™æç¤ºç”¨æˆ·
				if (!snapshot) return alert("æ— æ­¤ç‰Œå †è®°å½•");

				// æ¢å¤ç‰Œå †çŠ¶æ€
				deck = snapshot.deck;
				currentMD5 = snapshot.md5;

				// æ›´æ–°ç”¨æˆ·ç•Œé¢
				updateUI();

				// è®°å½•æ—¥å¿—
				log(`å·²åŠ è½½ç‰Œå †å¿«ç…§ (MD5: ${targetMD5})`);
			}

			// æ›´æ–°MD5å€¼çš„æ˜¾ç¤º
			function updateMD5Display() {
				const display = document.getElementById('md5Value');
				if (showMD5) {
					// æ ¼å¼åŒ–MD5å€¼ï¼šæ¯4ä¸ªå­—ç¬¦åŠ ä¸€ä¸ªè¿å­—ç¬¦
					const formatted = currentMD5
						.match(/.{1,4}/g) // å°†å­—ç¬¦ä¸²åˆ†å‰²ä¸ºæ¯4ä¸ªå­—ç¬¦ä¸€ç»„
						.join('-') // ç”¨è¿å­—ç¬¦è¿æ¥å„ç»„
						.toUpperCase(); // è½¬æ¢ä¸ºå¤§å†™

					// æ˜¾ç¤ºæ ¼å¼åŒ–åçš„MD5å€¼
					display.textContent = formatted;
					display.style.color = '#2196F3'; // è®¾ç½®è“è‰²æ–‡æœ¬
				} else {
					// éšè—MD5å€¼ï¼Œæ˜¾ç¤ºæ˜Ÿå·
					display.textContent = 'â€‹**â€‹*â€‹**â€‹*';
					display.style.color = '#666'; // è®¾ç½®ç°è‰²æ–‡æœ¬
				}
			}

			// ä¸º"æ˜¾ç¤º/éšè—MD5"æŒ‰é’®æ·»åŠ ç‚¹å‡»äº‹ä»¶
			document.getElementById('toggleMD5').addEventListener('click', () => {
				// åˆ‡æ¢æ˜¾ç¤ºçŠ¶æ€
				showMD5 = !showMD5;

				// æ›´æ–°æŒ‰é’®æ–‡æœ¬
				document.getElementById('toggleMD5').textContent =
					showMD5 ? 'éšè—MD5' : 'æ˜¾ç¤ºMD5';

				// æ›´æ–°æ˜¾ç¤ºå†…å®¹
				updateMD5Display();
			});

			// ä¸º"å¤åˆ¶MD5"æŒ‰é’®æ·»åŠ ç‚¹å‡»äº‹ä»¶
			document.getElementById('copyMD5').addEventListener('click', () => {
				// å¦‚æœæ²¡æœ‰MD5å€¼åˆ™ç›´æ¥è¿”å›
				if (!currentMD5) return;

				// å®šä¹‰å¤åˆ¶å‡½æ•°
				const copy = async () => {
					try {
						// å°è¯•ä½¿ç”¨ç°ä»£å‰ªè´´æ¿API
						await navigator.clipboard.writeText(currentMD5);

						// æ·»åŠ å¤åˆ¶æˆåŠŸçš„è§†è§‰åé¦ˆ
						document.getElementById('copyMD5').classList.add('copied');

						// 1ç§’åç§»é™¤è§†è§‰åé¦ˆ
						setTimeout(() => {
							document.getElementById('copyMD5').classList.remove('copied');
						}, 1000);

						// è®°å½•æ—¥å¿—
						log('MD5å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
					} catch (err) {
						// ç°ä»£APIå¤±è´¥æ—¶ä½¿ç”¨ä¼ ç»Ÿæ–¹æ³•
						const textarea = document.createElement('textarea');
						textarea.value = currentMD5;
						document.body.appendChild(textarea);
						textarea.select();
						document.execCommand('copy');
						document.body.removeChild(textarea);
						log('MD5å·²å¤åˆ¶ï¼ˆä¼ ç»Ÿæ–¹å¼ï¼‰');
					}
				};

				// æ‰§è¡Œå¤åˆ¶å¹¶å¤„ç†å¯èƒ½çš„é”™è¯¯
				copy().catch(err => {
					console.error('å¤åˆ¶å¤±è´¥:', err);
					log('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©å¤åˆ¶');
				});
			});

			// éªŒè¯ç”¨æˆ·è¾“å…¥çš„MD5å€¼
			function verifyDeck() {
				// è·å–ç”¨æˆ·è¾“å…¥çš„MD5å€¼å¹¶æ¸…ç†æ ¼å¼
				const inputMD5 = document.getElementById('verifyMD5').value
					.replace(/-/g, '') // ç§»é™¤è¿å­—ç¬¦
					.toLowerCase(); // è½¬æ¢ä¸ºå°å†™

				// ä¸å½“å‰MD5æ¯”è¾ƒ
				const isValid = currentMD5 === inputMD5;

				// è·å–ç»“æœæ˜¾ç¤ºå…ƒç´ 
				const resultSpan = document.getElementById('verifyResult');

				// è®¾ç½®éªŒè¯ç»“æœæ–‡æœ¬å’Œé¢œè‰²
				resultSpan.textContent = isValid ? 'âœ… éªŒè¯é€šè¿‡' : 'âŒ éªŒè¯å¤±è´¥';
				resultSpan.style.color = isValid ? '#4CAF50' : '#f44336'; // ç»¿è‰²/çº¢è‰²

				// è®°å½•æ—¥å¿—
				log(`ç‰Œå †MD5éªŒè¯${isValid ? 'æˆåŠŸ' : 'å¤±è´¥'}`);
			}

			// ç”Ÿæˆç‰Œå †çš„AESåŠ å¯†è¡¨ç¤º
			function generateDeckAES() {
				try {
					// ç®€åŒ–ç‰Œå †æ•°æ®ç»“æ„ï¼ˆå‡å°‘JSONå¤§å°ï¼‰
					const deckData = deck.map(c => ({
						n: c.name, // å¡ç‰Œåç§°ï¼ˆç¼©å†™ï¼‰
						s: c.suit, // èŠ±è‰²
						p: c.point, // ç‚¹æ•°
						u: c.uid // å”¯ä¸€IDï¼ˆç¼©å†™ï¼‰
					}));

					// ç”Ÿæˆéšæœºå¯†é’¥ï¼ˆ128ä½ï¼‰
					const key = CryptoJS.lib.WordArray.random(128 / 8);

					// ç”Ÿæˆéšæœºåˆå§‹åŒ–å‘é‡ï¼ˆ128ä½ï¼‰
					const iv = CryptoJS.lib.WordArray.random(128 / 8);

					// ä½¿ç”¨AES-CBCæ¨¡å¼åŠ å¯†ç‰Œå †æ•°æ®
					const encrypted = CryptoJS.AES.encrypt(
						JSON.stringify(deckData), // è¦åŠ å¯†çš„å­—ç¬¦ä¸²åŒ–ç‰Œå †æ•°æ®
						key, // åŠ å¯†å¯†é’¥
						{
							iv: iv
						} // åˆå§‹åŒ–å‘é‡
					);

					// æ„å»ºAESç¼–ç ï¼šå¯†é’¥::åˆå§‹åŒ–å‘é‡::åŠ å¯†æ•°æ®
					currentAES = [
						key.toString(CryptoJS.enc.Base64), // Base64ç¼–ç çš„å¯†é’¥
						iv.toString(CryptoJS.enc.Base64), // Base64ç¼–ç çš„åˆå§‹åŒ–å‘é‡
						encrypted.toString() // åŠ å¯†åçš„å­—ç¬¦ä¸²
					].join('::');
				} catch (e) {
					// é”™è¯¯å¤„ç†ï¼šè¾“å‡ºé”™è¯¯å¹¶è®¾ç½®é”™è¯¯æ ‡è¯†
					console.error('AESç”Ÿæˆå¤±è´¥:', e);
					currentAES = 'ERROR';
				}
			}

			// æ›´æ–°AESå€¼çš„æ˜¾ç¤º
			function updateAESDisplay() {
				const display = document.getElementById('aesValue');
				if (!display) return; // å®‰å…¨æ£€æŸ¥ï¼šç¡®ä¿å…ƒç´ å­˜åœ¨

				if (showAES) {
					// æ ¼å¼åŒ–æ˜¾ç¤ºï¼šæ¯24ä¸ªå­—ç¬¦æ¢è¡Œ
					const formatted = currentAES
						.match(/.{1,24}/g) // å°†å­—ç¬¦ä¸²åˆ†å‰²æˆæœ€å¤š24å­—ç¬¦çš„ç‰‡æ®µ
						.join('\n'); // ç”¨æ¢è¡Œç¬¦è¿æ¥

					// æ˜¾ç¤ºæ ¼å¼åŒ–åçš„AESå€¼
					display.textContent = formatted;
					display.style.color = '#2196F3'; // è®¾ç½®è“è‰²æ–‡æœ¬
				} else {
					// éšè—AESå€¼ï¼Œæ˜¾ç¤ºæ˜Ÿå·
					display.textContent = 'â€‹**â€‹*â€‹**â€‹*';
					display.style.color = '#666'; // è®¾ç½®ç°è‰²æ–‡æœ¬
				}
			}

			// ä¸º"æ˜¾ç¤º/éšè—AES"æŒ‰é’®æ·»åŠ ç‚¹å‡»äº‹ä»¶
			document.getElementById('toggleAES').addEventListener('click', () => {
				// åˆ‡æ¢æ˜¾ç¤ºçŠ¶æ€
				showAES = !showAES;

				// æ›´æ–°æŒ‰é’®æ–‡æœ¬
				document.getElementById('toggleAES').textContent =
					showAES ? 'éšè—AES' : 'æ˜¾ç¤ºAES';

				// æ›´æ–°æ˜¾ç¤ºå†…å®¹
				updateAESDisplay();
			});

			// ä¸º"å¤åˆ¶AES"æŒ‰é’®æ·»åŠ ç‚¹å‡»äº‹ä»¶
			document.getElementById('copyAES').addEventListener('click', () => {
				// æ£€æŸ¥AESå€¼æ˜¯å¦æœ‰æ•ˆ
				if (!currentAES || currentAES === 'â€‹**â€‹*â€‹**â€‹*') return;

				// å®šä¹‰å¤åˆ¶å‡½æ•°
				const copy = async () => {
					try {
						// å°è¯•ä½¿ç”¨ç°ä»£å‰ªè´´æ¿API
						await navigator.clipboard.writeText(currentAES);

						// æ·»åŠ å¤åˆ¶æˆåŠŸçš„è§†è§‰åé¦ˆ
						document.getElementById('copyAES').classList.add('copied');

						// 1ç§’åç§»é™¤è§†è§‰åé¦ˆ
						setTimeout(() => {
							document.getElementById('copyAES').classList.remove('copied');
						}, 1000);

						// è®°å½•æ—¥å¿—
						log('AESç¼–ç å·²å¤åˆ¶');
					} catch (err) {
						// ç°ä»£APIå¤±è´¥æ—¶ä½¿ç”¨ä¼ ç»Ÿæ–¹æ³•
						const textarea = document.createElement('textarea');
						textarea.value = currentAES;
						document.body.appendChild(textarea);
						textarea.select();
						document.execCommand('copy');
						document.body.removeChild(textarea);
						log('AESç¼–ç å·²å¤åˆ¶ï¼ˆä¼ ç»Ÿæ–¹å¼ï¼‰');
					}
				};

				// æ‰§è¡Œå¤åˆ¶å¹¶å¤„ç†å¯èƒ½çš„é”™è¯¯
				copy().catch(err => {
					console.error('å¤åˆ¶å¤±è´¥:', err);
					log('AESå¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©å¤åˆ¶');
				});
			});

			// éªŒè¯å¹¶è§£å¯†ç”¨æˆ·è¾“å…¥çš„AESç¼–ç 
			function verifyAESDeck() {
				// è·å–ç”¨æˆ·è¾“å…¥çš„AESç¼–ç 
				const input = document.getElementById('verifyAES').value.trim();
				const resultSpan = document.getElementById('verifyAESResult');

				// æ£€æŸ¥è¾“å…¥æ˜¯å¦ä¸ºç©º
				if (!input) {
					resultSpan.textContent = 'âŒ è¯·è¾“å…¥ç¼–ç ';
					resultSpan.style.color = '#f44336'; // çº¢è‰²é”™è¯¯æç¤º
					return;
				}

				try {
					// åˆ†å‰²è¾“å…¥ï¼šæ ¼å¼åº”ä¸º å¯†é’¥::åˆå§‹åŒ–å‘é‡::åŠ å¯†æ•°æ®
					const [keyB64, ivB64, data] = input.split('::');

					// éªŒè¯æ ¼å¼æ˜¯å¦æ­£ç¡®
					if (!keyB64 || !ivB64 || !data) throw new Error('æ ¼å¼æ— æ•ˆ');

					// ä»Base64è§£æå¯†é’¥å’Œåˆå§‹åŒ–å‘é‡
					const key = CryptoJS.enc.Base64.parse(keyB64);
					const iv = CryptoJS.enc.Base64.parse(ivB64);

					// ä½¿ç”¨AESè§£å¯†æ•°æ®
					const decrypted = CryptoJS.AES.decrypt(data, key, {
						iv: iv
					});

					// å°†è§£å¯†ç»“æœè½¬æ¢ä¸ºUTF-8å­—ç¬¦ä¸²
					const utf8String = decrypted.toString(CryptoJS.enc.Utf8);

					// æ£€æŸ¥è§£å¯†æ˜¯å¦æˆåŠŸ
					if (!utf8String) throw new Error('è§£å¯†å¤±è´¥');

					// è§£æè§£å¯†åçš„JSONæ•°æ®
					const decoded = JSON.parse(utf8String);

					// é‡å»ºç‰Œå †æ•°æ®ç»“æ„
					deck = decoded.map(c => ({
						name: c.n, // æ¢å¤å¡ç‰Œåç§°
						suit: c.s, // æ¢å¤èŠ±è‰²
						point: c.p, // æ¢å¤ç‚¹æ•°
						uid: c.u // æ¢å¤å”¯ä¸€ID
					}));

					// æ›´æ–°ç›¸å…³çŠ¶æ€å’Œæ˜¾ç¤º
					generateDeckMD5(); // é‡æ–°ç”ŸæˆMD5
					updateMD5Display(); // æ›´æ–°MD5æ˜¾ç¤º
					updateRemaining(); // æ›´æ–°å‰©ä½™ç‰Œæ•°
					revealDeck(); // æ˜¾ç¤ºç‰Œå †

					// è®°å½•æ—¥å¿—
					log('AESè§£ç æˆåŠŸï¼Œç‰Œå †å·²åŠ è½½');

					// æ˜¾ç¤ºéªŒè¯æˆåŠŸ
					resultSpan.textContent = 'âœ… éªŒè¯é€šè¿‡';
					resultSpan.style.color = '#4CAF50'; // ç»¿è‰²æˆåŠŸæç¤º
				} catch (e) {
					// é”™è¯¯å¤„ç†
					console.error('AESéªŒè¯å¤±è´¥:', e);
					resultSpan.textContent = 'âŒ æ— æ•ˆç¼–ç ';
					resultSpan.style.color = '#f44336'; // çº¢è‰²é”™è¯¯æç¤º
					log('AESè§£ç å¤±è´¥: ' + e.message);
				}
			}
			// ç”Ÿæˆå®‰å…¨çš„éšæœºç´¢å¼•ï¼ˆç”¨äºæŠ½ç‰Œï¼‰
			function getSecureRandomIndex(max) {
				// æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦æ”¯æŒåŠ å¯†å®‰å…¨çš„éšæœºæ•°ç”Ÿæˆå™¨
				if (window.crypto && typeof window.crypto.getRandomValues === 'function') {
					// åˆ›å»ºä¸€ä¸ªUint32Arrayæ¥å­˜å‚¨éšæœºå€¼
					const randomBuffer = new Uint32Array(1);

					// ä½¿ç”¨åŠ å¯†å®‰å…¨æ–¹æ³•å¡«å……éšæœºå€¼
					window.crypto.getRandomValues(randomBuffer);

					// è¿”å›0åˆ°maxä¹‹é—´çš„éšæœºç´¢å¼•
					return randomBuffer[0] % (max + 1);
				} else {
					// æµè§ˆå™¨ä¸æ”¯æŒå®‰å…¨éšæœºæ•°æ—¶ä½¿ç”¨Math.random
					return Math.floor(Math.random() * (max + 1));
				}
			}

			// æ‰§è¡Œæ´—ç‰Œå‡åŒ€æ€§æµ‹è¯•
			async function testShuffleUniformity() {
				// æµ‹è¯•é…ç½®
				const CONFIG = {
					TOTAL_TRIALS: 100000, // æ€»æµ‹è¯•æ¬¡æ•°
					BATCH_SIZE: 5000, // æ¯æ‰¹æµ‹è¯•æ¬¡æ•°
					DECK_SIZE: 160, // ç‰Œå †å¤§å°
					AK_COUNT: 2, // è¯¸è‘›è¿å¼©(AK)æ•°é‡
					CHECK_SIZE: 7 // æ£€æŸ¥å‰å‡ å¼ ç‰Œ
				};

				// åˆ›å»ºæ¨¡æ€èƒŒæ™¯
				const backdrop = document.createElement('div');
				backdrop.style.cssText = `
					position: fixed;
					top: 0;
					left: 0;
					right: 0;
					bottom: 0;
					background: rgba(0,0,0,0.5);
					z-index: 9998;
					backdrop-filter: blur(3px);
				`;

				// åˆ›å»ºæµ‹è¯•é¢æ¿
				const panel = document.createElement('div');
				panel.className = 'scrollable-panel';
				panel.style.cssText = `
					position: fixed;
					top: 50%;
					left: 50%;
					transform: translate(-50%, -50%);
					background: white;
					padding: 25px;
					border-radius: 12px;
					box-shadow: 0 4px 20px rgba(0,0,0,0.25);
					z-index: 9999;
					width: 80%;
					max-width: 800px;
					max-height: 90vh;
					overflow-y: auto;
					font-family: Arial, sans-serif;
				`;

				// é¢æ¿å†…å®¹HTML
				panel.innerHTML = `
					<div style="position: relative; margin-bottom: 20px;">
						<h2 style="margin:0 0 10px; color:#333; font-size:20px;">æ´—ç‰Œå‡åŒ€æ€§æµ‹è¯•</h2>
						<div style="position: absolute; top: -15px; right: -15px; display: flex; gap: 5px;">
							<button id="rerunTest" style="padding: 8px 20px; background: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer;">
								é‡æ–°æµ‹è¯• â–¶
							</button>
							<button id="closePanel" style="padding: 8px 20px; background: #f44336; color: white; border: none; border-radius: 4px; cursor: pointer;">
								å…³é—­çª—å£ Ã—
							</button>
						</div>
					</div>
					<div style="display:grid; grid-template-columns:1fr 1fr; gap:15px; margin-bottom:15px;">
						<div>
							<h3 style="font-size:14px; color:#666; margin:0 0 8px;">å®é™…ç»“æœ</h3>
							<p>â‰¥1å¼ AKï¼š <span id="actualSingle">0</span></p>
							<p>â‰¥2å¼ AKï¼š <span id="actualDouble">0</span></p>
						</div>
						<div>
							<h3 style="font-size:14px; color:#666; margin:0 0 8px;">ç†è®ºå‚è€ƒ</h3>
							<p>â‰ˆ8.51% (å•AK)</p>
							<p>â‰ˆ0.165% (åŒAK)</p>
						</div>
					</div>
					<div style="margin-top:20px; padding:15px; background:#f8f9fa; border-radius:6px;">
						<!-- å•AKè®¡ç®—å…¬å¼ -->
						<div style="margin-bottom:25px;">
							<h4 style="color:#444; margin:0 0 8px; font-size:14px;">1. è‡³å°‘1å¼ è¯¸è‘›è¿å¼©ï¼ˆâ‰ˆ8.56%ï¼‰</h4>
							<div style="font-family:monospace; font-size:14px;">
								<p style="margin:6px 0">N=160ï¼ˆæ€»ç‰Œæ•°ï¼‰</p>
								<p style="margin:6px 0">K=2ï¼ˆè¯¸è‘›è¿å¼©æ•°é‡ï¼‰</p>
								<p style="margin:6px 0">n=7ï¼ˆæŠ½ç‰Œæ•°ï¼‰</p>
								<p style="margin:4px 0;">P(â‰¥1) = 1 - [C(158,7) / C(160,7)]</p>
								<p style="margin:4px 0; color:#666;">      = 1 - 158ï¼/ ï¼ˆ7ï¼* 151ï¼ï¼‰/ 160ï¼/ï¼ˆ7ï¼ 8 153ï¼ï¼‰</p>
								<p style="margin:4px 0; color:#666;">      = 1 - (158Ã—157) / (160Ã—159)</p>
								<p style="margin:4px 0; color:#2196F3;">      â‰ˆ 8.51%</p>
							</div>
						</div>
						<!-- åŒAKè®¡ç®—å…¬å¼ -->
						<div style="margin-bottom:25px;">
							<h4 style="color:#444; margin:0 0 8px; font-size:14px;">2. è‡³å°‘2å¼ è¯¸è‘›è¿å¼©ï¼ˆâ‰ˆ0.165%ï¼‰</h4>
							<div style="font-family:monospace; font-size:14px;">
								<div style="margin-bottom:8px;">
									<p style="margin:4px 0;">è®¡ç®—å…¬å¼</p>
									<p style="margin:4px 0;">P (â‰¥2) = C ( K , 2 ) * C( N - K , n - 2) / C(N , n)</p>
									<p style="margin:4px 0;">P (=2) = C ( 2 , 2 ) * C( 158 , 5 ) / C (160 , 7)</P>
									<p style="margin:4px 0;">       = (1 * 158! / 5! * 153! ) / 160! / 7! * 153!</p>
									<p style="margin:4px 0;">P(â‰¥2) = [C(2,2)Â·C(158,5)] / C(160,7)</p>
									<p style="margin:4px 0; color:#666;">      = [1 Ã— (158Ã—157Ã—156Ã—155Ã—154)]</p>
									<p style="margin:4px 0; color:#666;">      / [160Ã—159Ã—158Ã—157Ã—156Ã—155Ã—154]</p>
								</div>
								<div style="border-left:3px solid #ddd; padding-left:12px; color:#666;">
									<p style="margin:4px 0;">åˆ†å­åŒ–ç®€ï¼š7Ã—6=42</p>
									<p style="margin:4px 0;">åˆ†æ¯åŒ–ç®€ï¼š160Ã—159=25,440</p>
									<p style="margin:4px 0; color:#2196F3;">æœ€ç»ˆâ‰ˆ42/25,440â‰ˆ0.165%</p>
								</div>
							</div>
						</div>
					</div>
					<progress value="0" max="${CONFIG.TOTAL_TRIALS}" style="width:100%; height:8px; margin:15px 0;"></progress>
					<div id="akStats" style="color:#666; font-size:14px;"></div>
				`;

				// æ·»åŠ é¢æ¿åˆ°æ–‡æ¡£
				document.body.appendChild(backdrop);
				document.body.appendChild(panel);

				// æ·»åŠ æ»šåŠ¨æ¡æ ·å¼
				panel.style.cssText += `
					::-webkit-scrollbar { width: 12px; }
					::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
					::-webkit-scrollbar-thumb { background: #4CAF50; border-radius: 10px; }
					::-webkit-scrollbar-thumb:hover { background: #3e8e41; }
				`;

				// åˆå§‹åŒ–æµ‹è¯•çŠ¶æ€å˜é‡
				let isClosing = false;
				let stats = {
					single: 0,
					double: 0
				};
				let completed = 0;

				// å…³é—­é¢æ¿å‡½æ•°
				const closePanel = () => {
					if (isClosing) return;
					isClosing = true;

					// æ·»åŠ æ·¡å‡ºåŠ¨ç”»
					panel.style.transition = 'opacity 0.3s, transform 0.3s';
					panel.style.opacity = '0';
					panel.style.transform = 'translate(-50%, -50%) scale(0.9)';

					backdrop.style.transition = 'opacity 0.3s';
					backdrop.style.opacity = '0';

					// å»¶è¿Ÿç§»é™¤å…ƒç´ 
					setTimeout(() => {
						document.body.removeChild(backdrop);
						document.body.removeChild(panel);
					}, 300);
				};

				// æ·»åŠ å…³é—­å’Œé‡æ–°æµ‹è¯•æŒ‰é’®äº‹ä»¶
				panel.querySelector('#closePanel').addEventListener('click', closePanel);
				panel.querySelector('#rerunTest').addEventListener('click', () => {
					closePanel();
					testShuffleUniformity();
				});

				// ç”Ÿæˆæµ‹è¯•ç‰Œå †ï¼ˆåŒ…å«AKæ ‡è®°ï¼‰
				const generateTestDeck = () =>
					Array.from({
						length: CONFIG.DECK_SIZE
					}, (_, i) => ({
						isAK: i < CONFIG.AK_COUNT, // å‰ä¸¤å¼ ç‰Œæ ‡è®°ä¸ºAK
						id: i // å”¯ä¸€æ ‡è¯†ç¬¦
					}));

				// è¿è¡Œä¸€æ‰¹æµ‹è¯•
				const runBatch = async () => {
					for (let i = 0; i < CONFIG.BATCH_SIZE; i++) {
						if (isClosing) return;

						// ç”Ÿæˆæµ‹è¯•ç‰Œå †
						const deck = generateTestDeck();

						// Fisher-Yatesæ´—ç‰Œç®—æ³•
						for (let j = deck.length - 1; j > 0; j--) {
							const k = Math.floor(Math.random() * (j + 1));
							[deck[j], deck[k]] = [deck[k], deck[j]];
						}

						// æ£€æŸ¥å‰CHECK_SIZEå¼ ç‰Œä¸­AKçš„æ•°é‡
						const akCount = deck.slice(0, CONFIG.CHECK_SIZE)
							.filter(c => c.isAK).length;

						// æ›´æ–°ç»Ÿè®¡
						if (akCount >= 1) stats.single++;
						if (akCount >= 2) stats.double++;
					}

					// æ›´æ–°å®Œæˆæ•°é‡
					completed += CONFIG.BATCH_SIZE;

					// æ›´æ–°è¿›åº¦æ¡
					panel.querySelector('progress').value = completed;

					// æ›´æ–°ç»Ÿè®¡æ˜¾ç¤º
					panel.querySelector('#actualSingle').textContent =
						`${stats.single} (${(stats.single / completed * 100).toFixed(2)}%)`;
					panel.querySelector('#actualDouble').textContent =
						`${stats.double} (${(stats.double / completed * 100).toFixed(2)}%)`;

					// æ›´æ–°ç»Ÿè®¡é¢æ¿
					panel.querySelector('#akStats').innerHTML = `
						<p>å·²æµ‹è¯•ï¼š${completed.toLocaleString()} æ¬¡</p>
						<p>å•AKæ¦‚ç‡ï¼š${(stats.single / completed * 100).toFixed(2)}%</p>
						<p>åŒAKæ¦‚ç‡ï¼š${(stats.double / completed * 100).toFixed(2)}%</p>
					`;
				};

				try {
					// è®°å½•å¼€å§‹æ—¶é—´
					const startTime = performance.now();

					// è¿è¡Œæµ‹è¯•ç›´åˆ°å®Œæˆæˆ–å…³é—­
					while (completed < CONFIG.TOTAL_TRIALS && !isClosing) {
						await new Promise(resolve =>
							requestAnimationFrame(async () => {
								await runBatch();
								resolve();
							})
						);
					}

					// æµ‹è¯•å®Œæˆä¸”é¢æ¿æœªå…³é—­
					if (!isClosing) {
						// è®¡ç®—æ€»è€—æ—¶
						const totalTime = ((performance.now() - startTime) / 1000).toFixed(1);

						// æ·»åŠ æœ€ç»ˆç»Ÿè®¡
						panel.querySelector('#akStats').innerHTML += `
							<div style="margin-top:15px; padding-top:15px; border-top:1px solid #eee;">
								<p>æ€»è€—æ—¶ï¼š${totalTime} ç§’</p>
								<p>æµ‹è¯•ç‰Œå †ï¼š${CONFIG.DECK_SIZE}å¼ ï¼ˆå«${CONFIG.AK_COUNT}AKï¼‰</p>
							</div>
						`;
					}
				} catch (error) {
					// é”™è¯¯å¤„ç†
					console.error('æµ‹è¯•å‡ºé”™:', error);
					panel.querySelector('#akStats').innerHTML = `
						<div style="color: red;">
							<h3>æµ‹è¯•å¤±è´¥</h3>
							<p>${error.message}</p>
						</div>
					`;
				}
			}


			// æ˜¾ç¤ºæ€§èƒ½è­¦å‘Šå¼¹çª—
			function showPerformanceWarning() {
				// è¿”å›ä¸€ä¸ªPromiseï¼Œç”¨äºå¤„ç†ç”¨æˆ·é€‰æ‹©
				return new Promise((resolve) => {
					// åˆ›å»ºæ¨¡æ€èƒŒæ™¯
					const backdrop = document.createElement('div');
					backdrop.style.cssText = `
						position: fixed;
						top: 0;
						left: 0;
						right: 0;
						bottom: 0;
						background: rgba(0,0,0,0.6);
						z-index: 9999;
						display: flex;
						justify-content: center;
						align-items: center;
					`;

					// åˆ›å»ºè­¦å‘Šå¼¹çª—
					const alertBox = document.createElement('div');
					alertBox.style.cssText = `
						background: white;
						padding: 25px;
						border-radius: 12px;
						min-width: 400px;
						max-width: 90vw;
						box-shadow: 0 4px 20px rgba(0,0,0,0.25);
					`;

					// å¼¹çª—å†…å®¹
					alertBox.innerHTML = `
						<h2 style="margin:0 0 15px; font-size:20px; color:#d32f2f;">âš ï¸ æ€§èƒ½è­¦å‘Š</h2>
						<ul style="margin:0 0 20px; padding-left:20px;">
							<li style="margin-bottom:8px;">CPUä½¿ç”¨ç‡å¯èƒ½è¾¾åˆ°100%</li>
							<li style="margin-bottom:8px;">æµè§ˆå™¨å¯èƒ½æš‚æ—¶æ— å“åº”ï¼ˆçº¦10-30ç§’ï¼‰</li>
							<li style="margin-bottom:8px;">ç§»åŠ¨è®¾å¤‡å¯èƒ½å‡ºç°æ˜æ˜¾å‘çƒ­</li>
						</ul>
						<div style="display: flex; gap:10px;">
							<button id="confirmBtn" 
								style="flex:1; padding:12px; background:#4CAF50; 
									   color:white; border:none; border-radius:6px;
									   cursor:pointer;">ç»§ç»­æ‰§è¡Œ</button>
							<button id="cancelBtn"
								style="flex:1; padding:12px; background:#f44336;
									   color:white; border:none; border-radius:6px;
									   cursor:pointer;">å–æ¶ˆæ“ä½œ</button>
						</div>
					`;

					// å…³é—­å¼¹çª—å¹¶è¿”å›ç»“æœ
					const close = (result) => {
						document.body.removeChild(backdrop);
						resolve(result);
					};

					// ç»‘å®šæŒ‰é’®äº‹ä»¶
					alertBox.querySelector('#confirmBtn').addEventListener('click', () => close(true));
					alertBox.querySelector('#cancelBtn').addEventListener('click', () => close(false));

					// ç‚¹å‡»èƒŒæ™¯å…³é—­ï¼ˆç›¸å½“äºå–æ¶ˆï¼‰
					backdrop.addEventListener('click', (e) => {
						if (e.target === backdrop) close(false);
					});

					// æ·»åŠ å…ƒç´ åˆ°DOM
					backdrop.appendChild(alertBox);
					document.body.appendChild(backdrop);
				});
			}

			// æ„å»ºAKç»Ÿè®¡ç»“æœçš„HTMLå­—ç¬¦ä¸²
			function buildAKStats(total, single, double, totalAK) {
				// è®¡ç®—å•AKå’ŒåŒAKçš„æ¦‚ç‡
				const singleRate = (single / total * 100).toFixed(2);
				const doubleRate = (double / total * 100).toFixed(2);

				// è¿”å›æ ¼å¼åŒ–åçš„ç»Ÿè®¡ä¿¡æ¯HTML
				return `
					<div style="border-top:1px solid #ddd; padding-top:10px;">
						<h4>è¯¸è‘›è¿å¼©ç»Ÿè®¡ï¼ˆç‰Œå †å…±${totalAK}å¼ ï¼‰</h4>
						<p>å‰7å¼ å‡ºç°è‡³å°‘1å¼ ï¼š 
							${single.toLocaleString()}/${total.toLocaleString()}, 
							${singleRate}%</p>
						<p>å‰7å¼ åŒæ—¶å‡ºç°2å¼ ï¼š 
							${double.toLocaleString()}/${total.toLocaleString()}, 
							${doubleRate}%</p>
					</div>
				`;
			}

			// æ›´æ–°AKç»Ÿè®¡æ˜¾ç¤º
			function updateAKStats(progress, completed, single, double) {
				// è·å–ç»Ÿè®¡æ˜¾ç¤ºåŒºåŸŸ
				const statsDiv = progress.querySelector('#akStats');
				if (!statsDiv) return;

				// æ ¼å¼åŒ–æ•°å­—ï¼ˆåƒä½åˆ†éš”ç¬¦ï¼‰
				const current = completed.toLocaleString();

				// è®¡ç®—å½“å‰æ¦‚ç‡
				const singleRate = (single / completed * 100).toFixed(2);
				const doubleRate = (double / completed * 100).toFixed(2);

				// æ›´æ–°ç»Ÿè®¡æ˜¾ç¤ºå†…å®¹
				statsDiv.innerHTML = `
					<p>å®æ—¶ç»Ÿè®¡ï¼ˆå·²æµ‹è¯•${current}æ¬¡ï¼‰:</p>
					<p>å•AKå‡ºç°ç‡: ${singleRate}%</p>
					<p>åŒAKå‡ºç°ç‡: ${doubleRate}%</p>
				`;
			}

			// ç”Ÿæˆæ ‡å‡†ç‰Œå †
			function generateStandardDeck() {
				const deck = []; // åˆ›å»ºç©ºç‰Œå †æ•°ç»„

				// éå†å¤–éƒ¨å®šä¹‰çš„standardDeckæ•°ç»„
				standardDeck.forEach(card => {
					// éå†æ¯å¼ å¡ç‰Œçš„èŠ±è‰²å­—ç¬¦ä¸²
					card.suits.forEach(suitStr => {
						// ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è§£æèŠ±è‰²å’Œç‚¹æ•°
						const match = suitStr.match(/^([â™ â™¥â™£â™¦]ï¸?)([JQKA]|\d+)$/);
						if (match) {
							const suitPart = match[1]; // æå–èŠ±è‰²éƒ¨åˆ†
							let point = match[2]; // æå–ç‚¹æ•°éƒ¨åˆ†

							// å°†å­—æ¯ç‚¹æ•°è½¬æ¢ä¸ºæ•°å­—
							switch (point) {
								case 'J':
									point = 11;
									break;
								case 'Q':
									point = 12;
									break;
								case 'K':
									point = 13;
									break;
								case 'A':
									point = 1;
									break;
								default:
									point = parseInt(point, 10); // æ•°å­—ç›´æ¥è½¬æ¢
							}

							// æ ¹æ®å¡ç‰Œæ•°é‡åˆ›å»ºå¤šä¸ªå‰¯æœ¬
							for (let i = 0; i < card.count; i++) {
								// æ·»åŠ å¡ç‰Œå¯¹è±¡åˆ°ç‰Œå †
								deck.push({
									name: card.name, // å¡ç‰Œåç§°
									suit: suitPart, // èŠ±è‰²
									point: point, // ç‚¹æ•°ï¼ˆæ•°å­—ï¼‰
									uid: CryptoJS.lib.WordArray.random(16).toString() // å”¯ä¸€ID
								});
							}
						}
					});
				});

				return deck; // è¿”å›ç”Ÿæˆçš„ç‰Œå †
			}

			// æ˜¾ç¤ºæ€§èƒ½è­¦å‘Šå¼¹çª—ï¼ˆæ”¹è¿›ç‰ˆï¼‰
			async function showPerformanceWarning(testFunction) {
				// è¿”å›Promiseä»¥å¤„ç†ç”¨æˆ·é€‰æ‹©
				return new Promise((resolve) => {
					// åˆ›å»ºè­¦å‘Šå¼¹çª—
					const alertBox = document.createElement('div');
					alertBox.className = 'security-alert';
					alertBox.innerHTML = `
						<strong>æ€§èƒ½è­¦å‘Š</strong>
						<p>å³å°†æ‰§è¡Œå‹åŠ›æµ‹è¯•ï¼Œå¯èƒ½ä¼šé€ æˆï¼šï¼ˆç³»ç»Ÿä¼šè‡ªåŠ¨è¿›è¡Œåä¸‡æ¬¡æ´—ç‰Œï¼ï¼ï¼ï¼‰</p>
						<ul>
							<li>â–¸ CPUä½¿ç”¨ç‡çŸ­æš‚é£™å‡</li>
							<li>â–¸ æµè§ˆå™¨æš‚æ—¶æ— å“åº”ï¼ˆçº¦10-30ç§’ï¼‰</li>
							<li>â–¸ ç§»åŠ¨è®¾å¤‡å¯èƒ½å‡ºç°æ˜æ˜¾å‘çƒ­</li>
						</ul>
						<p>å»ºè®®å…³é—­å…¶ä»–æ ‡ç­¾é¡µåç»§ç»­ï¼Œæ˜¯å¦ç¡®è®¤æ‰§è¡Œï¼Ÿ</p>
						<button class="confirm">ç»§ç»­æ‰§è¡Œ</button>
						<button class="cancel">å–æ¶ˆæ“ä½œ</button>
					`;

					// åˆ›å»ºæ¨¡æ€èƒŒæ™¯
					const backdrop = document.createElement('div');
					backdrop.className = 'modal-backdrop';

					// åˆ›å»ºå®¹å™¨å±…ä¸­å¼¹çª—
					const container = document.createElement('div');
					container.style.cssText = `
						position: fixed;
						top: 0;
						left: 0;
						width: 100%;
						height: 100%;
						display: flex;
						justify-content: center;
						align-items: center;
					`;

					// ç»„è£…å…ƒç´ 
					container.appendChild(alertBox);
					backdrop.appendChild(container);
					document.body.appendChild(backdrop);

					// å¤„ç†ç”¨æˆ·é€‰æ‹©
					const handler = (result) => {
						document.body.removeChild(backdrop); // ç§»é™¤å¼¹çª—
						resolve(result); // è¿”å›ç”¨æˆ·é€‰æ‹©
					};

					// ç»‘å®šæŒ‰é’®äº‹ä»¶
					alertBox.querySelector('.confirm').addEventListener('click', () => handler(true));
					alertBox.querySelector('.cancel').addEventListener('click', () => handler(false));

					// ç‚¹å‡»èƒŒæ™¯å…³é—­ï¼ˆç›¸å½“äºå–æ¶ˆï¼‰
					backdrop.addEventListener('click', (e) => {
						if (e.target === backdrop) handler(false);
					});
				});
			}

			// æ›´æ–°å‰©ä½™å¡ç‰Œè®¡æ•°æ˜¾ç¤º
			function updateRemainingCounts() {
				// å®šä¹‰å¡ç‰Œåˆ†ç±»ç»“æ„
				const categories = {
					basic: {
						name: "åŸºæœ¬ç‰Œ",
						items: {}
					},
					trick: {
						name: "æ™®é€šé”¦å›Šç‰Œ",
						items: {}
					},
					ystrick: {
						name: "å»¶æ—¶é”¦å›Šç‰Œ",
						items: {}
					},
					weapon: {
						name: "æ­¦å™¨",
						items: {}
					},
					armor: {
						name: "é˜²å…·",
						items: {}
					},
					horse: {
						name: "åéª‘",
						items: {}
					}
				};

				// éå†ç‰Œå †ä¸­çš„æ‰€æœ‰å¡ç‰Œ
				deck.forEach(card => {
					// ä½¿ç”¨å¤–éƒ¨å®šä¹‰çš„cardCategoriesè¿›è¡Œåˆ†ç±»
					for (const [type, items] of Object.entries(cardCategories)) {
						// æ£€æŸ¥å½“å‰å¡ç‰Œæ˜¯å¦å±äºæ­¤åˆ†ç±»
						if (items.includes(card.name)) {
							// åˆå§‹åŒ–æˆ–å¢åŠ è¯¥å¡ç‰Œçš„è®¡æ•°
							categories[type].items[card.name] =
								(categories[type].items[card.name] || 0) + 1;
							break; // æ‰¾åˆ°åˆ†ç±»åè·³å‡ºå¾ªç¯
						}
					}
				});

				let html = ''; // åˆå§‹åŒ–HTMLå­—ç¬¦ä¸²

				// éå†æ‰€æœ‰åˆ†ç±»
				for (const category of Object.values(categories)) {
					// è·³è¿‡æ²¡æœ‰å¡ç‰Œçš„åˆ†ç±»
					if (Object.keys(category.items).length === 0) continue;

					// æ·»åŠ åˆ†ç±»æ ‡é¢˜
					html += `<div class="category"><div class="category-title">${category.name}</div>`;

					// å¯¹å¡ç‰Œåç§°æŒ‰ä¸­æ–‡æ’åº
					const sorted = Object.entries(category.items)
						.sort((a, b) => a[0].localeCompare(b[0], 'zh-Hans-CN'));

					// æ·»åŠ å¡ç‰Œè®¡æ•°é¡¹
					html += sorted.map(([name, count]) =>
						`<div class="count-item">${name}ï¼š${count}</div>`
					).join('');

					html += '</div>'; // å…³é—­åˆ†ç±»div
				}

				// æ›´æ–°DOMæ˜¾ç¤º
				document.getElementById('remaining-counts').innerHTML = html;
			}

			// æŠ½ç‰Œå‡½æ•°
			function drawCards(count) {
				// æ£€æŸ¥ç‰Œå †æ˜¯å¦ä¸ºç©º
				if (deck.length === 0) {
					alert("ç‰Œå †å·²ç©ºï¼Œæ— æ³•ç»§ç»­æŠ½ç‰Œï¼");
					return;
				}

				// å¦‚æœæŠ½ç‰Œæ•°å¤§äºå‰©ä½™ç‰Œæ•°ï¼Œè‡ªåŠ¨è°ƒæ•´
				if (deck.length < count) {
					alert(`ç‰Œå †ä»…å‰©${deck.length}å¼ ï¼Œè‡ªåŠ¨æŠ½å–å…¨éƒ¨`);
					count = deck.length;
				}

				// æŠ½å–æŒ‡å®šæ•°é‡çš„å¡ç‰Œ
				for (let i = 0; i < count; i++) {
					const drawnCard = deck.shift(); // ä»ç‰Œå †é¡¶éƒ¨å–å‡ºä¸€å¼ ç‰Œ
					drawnCards.push(drawnCard); // æ·»åŠ åˆ°å·²æŠ½å–å¡ç‰Œåˆ—è¡¨
					hand.push(drawnCard); // æ·»åŠ åˆ°ç©å®¶æ‰‹ç‰Œ

					// ç‰¹æ®Šå¤„ç†ï¼šæŠ½åˆ°è¯¸è‘›è¿å¼©ï¼ˆAKï¼‰æ—¶æç¤º
					if (drawnCard.name === "è¯¸è‘›è¿å¼©") {
						alert(`æŠ½åˆ°AKï¼å‰©ä½™ç‰Œå †ï¼š${deck.length}å¼ `);
					}
				}

				// æ›´æ–°ç•Œé¢
				updateRemaining(); // æ›´æ–°å‰©ä½™ç‰Œæ•°æ˜¾ç¤º
				updateReshuffleButton(); // æ›´æ–°è„šæ°”å¡æŒ‰é’®çŠ¶æ€
				updateUI(); // æ›´æ–°æ•´ä½“ç•Œé¢
			}

			// å±•ç¤ºå‰©ä½™ç‰Œå †è¯¦æƒ…
			function revealDeck() {
				const container = document.getElementById('remaining');

				// æ£€æŸ¥ç‰Œå †æ˜¯å¦ä¸ºç©º
				if (deck.length === 0) {
					container.innerHTML = `<h3>å‰©ä½™ç‰Œå † (0å¼ )</h3><p>ç‰Œå †å·²ç©º</p>`;
					return;
				}

				// æ˜¾ç¤ºç‰Œå †æ ‡é¢˜
				container.innerHTML = `<h3>å‰©ä½™ç‰Œå † (${deck.length}å¼ )</h3>`;

				// éå†ç‰Œå †ä¸­çš„æ¯å¼ ç‰Œ
				deck.forEach((card, index) => {
					// æ·»åŠ æ¯å¼ ç‰Œçš„è¯¦ç»†ä¿¡æ¯
					container.innerHTML += `
						<div class="card">
							${index + 1}. ${card.name} ${card.suit}${getPointDisplay(card.point)}
						</div>`;
				});
			}

			// é«˜äº®æ˜¾ç¤ºè¯¸è‘›è¿å¼©ï¼ˆAKï¼‰
			function highlightZhugeLianNu() {
				const remainingCards = document.querySelectorAll('#remaining .card');

				// æ£€æŸ¥ç‰Œå †æ˜¯å¦ä¸ºç©º
				if (deck.length === 0) {
					alert("ç‰Œå †å·²ç©ºï¼Œæ²¡æœ‰è¯¸è‘›è¿å¼©ï¼");
					return;
				}

				// æ‰¾å‡ºæ‰€æœ‰AKç‰Œ
				const akCards = Array.from(remainingCards).filter(card =>
					card.textContent.includes('è¯¸è‘›è¿å¼©')
				);

				// ä¸ºAKç‰Œæ·»åŠ é«˜äº®æ ·å¼
				akCards.forEach(card => card.classList.add('highlight'));

				// è·å–AKç‰Œçš„ä½ç½®
				const indices = akCards.map(card =>
					Array.from(remainingCards).indexOf(card) + 1
				);

				// æ˜¾ç¤ºæç¤ºä¿¡æ¯
				indices.length > 0 ?
					alert(`è¯¸è‘›è¿å¼©ä½ç½®ï¼š${indices.join(', ')}`) :
					alert("å‰©ä½™ç‰Œå †ä¸­æ²¡æœ‰è¯¸è‘›è¿å¼©ï¼");
			}

			// æ›´æ–°å‰©ä½™ç‰Œæ•°æ˜¾ç¤º
			function updateRemaining() {
				// æ˜¾ç¤ºå‰©ä½™ç‰Œæ•°
				document.getElementById('remaining').innerHTML = `å‰©ä½™ç‰Œå †: ${deck.length}å¼ `;

				// æ›´æ–°å„ç±»å¡ç‰Œè®¡æ•°
				updateRemainingCounts();
			}

			// å¤„ç†è„šæ°”å¡ä½¿ç”¨ï¼ˆé‡æ–°æ´—ç‰Œï¼‰
			function handleReshuffle() {
				// éªŒè¯è„šæ°”å¡ä½¿ç”¨æ¡ä»¶
				if (!validateReshuffle()) return;

				// è®°å½•æ—¥å¿—
				log(`å¼€å§‹ä½¿ç”¨è„šæ°”å¡ï¼ˆå½“å‰å·²ç”¨${reshuffleUsed}æ¬¡ï¼‰`);

				// å›æ”¶å½“å‰æ‰‹ç‰Œ
				const currentDrawn = hand.splice(-4, 4);
				log(`å›æ”¶æ‰‹ç‰Œï¼š${currentDrawn.map(c => c.name).join(', ')}`);

				// å°†æ‰‹ç‰Œæ”¾å›ç‰Œå †é¡¶éƒ¨
				deck.unshift(...currentDrawn);

				// æ´—ç‰Œ
				shuffleDeck();

				// æ›´æ–°è„šæ°”å¡ä½¿ç”¨æ¬¡æ•°
				reshuffleUsed++;
				log(`è„šæ°”å¡æ´—ç‰Œå®Œæˆï¼ˆ${reshuffleUsed}/${MAX_RESHUFLE}æ¬¡ï¼‰`);

				// æ¸…ç©ºå·²æŠ½å–ç‰Œå †
				discardPile.push(...drawnCards);
				drawnCards = [];

				// é‡æ–°æŠ½ç‰Œ
				drawCards(4);
				log(`é‡æ–°æŠ½å–4å¼ ç‰Œï¼Œå‰©ä½™ç‰Œå †ï¼š${deck.length}å¼ `);

				// æ›´æ–°ç•Œé¢
				updateCounter();
				updateReshuffleButton();
			}

			// éªŒè¯è„šæ°”å¡ä½¿ç”¨æ¡ä»¶
			function validateReshuffle() {
				// è„šæ°”å¡ä½¿ç”¨æ¡ä»¶ï¼šæ‰‹ç‰Œ4å¼ ã€æœªè¾¾ä½¿ç”¨ä¸Šé™ã€ç‰Œå †+æ‰‹ç‰Œâ‰¥4
				const isValid = hand.length === 4 &&
					reshuffleUsed < MAX_RESHUFLE &&
					deck.length + hand.length >= 4;

				// è®°å½•æ— æ•ˆå°è¯•æ—¥å¿—
				if (!isValid) {
					log(`è„šæ°”å¡ä½¿ç”¨å¤±è´¥ï¼ŒéªŒè¯æ¡ä»¶ä¸æ»¡è¶³ï¼š
					æ‰‹ç‰Œæ•°: ${hand.length}
					å·²ç”¨æ¬¡æ•°: ${reshuffleUsed}
					å‰©ä½™ç‰Œæ•°: ${deck.length}`);
				}

				return isValid;
			}

			// æ¸…ç©ºç‰Œå †æ˜¾ç¤º
			function clearDisplay() {
				document.getElementById('deck').innerHTML = '';
			}

			// æ›´æ–°è„šæ°”å¡æŒ‰é’®çŠ¶æ€
			function updateReshuffleButton() {
				const btn = document.getElementById('reshuffleBtn');

				// æŒ‰é’®å¯ç”¨æ¡ä»¶ï¼šå·²æŠ½4å¼ ç‰Œä¸”æœªè¾¾ä½¿ç”¨ä¸Šé™
				btn.disabled = !(drawnCards.length === 4 && reshuffleUsed < MAX_RESHUFLE);
			}

			// æ´—ç‰Œå‡½æ•°
			function shuffleDeck() {
				// Fisher-Yatesæ´—ç‰Œç®—æ³•
				for (let i = deck.length - 1; i > 0; i--) {
					const j = Math.floor(Math.random() * (i + 1));
					[deck[i], deck[j]] = [deck[j], deck[i]];
				}

				// å¦‚æœè£…å¤‡çš„æ­¦å™¨ä¸åœ¨ç‰Œå †ä¸­ï¼Œé‡ç½®æ­¦å™¨çŠ¶æ€
				if (!deck.some(c => c.name === currentWeapon)) {
					currentWeapon = null;
					hasZhugeLianNu = false;
					killCount = 2;
				}

				// é‡ç½®æ¡ƒå’Œé…’çš„ä½¿ç”¨æ¬¡æ•°
				peachCount = 1;
				document.getElementById('peach-counter').textContent = `æ¡ƒå¯ç”¨æ¬¡æ•°ï¼š1`;
				wineCount = 1;

				// æ›´æ–°çŠ¶æ€
				updateStatus();

				// ç”Ÿæˆæ–°çš„AESç¼–ç 
				generateDeckAES();
				updateAESDisplay();
			}

			// å¼€å§‹æ¸¸æˆ
			function startGame() {
				drawCards(4); // åˆå§‹æŠ½4å¼ ç‰Œ
				phase = 'å‡†å¤‡'; // è®¾ç½®æ¸¸æˆé˜¶æ®µ

				// è®¾ç½®æŒ‰é’®çŠ¶æ€
				document.getElementById('drawBtn').disabled = false; // æ‘¸ç‰Œé˜¶æ®µå¯ç”¨
				document.getElementById('playBtn').disabled = true; // å‡ºç‰Œé˜¶æ®µç¦ç”¨

				// æ›´æ–°ç•Œé¢
				updateUI();
			}

			// åˆå§‹åŒ–æŒ‰é’®çŠ¶æ€
			function initializeButtons() {
				document.getElementById('drawBtn').disabled = false; // æ‘¸ç‰Œé˜¶æ®µå¯ç”¨
				document.getElementById('playBtn').disabled = true; // å‡ºç‰Œé˜¶æ®µç¦ç”¨
			}

			// æ‘¸ç‰Œé˜¶æ®µå¤„ç†
			function drawPhase() {
				// æ£€æŸ¥ç‰Œå †æ˜¯å¦ä¸ºç©º
				if (deck.length === 0) {
					alert("ç‰Œå †å·²ç©ºï¼Œæ— æ³•æ‘¸ç‰Œï¼");
					return;
				}

				// è®¾ç½®æ¸¸æˆé˜¶æ®µä¸º"æ‘¸ç‰Œ"
				phase = 'æ‘¸ç‰Œ';

				// æ‘¸3å¼ ç‰Œ
				drawCards(3);

				// æ›´æ–°æŒ‰é’®çŠ¶æ€
				document.getElementById('drawBtn').disabled = true; // ç¦ç”¨æ‘¸ç‰ŒæŒ‰é’®
				document.getElementById('playBtn').disabled = false; // å¯ç”¨å‡ºç‰ŒæŒ‰é’®

				// æ›´æ–°ç•Œé¢
				updateUI();
			}

			// å‡ºç‰Œé˜¶æ®µå¤„ç†
			function playPhase() {
				// è®¾ç½®æ¸¸æˆé˜¶æ®µä¸º"å‡ºç‰Œ"
				phase = 'å‡ºç‰Œ';

				// é‡ç½®æœ€åä½¿ç”¨çš„å¡ç‰Œ
				lastUsedCard = null;

				// æ›´æ–°æŒ‰é’®çŠ¶æ€
				document.getElementById('drawBtn').disabled = true; // ç¦ç”¨æ‘¸ç‰ŒæŒ‰é’®
				document.getElementById('playBtn').disabled = true; // ç¦ç”¨å‡ºç‰ŒæŒ‰é’®
				document.getElementById('endPlayBtn').disabled = false; // å¯ç”¨ç»“æŸå‡ºç‰ŒæŒ‰é’®

				// æ›´æ–°ç•Œé¢
				updateUI();
			}

			// ä½¿ç”¨å¡ç‰Œ
			function useCard(card, index) {
				// åªèƒ½åœ¨å‡ºç‰Œé˜¶æ®µä½¿ç”¨å¡ç‰Œ
				if (phase !== 'å‡ºç‰Œ') return;

				// è®°å½•ä½¿ç”¨å¡ç‰Œæ—¥å¿—
				log(`ä½¿ç”¨å¡ç‰Œï¼š${card.name} ${card.suit}${getPointDisplay(card.point)}`);

				// æ­¦å™¨ç±»å¡ç‰Œå¤„ç†
				if (cardCategories.weapon.includes(card.name)) {
					// å¦‚æœå·²è£…å¤‡å…¶ä»–æ­¦å™¨ï¼Œå…ˆå¸é™¤
					if (currentWeapon && currentWeapon !== card.name) {
						// å¦‚æœå¸é™¤çš„æ˜¯è¯¸è‘›è¿å¼©ï¼Œé‡ç½®æ€æ¬¡æ•°
						if (currentWeapon === "è¯¸è‘›è¿å¼©") {
							hasZhugeLianNu = false;
							killCount = 2;
							log(`å¸é™¤è¯¸è‘›è¿å¼©ï¼Œæ€æ¬¡æ•°é‡ç½®ä¸º2`);
						}
					}

					// è£…å¤‡æ–°æ­¦å™¨
					currentWeapon = card.name;
					hasZhugeLianNu = (card.name === "è¯¸è‘›è¿å¼©");

					// å¦‚æœæ˜¯è¯¸è‘›è¿å¼©ï¼Œè®°å½•æ—¥å¿—
					if (hasZhugeLianNu) {
						log("è£…å¤‡è¯¸è‘›è¿å¼©ï¼Œæ€æ¬¡æ•°é™åˆ¶è§£é™¤");
					}
				}
				// å»¶æ—¶é”¦å›Šå¤„ç†
				if (["å…µç²®å¯¸æ–­", "ä¹ä¸æ€èœ€","é—ªç”µ"].includes(card.name)) {
				    if (handleDelayCard(card, index)) return;
				}


				// æ€ç±»å¡ç‰Œå¤„ç†
				if (['æ€', 'ç«æ€', 'é›·æ€'].includes(card.name)) {
					// å¦‚æœæ²¡æœ‰è£…å¤‡è¯¸è‘›è¿å¼©
					if (!hasZhugeLianNu) {
						// æ£€æŸ¥æ€æ¬¡æ•°æ˜¯å¦ç”¨å°½
						if (killCount <= 0) {
							alert("æ€æ¬¡æ•°å·²ç”¨å°½ï¼");
							return;
						}
						// å‡å°‘æ€æ¬¡æ•°å¹¶è®°å½•
						killCount--;
						log(`ä½¿ç”¨${card.name}ï¼Œå‰©ä½™æ¬¡æ•°ï¼š${killCount}`);
					}
				}

				// ç‰¹æ®Šå¡ç‰Œï¼šè¯¸è‘›è¿å¼©
				if (card.name === "è¯¸è‘›è¿å¼©") {
					hasZhugeLianNu = true;
					log("è£…å¤‡è¯¸è‘›è¿å¼©ï¼Œæ€æ¬¡æ•°é™åˆ¶è§£é™¤ï¼");
				}

				// ç‰¹æ®Šå¡ç‰Œï¼šæ— ä¸­ç”Ÿæœ‰
				if (card.name === "æ— ä¸­ç”Ÿæœ‰") {
					log('ä½¿ç”¨æ— ä¸­ç”Ÿæœ‰ï¼Œé¢å¤–æ‘¸ä¸¤å¼ ç‰Œï¼');
					drawCards(2); // æ‘¸ä¸¤å¼ ç‰Œ
				}

				//é¡ºæ‰‹ç‰µç¾Š
				if (card.name === "é¡ºæ‰‹ç‰µç¾Š") {
					log('ä½¿ç”¨é¡ºæ‰‹ç‰µç¾Šï¼Œé¢å¤–æ‘¸ä¸€å¼ ç‰Œ');
					drawCards(1); //æ‘¸ä¸€å¼ ç‰Œ
				}

				// ç¦æ­¢ä½¿ç”¨çš„å¡ç‰Œï¼šé—ª
				if (card.name === 'é—ª') {
					alert("å‡ºç‰Œé˜¶æ®µç¦æ­¢ä½¿ç”¨é—ªï¼");
					return; // æå‰è¿”å›ï¼Œä¸æ‰§è¡Œåç»­æ“ä½œ
				}

				// ç¦æ­¢ä½¿ç”¨çš„å¡ç‰Œï¼šæ— æ‡ˆå¯å‡»
				if (card.name === 'æ— æ‡ˆå¯å‡»') {
					alert("å‡ºç‰Œé˜¶æ®µç¦æ­¢ä½¿ç”¨æ— æ‡ˆå¯å‡»");
					return; // æå‰è¿”å›ï¼Œä¸æ‰§è¡Œåç»­æ“ä½œ
				}

				// ç‰¹æ®Šå¡ç‰Œï¼šé“ç´¢è¿ç¯
				if (card.name === "é“ç´¢è¿ç¯") {
					showChainDialog(card, index); // æ˜¾ç¤ºé€‰æ‹©å¯¹è¯æ¡†
					return; // æå‰è¿”å›ï¼Œå¯¹è¯æ¡†ä¼šå¤„ç†åç»­æ“ä½œ
				}

				//äº”è°·ä¸°ç™»
				if (card.name === "äº”è°·ä¸°ç™»") {
					showWugufengdengDialog(card, index); // æ˜¾ç¤ºé€‰æ‹©å¯¹è¯æ¡†
					return; // æå‰è¿”å›ï¼Œå¯¹è¯æ¡†ä¼šå¤„ç†åç»­æ“ä½œ
				}

				// ç‰¹æ®Šå¡ç‰Œï¼šå€Ÿåˆ€æ€äºº
				if (card.name === "å€Ÿåˆ€æ€äºº") {
					showJiedaoDialog(card, index); // æ˜¾ç¤ºé€‰æ‹©å¯¹è¯æ¡†
					return; // æå‰è¿”å›ï¼Œå¯¹è¯æ¡†ä¼šå¤„ç†åç»­æ“ä½œ
				}

				// æ¡ƒç±»å¡ç‰Œå¤„ç†
				if (card.name === "æ¡ƒ") {
					// æ£€æŸ¥æ¡ƒä½¿ç”¨æ¬¡æ•°
					if (peachCount <= 0) {
						alert("æ¡ƒä½¿ç”¨æ¬¡æ•°å·²è€—å°½ï¼");
						return;
					}
					// å‡å°‘æ¡ƒæ¬¡æ•°å¹¶è®°å½•
					peachCount--;
					log(`ä½¿ç”¨æ¡ƒï¼Œå‰©ä½™æ¬¡æ•°ï¼š${peachCount}`);
				}

				// ç‰¹æ®Šå¡ç‰Œï¼šæ¡ƒå›­ç»“ä¹‰
				if (card.name === "æ¡ƒå›­ç»“ä¹‰") {
					// å‡å°‘æ¡ƒæ¬¡æ•°ï¼ˆè‡³å°‘ä¸º0ï¼‰
					peachCount = Math.max(peachCount - 1, 0);
					log(`ä½¿ç”¨æ¡ƒå›­ç»“ä¹‰æ¢å¤ä½“åŠ›ï¼Œå‰©ä½™æ¬¡æ•°ï¼š${peachCount}`);
				}

				// é…’ç±»å¡ç‰Œå¤„ç†
				if (card.name === "é…’") {
					// æ£€æŸ¥é…’ä½¿ç”¨æ¬¡æ•°
					if (wineCount <= 0) {
						alert("é…’ä½¿ç”¨æ¬¡æ•°å·²è€—å°½ï¼");
						return;
					}
					// å‡å°‘é…’æ¬¡æ•°å¹¶è®°å½•
					wineCount--;
					log(`ä½¿ç”¨é…’ï¼Œå‰©ä½™æ¬¡æ•°ï¼š${wineCount}`);
				}

				// æ¸è¥æŠ€èƒ½æ£€æŸ¥ï¼ˆè¿ç»­ä½¿ç”¨ç›¸åŒèŠ±è‰²æˆ–ç‚¹æ•°çš„ç‰Œï¼‰
				if (lastUsedCard && (card.suit === lastUsedCard.suit || card.point === lastUsedCard.point)) {
					log('è§¦å‘æ¸è¥ï¼Œæ‘¸ä¸€å¼ ç‰Œï¼');
					drawCards(1); // é¢å¤–æ‘¸ä¸€å¼ ç‰Œ
				}

				// æ›´æ–°æœ€åä½¿ç”¨çš„å¡ç‰Œ
				lastUsedCard = card;

				// ä»æ‰‹ç‰Œç§»é™¤å¹¶æ”¾å…¥å¼ƒç‰Œå †
				discardPile.push(hand.splice(index, 1)[0]);

				// æ›´æ–°çŠ¶æ€å’Œç•Œé¢
				updateStatus();
				updateUI();
			}

			// æ›´æ–°çŠ¶æ€æ˜¾ç¤º
			function updateStatus() {
				// è·å–DOMå…ƒç´ 
				const counter = document.getElementById('kill-counter');
				const zhuge = document.getElementById('zhuge-status');

				// æ›´æ–°æ¡ƒå’Œé…’çš„ä½¿ç”¨æ¬¡æ•°
				document.getElementById('peach-counter').textContent = `æ¡ƒå¯ç”¨æ¬¡æ•°ï¼š${peachCount}`;
				document.getElementById('wine-counter').textContent = `é…’å¯ç”¨æ¬¡æ•°ï¼š${wineCount}`;

				// æ›´æ–°æ€æ¬¡æ•°æ˜¾ç¤ºï¼ˆæ ¹æ®æ˜¯å¦è£…å¤‡è¯¸è‘›è¿å¼©ï¼‰
				counter.innerHTML = hasZhugeLianNu ?
					'æ€å¯ç”¨æ¬¡æ•°ï¼šâˆ' : // æ— é™æ¬¡
					`æ€å¯ç”¨æ¬¡æ•°ï¼š${killCount}`; // æ˜¾ç¤ºå‰©ä½™æ¬¡æ•°

				// æ›´æ–°æ­¦å™¨çŠ¶æ€
				zhuge.textContent = currentWeapon ?
					`å½“å‰æ­¦å™¨ï¼š${currentWeapon}` : // æ˜¾ç¤ºå½“å‰æ­¦å™¨
					"å½“å‰æ­¦å™¨ï¼šæ— "; // æ²¡æœ‰è£…å¤‡æ­¦å™¨

				// æ›´æ–°å»¶æ—¶é”¦å›Šæ˜¾ç¤º
				updateDelayArea();
			}

			// æ›´æ–°å»¶æ—¶é”¦å›ŠåŒºåŸŸæ˜¾ç¤º
			function updateDelayArea() {
			    const bingliangContainer = document.getElementById('bingliang-container');
			    const lebuContainer = document.getElementById('lebu-container');
			    const shandianContainer = document.getElementById('shandian-container'); // æ–°å¢
			    
			    // æ¸…ç©ºå®¹å™¨
			    bingliangContainer.innerHTML = '';
			    lebuContainer.innerHTML = '';
			    shandianContainer.innerHTML = ''; // æ–°å¢
			    
			    // å…µç²®å¯¸æ–­åŒºåŸŸ
			    if (bingliangArea.length === 0) {
			        bingliangContainer.innerHTML = '<div class="delay-card disabled">ç©º</div>';
			    } else {
			        bingliangArea.forEach(card => {
			            const cardDiv = document.createElement('div');
			            cardDiv.className = 'delay-card';
			            cardDiv.textContent = `${card.name} ${card.suit}${getPointDisplay(card.point)}`;
			            bingliangContainer.appendChild(cardDiv);
			        });
			    }
			    
			    // ä¹ä¸æ€èœ€åŒºåŸŸ
			    if (lebuArea.length === 0) {
			        lebuContainer.innerHTML = '<div class="delay-card disabled">ç©º</div>';
			    } else {
			        lebuArea.forEach(card => {
			            const cardDiv = document.createElement('div');
			            cardDiv.className = 'delay-card';
			            cardDiv.textContent = `${card.name} ${card.suit}${getPointDisplay(card.point)}`;
			            lebuContainer.appendChild(cardDiv);
			        });
			    }
			    
			    // é—ªç”µåŒºåŸŸ
			    if (shandianArea.length === 0) {
			        shandianContainer.innerHTML = '<div class="delay-card disabled">ç©º</div>';
			    } else {
			        shandianArea.forEach(card => {
			            const cardDiv = document.createElement('div');
			            cardDiv.className = 'delay-card';
			            cardDiv.textContent = `${card.name} ${card.suit}${getPointDisplay(card.point)}`;
			            shandianContainer.appendChild(cardDiv);
			        });
			    }
			}

			// å¤„ç†å»¶æ—¶é”¦å›Šç‰Œä½¿ç”¨
			function handleDelayCard(card, index) {
			    let targetArea, areaName, maxCards;
			    
			    switch(card.name) {
			        case "å…µç²®å¯¸æ–­":
			            targetArea = bingliangArea;
			            areaName = "å…µç²®å¯¸æ–­";
			            maxCards = MAX_DELAY_CARDS;
			            break;
			        case "ä¹ä¸æ€èœ€":
			            targetArea = lebuArea;
			            areaName = "ä¹ä¸æ€èœ€";
			            maxCards = MAX_DELAY_CARDS;
			            break;
			        case "é—ªç”µ": 
			            targetArea = shandianArea;
			            areaName = "é—ªç”µ";
			            maxCards = MAX_SHANDIAN;
			            break;
			        default:
			            return false;
			    }
			    
			    if (targetArea.length >= maxCards) {
			        alert(`${areaName}å·²è¾¾ä¸Šé™ï¼ˆ${maxCards}å¼ ï¼‰ï¼Œæ— æ³•ä½¿ç”¨ï¼`);
			        return true;
			    }
			    
			    // ä»æ‰‹ç‰Œç§»é™¤
			    const usedCard = hand.splice(index, 1)[0];
			    
			    // æ”¾å…¥çŠ¶æ€åŒº
			    targetArea.push(usedCard);
			    
			    log(`ä½¿ç”¨${card.name}ï¼Œæ”¾å…¥${areaName}åŒº`);
			    
			    // æ›´æ–°çŠ¶æ€
			    updateStatus();
			    updateUI();
			    
			    return true;
			}


			//äº”è°·ä¸°ç™»å¯¹è¯æ¡†
			function showWugufengdengDialog(card, index) {
				// æ£€æŸ¥ç‰Œå †æ˜¯å¦è¶³å¤Ÿ
				if (deck.length < 3) {
					alert(`ç‰Œå †ä¸è¶³3å¼ ï¼Œæ— æ³•ä½¿ç”¨äº”è°·ä¸°ç™»ï¼å½“å‰ç‰Œå †: ${deck.length}å¼ `);
					return;
				}

				// åˆ›å»ºæ¨¡æ€èƒŒæ™¯
				const overlay = document.createElement('div');
				overlay.className = 'modal-backdrop';
				overlay.style.zIndex = '10000';

				// åˆ›å»ºå¯¹è¯æ¡†
				const dialog = document.createElement('div');
				dialog.className = 'wugufengdeng-dialog';
				dialog.style = `
			        position: fixed;
			        top: 50%;
			        left: 50%;
			        transform: translate(-50%, -50%);
			        background: #ffecb3;
			        padding: 20px;
			        border-radius: 10px;
			        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
			        z-index: 10001;
			        min-width: 350px;
			        text-align: center;
			    `;

			 // æ·»åŠ æ ‡é¢˜
				dialog.innerHTML = `
			        <h3 style="color:#5d4037; margin-top:0;">äº”è°·ä¸°ç™» - è¯·é€‰æ‹©ä¸€å¼ ç‰Œ</h3>
			        <div class="card-options" style="display: flex; justify-content: center; gap: 20px; margin: 20px 0;">
			            <!-- å¡ç‰Œé€‰é¡¹å°†ç”±JSåŠ¨æ€æ·»åŠ  -->
			        </div>
			        <p style="color:#795548;">å‰©ä½™ä¸¤å¼ ç‰Œå°†ç½®å…¥å¼ƒç‰Œå †</p>
			    `;

				// ä»ç‰Œå †é¡¶éƒ¨å–ä¸‰å¼ ç‰Œ
				const cardsToShow = deck.slice(0, 3);
				const cardOptions = dialog.querySelector('.card-options');

				// åˆ›å»ºä¸‰å¼ ç‰Œçš„é€‰é¡¹
				cardsToShow.forEach((cardObj, i) => {
					const cardDiv = document.createElement('div');
					cardDiv.className = 'wugufengdeng-card';
					cardDiv.style = `
			            border: 2px solid #8d6e63;
			            border-radius: 8px;
			            padding: 15px;
			            background: #fff8e1;
			            cursor: pointer;
			            transition: all 0.3s;
			            min-width: 100px;
			        `;

					cardDiv.innerHTML = `
			            <div style="font-size: 18px; font-weight: bold; color:#5d4037;">${cardObj.name}</div>
			            <div style="font-size: 24px;">${cardObj.suit}${getPointDisplay(cardObj.point)}</div>
			            <div style="font-size: 14px; color:#8d6e63;">ç‚¹å‡»é€‰æ‹©</div>
			        `;

					cardDiv.addEventListener('click', () => handleWugufengdengSelection(card, index, i, cardsToShow));
					cardDiv.addEventListener('mouseenter', () => {
						cardDiv.style.transform = 'translateY(-5px)';
						cardDiv.style.boxShadow = '0 6px 12px rgba(0,0,0,0.15)';
					});
					cardDiv.addEventListener('mouseleave', () => {
						cardDiv.style.transform = 'none';
						cardDiv.style.boxShadow = 'none';
					});

					cardOptions.appendChild(cardDiv);
				});

				// æ·»åŠ å…³é—­æŒ‰é’®
				const closeBtn = document.createElement('button');
				closeBtn.textContent = 'å…³é—­';
				closeBtn.style = `
			        padding: 8px 20px;
			        background: #8d6e63;
			        color: white;
			        border: none;
			        border-radius: 4px;
			        cursor: pointer;
			        margin-top: 10px;
			    `;
				closeBtn.addEventListener('click', () => {
					document.body.removeChild(overlay);
					document.body.removeChild(dialog);
				});

				dialog.appendChild(closeBtn);

				// æ·»åŠ å…ƒç´ åˆ°DOM
				document.body.appendChild(overlay);
				document.body.appendChild(dialog);
			}

			// å¤„ç†äº”è°·ä¸°ç™»é€‰æ‹©
			function handleWugufengdengSelection(wugufengdengCard, handIndex, selectedIndex, shownCards) {
				// å…³é—­æ‰€æœ‰å¯¹è¯æ¡†
				document.querySelectorAll('.modal-backdrop, .wugufengdeng-dialog').forEach(el => el.remove());

				// é€‰ä¸­çš„å¡ç‰Œ
				const selectedCard = shownCards[selectedIndex];

				// ä»ç‰Œå †ä¸­ç§»é™¤å±•ç¤ºçš„ä¸‰å¼ ç‰Œ
				const removedCards = deck.splice(0, 3);

				// æ·»åŠ é€‰ä¸­çš„ç‰Œåˆ°ç©å®¶æ‰‹ç‰Œ
				hand.push(selectedCard);
				log(`äº”è°·ä¸°ç™»è·å¾—: ${selectedCard.name} ${selectedCard.suit}${getPointDisplay(selectedCard.point)}`);

				// å…¶ä½™ä¸¤å¼ ç‰Œç½®å…¥å¼ƒç‰Œå †
				shownCards.forEach((card, i) => {
					if (i !== selectedIndex) {
						discardPile.push(card);
						log(`å¼ƒç½®: ${card.name} ${card.suit}${getPointDisplay(card.point)}`);
					}
				});

				// ä»æ‰‹ç‰Œä¸­ç§»é™¤äº”è°·ä¸°ç™»
				const usedCard = hand.splice(handIndex, 1)[0];
				discardPile.push(usedCard);
				log(`ä½¿ç”¨äº”è°·ä¸°ç™»`);

				// æ£€æŸ¥æ¸è¥æŠ€èƒ½
				if (lastUsedCard && (wugufengdengCard.suit === lastUsedCard.suit || wugufengdengCard.point === lastUsedCard
						.point)) {
					log('è§¦å‘æ¸è¥ï¼Œæ‘¸ä¸€å¼ ç‰Œï¼');
					drawCards(1);
				}

				// æ›´æ–°æœ€åä½¿ç”¨çš„å¡ç‰Œ
				lastUsedCard = wugufengdengCard;

				// æ›´æ–°ç•Œé¢
				updateUI();
				updateRemaining();

				// æ˜¾ç¤ºæ“ä½œåé¦ˆ
				showFeedback(`å·²é€‰æ‹©: ${selectedCard.name}`);
			}

			// æ·»åŠ åé¦ˆæ¶ˆæ¯å‡½æ•°
			function showFeedback(message) {
				const feedback = document.createElement('div');
				feedback.textContent = message;
				feedback.style = `
			        position: fixed;
			        top: 20px;
			        left: 50%;
			        transform: translateX(-50%);
			        padding: 12px 25px;
			        background: #4CAF50;
			        color: white;
			        border-radius: 30px;
			        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
			        z-index: 10000;
			        font-weight: bold;
			        animation: fadeInOut 2.5s forwards;
			    `;

				// æ·»åŠ æ·¡å…¥æ·¡å‡ºåŠ¨ç”»
				const style = document.createElement('style');
				style.textContent = `
			        @keyframes fadeInOut {
			            0% { opacity: 0; top: 10px; }
			            20% { opacity: 1; top: 20px; }
			            80% { opacity: 1; top: 20px; }
			            100% { opacity: 0; top: 10px; }
			        }
			    `;
				document.head.appendChild(style);

				document.body.appendChild(feedback);

				// 2.5ç§’åç§»é™¤
				setTimeout(() => {
					if (document.body.contains(feedback)) {
						document.body.removeChild(feedback);
					}
				}, 2500);
			}

			// é“ç´¢è¿ç¯å¡ç‰Œæ•ˆæœé€‰æ‹©å¯¹è¯æ¡†
			function showChainDialog(card, index) {
				// åˆ›å»ºå¯¹è¯æ¡†å…ƒç´ 
				const dialog = document.createElement('div');
				dialog.style = `
					position: fixed;
					top: 50%;
					left: 50%;
					transform: translate(-50%, -50%);
					background: white;
					padding: 20px;
					border: 2px solid #666;
					z-index: 10000;
					box-shadow: 0 0 10px rgba(0,0,0,0.5);
				`;

				// å¯¹è¯æ¡†å†…å®¹
				dialog.innerHTML = `
					<h3>é“ç´¢è¿ç¯æ•ˆæœé€‰æ‹©</h3>
					<p>è¯·é€‰æ‹©è¦æ‰§è¡Œçš„æ“ä½œï¼š</p>
					<button id="func1" style="margin:5px; padding:8px; background:#BBDEFB;">åŠŸèƒ½1ï¼šé‡é“¸æ‘¸ç‰Œ</button>
					<button id="func2" style="margin:5px; padding:8px; background:#C8E6C9;">åŠŸèƒ½2ï¼šä½¿ç”¨æ£€ç´¢</button>
					<button id="cancel" style="margin:5px; padding:8px; background:#FFCDD2;">å–æ¶ˆ</button>
				`;

				// åˆ›å»ºæ¨¡æ€èƒŒæ™¯
				const overlay = document.createElement('div');
				overlay.style = `
					position: fixed;
					top: 0;
					left: 0;
					right: 0;
					bottom: 0;
					background: rgba(0,0,0,0.5);
					z-index: 9999;
				`;

				// åŠŸèƒ½1ï¼šé‡é“¸æ‘¸ç‰Œ
				dialog.querySelector('#func1').addEventListener('click', () => {
					// ä»æ‰‹ç‰Œç§»é™¤é“ç´¢è¿ç¯
					hand.splice(index, 1);

					// åŠ å…¥å¼ƒç‰Œå †
					discardPile.push(card);

					// æ‘¸ä¸€å¼ ç‰Œ
					drawCards(1);

					// è®°å½•æ—¥å¿—
					log(`é‡é“¸é“ç´¢è¿ç¯ï¼Œæ‘¸1å¼ ç‰Œ`);

					// å…³é—­å¯¹è¯æ¡†
					cleanupDialog();
				});

				// åŠŸèƒ½2ï¼šä½¿ç”¨æ£€ç´¢
				dialog.querySelector('#func2').addEventListener('click', () => {
					// æ£€æŸ¥æ¸è¥æŠ€èƒ½æ˜¯å¦è§¦å‘
					if (lastUsedCard && (card.suit === lastUsedCard.suit || card.point === lastUsedCard.point)) {
						log('è§¦å‘æ¸è¥ï¼Œæ‘¸ä¸€å¼ ç‰Œï¼');
						drawCards(1);
					}

					// æ›´æ–°æœ€åä½¿ç”¨çš„å¡ç‰Œ
					lastUsedCard = card;

					// ä»æ‰‹ç‰Œç§»é™¤å¹¶åŠ å…¥å¼ƒç‰Œå †
					discardPile.push(hand.splice(index, 1)[0]);

					// è®°å½•æ—¥å¿—
					log(`ä½¿ç”¨é“ç´¢è¿ç¯ï¼ŒèŠ±è‰²${card.suit} ç‚¹æ•°${getPointDisplay(card.point)}`);

					// å…³é—­å¯¹è¯æ¡†
					cleanupDialog();
				});

				// å–æ¶ˆæŒ‰é’®
				dialog.querySelector('#cancel').addEventListener('click', cleanupDialog);

				// å…³é—­å¯¹è¯æ¡†çš„å‡½æ•°
				function cleanupDialog() {
					document.body.removeChild(overlay);
					document.body.removeChild(dialog);
					updateUI(); // æ›´æ–°ç•Œé¢
				}

				// æ·»åŠ å…ƒç´ åˆ°DOM
				document.body.appendChild(overlay);
				document.body.appendChild(dialog);
			}

			// å€Ÿåˆ€æ€äººå¡ç‰Œæ•ˆæœé€‰æ‹©å¯¹è¯æ¡†
			function showJiedaoDialog(card, index) {
				// åˆ›å»ºæ¨¡æ€èƒŒæ™¯
				const overlay = document.createElement('div');
				overlay.className = 'modal-backdrop';

				// åˆ›å»ºå¯¹è¯æ¡†
				const dialog = document.createElement('div');
				dialog.className = 'card-selector-modal';
				dialog.innerHTML = `
					<h3>å€Ÿåˆ€æ€äººæ•ˆæœé€‰æ‹©</h3>
					<p>è¯·é€‰æ‹©è¦æ‰§è¡Œçš„æ“ä½œï¼š</p>
					<div style="display: flex; flex-direction: column; gap: 10px;">
						<button id="func1" class="dialog-button" style="background:#BBDEFB;">åŠŸèƒ½1ï¼šæ£€ç´¢æ­¦å™¨</button>
						<button id="func2" class="dialog-button" style="background:#C8E6C9;">åŠŸèƒ½2ï¼šä½¿ç”¨é—ª</button>
						<button id="cancel" class="dialog-button cancel" style="background:#FFCDD2;">å–æ¶ˆ</button>
					</div>
				`;

				// å…³é—­æ‰€æœ‰å¼¹çª—çš„å‡½æ•°
				const closeAllModals = () => {
					document.body.removeChild(overlay);
					document.body.removeChild(dialog);
				};

				// åŠŸèƒ½1ï¼šæ£€ç´¢æ­¦å™¨
				dialog.querySelector('#func1').addEventListener('click', () => {
					closeAllModals(); // å…³é—­å½“å‰å¯¹è¯æ¡†

					// è·å–ç‰Œå †ä¸­çš„æ‰€æœ‰æ­¦å™¨ç‰Œ
					const weaponCards = deck.filter(c => cardCategories.weapon.includes(c.name));

					// æ£€æŸ¥æ˜¯å¦æœ‰æ­¦å™¨ç‰Œ
					if (weaponCards.length === 0) {
						alert("ç‰Œå †ä¸­æ²¡æœ‰æ­¦å™¨ç‰Œï¼");
						return;
					}

					// è·å–ç¬¬ä¸€å¼ æ­¦å™¨ç‰Œï¼ˆéšæœºé€‰æ‹©æ›´åˆç†ï¼Œè¿™é‡Œç®€åŒ–å¤„ç†ï¼‰
					const weaponCard = weaponCards[0];

					// åœ¨ç‰Œå †ä¸­æŸ¥æ‰¾è¯¥æ­¦å™¨ç‰Œçš„ä½ç½®
					const deckIndex = deck.findIndex(c => c.uid === weaponCard.uid);

					// å®‰å…¨éªŒè¯
					if (deckIndex === -1) {
						console.error(`æ­¦å™¨ç‰Œ ${weaponCard.name} ä¸å­˜åœ¨äºç‰Œå †ä¸­`);
						return;
					}

					// ä»ç‰Œå †ä¸­ç§»é™¤æ­¦å™¨ç‰Œ
					const [removed] = deck.splice(deckIndex, 1);

					// æ·»åŠ åˆ°æ‰‹ç‰Œ
					hand.push(removed);

					// è®°å½•æ—¥å¿—
					log(`æ£€ç´¢è·å¾—æ­¦å™¨ï¼š${removed.name} ${removed.suit}${getPointDisplay(removed.point)}`);

					// å®Œæˆå€Ÿåˆ€æ€äººæ•ˆæœ
					finalizeJiedao(card, index);
				});

				// åŠŸèƒ½2ï¼šä½¿ç”¨é—ª
				dialog.querySelector('#func2').addEventListener('click', () => {
					closeAllModals(); // å…³é—­å½“å‰å¯¹è¯æ¡†

					// è·å–æ‰‹ç‰Œä¸­çš„æ‰€æœ‰é—ªç‰Œ
					const shanCards = hand.filter(c => c.name === "é—ª");

					// æ£€æŸ¥æ˜¯å¦æœ‰é—ªç‰Œ
					if (shanCards.length === 0) {
						// æ²¡æœ‰é—ªç‰Œæ—¶æ˜¾ç¤ºç‰¹æ®Šå¯¹è¯æ¡†
						showNoShanDialog(card, index);
					} else {
						// æœ‰é—ªç‰Œæ—¶æ˜¾ç¤ºé€‰æ‹©å¯¹è¯æ¡†
						showShanSelection(shanCards, card, index);
					}

					// å®Œæˆå€Ÿåˆ€æ€äººæ•ˆæœ
					finalizeJiedao(card, index);
				});

				// å–æ¶ˆæŒ‰é’®
				dialog.querySelector('#cancel').addEventListener('click', () => {
					closeAllModals();
					log("å–æ¶ˆä½¿ç”¨å€Ÿåˆ€æ€äºº");
				});

				// ç‚¹å‡»èƒŒæ™¯å…³é—­
				overlay.addEventListener('click', (e) => {
					if (e.target === overlay) {
						closeAllModals();
						log("å–æ¶ˆä½¿ç”¨å€Ÿåˆ€æ€äºº");
					}
				});

				// æ·»åŠ å…ƒç´ åˆ°DOM
				document.body.appendChild(overlay);
				document.body.appendChild(dialog);
			}

			// æ²¡æœ‰é—ªç‰Œæ—¶çš„å¯¹è¯æ¡†
			function showNoShanDialog(card, index) {
				// åˆ›å»ºå¯¹è¯æ¡†
				const dialog = document.createElement('div');
				dialog.className = 'card-selector-modal';
				dialog.innerHTML = `
					<h3>æ²¡æœ‰é—ªç‰Œ</h3>
					<p>è¯·é€‰æ‹©åç»­æ“ä½œï¼š</p>
					<button class="dialog-button" id="cancelUse">å–æ¶ˆä½¿ç”¨</button>
					<button class="dialog-button" id="noShan">åšæŒä¸å‡ºé—ª</button>
				`;

				// åˆ›å»ºæ¨¡æ€èƒŒæ™¯
				const overlay = document.createElement('div');
				overlay.className = 'modal-backdrop';

				// å–æ¶ˆä½¿ç”¨æŒ‰é’®
				dialog.querySelector('#cancelUse').addEventListener('click', () => {
					document.body.removeChild(overlay);
					document.body.removeChild(dialog);
				});

				// åšæŒä¸å‡ºé—ªæŒ‰é’®
				dialog.querySelector('#noShan').addEventListener('click', () => {
					document.body.removeChild(overlay);
					document.body.removeChild(dialog);

					// å¢åŠ æ¡ƒä½¿ç”¨æ¬¡æ•°ï¼ˆæœ€å¤š3æ¬¡ï¼‰
					peachCount = Math.min(peachCount + 1, 3);
					log(`ä¸å‡ºé—ªï¼Œæ¡ƒå¯ç”¨æ¬¡æ•°+1ï¼Œå½“å‰ï¼š${peachCount}`);

					// å®Œæˆå€Ÿåˆ€æ€äººæ•ˆæœ
					finalizeJiedao(card, index);
				});

				// æ·»åŠ å…ƒç´ åˆ°DOM
				document.body.appendChild(overlay);
				document.body.appendChild(dialog);
			}

			// é€‰æ‹©è¦ä½¿ç”¨çš„é—ªç‰Œå¯¹è¯æ¡†
			function showShanSelection(shanCards, card, index) {
				// åˆ›å»ºå¯¹è¯æ¡†
				const dialog = document.createElement('div');
				dialog.className = 'card-selector-modal';
				dialog.innerHTML = `
					<h3>é€‰æ‹©è¦ä½¿ç”¨çš„é—ªç‰Œ</h3>
					<div id="shanList" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin: 15px 0;">
						${shanCards.map((c, i) => `
							<button class="shan-card" data-index="${i}">
								${c.suit}${getPointDisplay(c.point)}
							</button>
						`).join('')}
					</div>
					<button class="dialog-button cancel" id="cancelShan">å–æ¶ˆä½¿ç”¨é—ª</button>
				`;

				// åˆ›å»ºæ¨¡æ€èƒŒæ™¯
				const overlay = document.createElement('div');
				overlay.className = 'modal-backdrop';

				// é—ªç‰Œé€‰æ‹©äº‹ä»¶
				dialog.querySelectorAll('.shan-card').forEach(btn => {
					btn.addEventListener('click', (e) => {
						// è·å–é€‰ä¸­çš„é—ªç‰Œç´¢å¼•
						const idx = parseInt(e.target.dataset.index);
						const selectedCard = shanCards[idx];

						// åœ¨æ‰‹ç‰Œä¸­æŸ¥æ‰¾è¯¥é—ªç‰Œ
						const handIndex = hand.findIndex(c => c.uid === selectedCard.uid);

						// å¦‚æœæ‰¾åˆ°åˆ™ä½¿ç”¨è¯¥é—ªç‰Œ
						if (handIndex > -1) {
							const [removed] = hand.splice(handIndex, 1);
							discardPile.push(removed);
							log(`ä½¿ç”¨é—ªç‰Œï¼š${removed.suit}${getPointDisplay(removed.point)}`);
						}

						// å…³é—­å¯¹è¯æ¡†
						document.body.removeChild(overlay);
						document.body.removeChild(dialog);

						// å®Œæˆå€Ÿåˆ€æ€äººæ•ˆæœ
						finalizeJiedao(card, index);
					});
				});

				// å–æ¶ˆä½¿ç”¨é—ªæŒ‰é’®
				dialog.querySelector('#cancelShan').addEventListener('click', () => {
					document.body.removeChild(overlay);
					document.body.removeChild(dialog);

					// å¢åŠ æ¡ƒä½¿ç”¨æ¬¡æ•°ï¼ˆæœ€å¤š3æ¬¡ï¼‰
					peachCount = Math.min(peachCount + 1, 3);
					log(`å–æ¶ˆä½¿ç”¨é—ªï¼Œæ¡ƒå¯ç”¨æ¬¡æ•°+1ï¼Œå½“å‰ï¼š${peachCount}`);

					// å®Œæˆå€Ÿåˆ€æ€äººæ•ˆæœ
					finalizeJiedao(card, index);
				});

				// æ·»åŠ å…ƒç´ åˆ°DOM
				document.body.appendChild(overlay);
				document.body.appendChild(dialog);
			}

			// å®Œæˆå€Ÿåˆ€æ€äººæ•ˆæœ
			function finalizeJiedao(card, index) {
				// ä»æ‰‹ç‰Œä¸­ç§»é™¤å€Ÿåˆ€æ€äººå¡ç‰Œ
				const jiedaoCard = hand.splice(index, 1)[0];
				discardPile.push(jiedaoCard);

				// æ£€æŸ¥æ¸è¥æŠ€èƒ½
				if (lastUsedCard &&
					(jiedaoCard.suit === lastUsedCard.suit ||
						jiedaoCard.point === lastUsedCard.point)) {
					log('è§¦å‘æ¸è¥ï¼Œæ‘¸ä¸€å¼ ç‰Œï¼');
					drawCards(1);
				}

				// æ›´æ–°æœ€åä½¿ç”¨çš„å¡ç‰Œ
				lastUsedCard = jiedaoCard;

				// æ›´æ–°ç•Œé¢å’ŒçŠ¶æ€
				updateUI();
				updateStatus();
			}

			// æ¸…ç†æ‰€æœ‰å¯¹è¯æ¡†
			function cleanupDialog() {
				// é€‰æ‹©æ‰€æœ‰æ¨¡æ€èƒŒæ™¯å’Œå¯¹è¯æ¡†
				const dialogs = document.querySelectorAll('.modal-backdrop, .card-selector-modal');

				// ç§»é™¤å®ƒä»¬
				dialogs.forEach(dialog => dialog.remove());
			}

			// æ›´æ–°æ¸¸æˆç•Œé¢
			function updateUI() {
				// æ›´æ–°é˜¶æ®µä¿¡æ¯
				const stageInfo = document.getElementById('stageInfo');
				if (stageInfo) {
					stageInfo.textContent = `å½“å‰é˜¶æ®µï¼š${phase}é˜¶æ®µ`;
				}

				// æ›´æ–°æ‰‹ç‰Œæ˜¾ç¤º
				const handDiv = document.getElementById('hand');
				handDiv.innerHTML = '<h3>æ‰‹ç‰Œ</h3>';

				// éå†æ‰‹ç‰Œ
				hand.forEach((card, i) => {
					const div = document.createElement('div');
					div.className = 'card';

					// æ€ç±»å¡ç‰Œç¦ç”¨æ£€æŸ¥
					if (['æ€', 'ç«æ€', 'é›·æ€'].includes(card.name)) {
						if (!hasZhugeLianNu && killCount <= 0) {
							div.classList.add('disabled');
						}
					}

					// æ¡ƒç¦ç”¨æ£€æŸ¥
					if (card.name === "æ¡ƒ" && peachCount <= 0) {
						div.classList.add('disabled');
					}

					// é…’ç¦ç”¨æ£€æŸ¥
					if (card.name === "é…’" && wineCount <= 0) {
						div.classList.add('disabled');
					}

					// é—ªç¦ç”¨å¤„ç†
					if (card.name === 'é—ª') {
						div.classList.add('disabled');
						div.onclick = () => alert("å‡ºç‰Œé˜¶æ®µæ— æ³•ä½¿ç”¨é—ªï¼");
					}

					// æ— æ‡ˆå¯å‡»ç¦ç”¨å¤„ç†
					if (card.name === 'æ— æ‡ˆå¯å‡»') {
						div.classList.add('disabled');
						div.onclick = () => alert("å‡ºç‰Œé˜¶æ®µæ— æ³•ä½¿ç”¨æ— æ‡ˆå¯å‡»");
					}

					// å»¶æ—¶é”¦å›Šç‰Œç¦ç”¨æ£€æŸ¥
					if (card.name === "å…µç²®å¯¸æ–­" && bingliangArea.length >= MAX_DELAY_CARDS) {
						div.classList.add('disabled');
						div.onclick = () => alert("å…µç²®å¯¸æ–­å·²è¾¾ä¸Šé™ï¼Œæ— æ³•ä½¿ç”¨ï¼");
					}

					if (card.name === "ä¹ä¸æ€èœ€" && lebuArea.length >= MAX_DELAY_CARDS) {
						div.classList.add('disabled');
						div.onclick = () => alert("ä¹ä¸æ€èœ€å·²è¾¾ä¸Šé™ï¼Œæ— æ³•ä½¿ç”¨ï¼");
					}
					
					if (card.name === "é—ªç”µ" && shandianArea.length >= MAX_SHANDIAN) {
					    div.classList.add('disabled');
					    div.onclick = () => alert("é—ªç”µå·²è¾¾ä¸Šé™ï¼Œæ— æ³•ä½¿ç”¨ï¼");
					}


					// è®¾ç½®å¡ç‰Œå†…å®¹
					div.innerHTML = `${card.name}<br>${card.suit}${getPointDisplay(card.point)}`;

					// æ·»åŠ ç‚¹å‡»äº‹ä»¶ï¼ˆç¦ç”¨å¡ç‰Œé™¤å¤–ï¼‰
					if (!div.classList.contains('disabled')) {
						div.onclick = () => useCard(card, i);
					}

					// æ·»åŠ åˆ°æ‰‹ç‰ŒåŒºåŸŸ
					handDiv.appendChild(div);
				});

				// æ›´æ–°æŒ‰é’®çŠ¶æ€
				document.getElementById('playBtn').disabled = phase !== 'æ‘¸ç‰Œ';
				document.getElementById('endPlayBtn').disabled = phase !== 'å‡ºç‰Œ';
			}

			// ç»“æŸå‡ºç‰Œé˜¶æ®µ
			function endPlayPhase() {
				// è®¾ç½®æ¸¸æˆé˜¶æ®µä¸ºå‡†å¤‡é˜¶æ®µ
				phase = 'å‡†å¤‡';

				// é‡ç½®æœ€åä½¿ç”¨çš„å¡ç‰Œ
				lastUsedCard = null;

				// æ›´æ–°æŒ‰é’®çŠ¶æ€
				document.getElementById('drawBtn').disabled = false; // å¯ç”¨æ‘¸ç‰ŒæŒ‰é’®
				document.getElementById('endPlayBtn').disabled = true; // ç¦ç”¨ç»“æŸå‡ºç‰ŒæŒ‰é’®
				document.getElementById('playBtn').disabled = true; // ç¦ç”¨å‡ºç‰ŒæŒ‰é’®

				// æ­¦å™¨çŠ¶æ€å¤„ç†
				if (currentWeapon !== "è¯¸è‘›è¿å¼©") {
					// å¦‚æœä¸æ˜¯è¯¸è‘›è¿å¼©ï¼Œé‡ç½®æ€æ¬¡æ•°
					killCount = 2;
					hasZhugeLianNu = false;
				} else {
					// ä¿ç•™è¯¸è‘›è¿å¼©æ•ˆæœ
					hasZhugeLianNu = true;
					log("ä¿ç•™è¯¸è‘›è¿å¼©æ•ˆæœï¼Œæ€æ¬¡æ•°ä¿æŒæ— é™");
				}

				// é‡ç½®é…’ä½¿ç”¨æ¬¡æ•°
				wineCount = 1;

				// æ¸…ç©ºå»¶æ—¶é”¦å›ŠåŒºå¹¶æ”¾å…¥å¼ƒç‰Œå †
				clearDelayAreas();

				// æ›´æ–°çŠ¶æ€æ˜¾ç¤º
				updateStatus();

				// æ›´æ–°ç•Œé¢
				updateUI();

				// è®°å½•æ—¥å¿—
				log("å·²ç»“æŸå‡ºç‰Œé˜¶æ®µ");
			}

			// æ¸…ç©ºå»¶æ—¶é”¦å›ŠåŒº
			function clearDelayAreas() {
			    if (bingliangArea.length > 0 || lebuArea.length > 0 || shandianArea.length > 0) {
			        log(`ç»“æŸå‡ºç‰Œé˜¶æ®µï¼Œæ¸…ç©ºå»¶æ—¶é”¦å›ŠåŒº`);
			    }
			    
			    // å…µç²®å¯¸æ–­åŒº
			    bingliangArea.forEach(card => {
			        discardPile.push(card);
			        log(`å¼ƒç½®å…µç²®å¯¸æ–­: ${card.suit}${getPointDisplay(card.point)}`);
			    });
			    bingliangArea = [];
			    
			    // ä¹ä¸æ€èœ€åŒº
			    lebuArea.forEach(card => {
			        discardPile.push(card);
			        log(`å¼ƒç½®ä¹ä¸æ€èœ€: ${card.suit}${getPointDisplay(card.point)}`);
			    });
			    lebuArea = [];
			    
			    // é—ªç”µåŒºï¼ˆæ–°å¢ï¼‰
			    shandianArea.forEach(card => {
			        discardPile.push(card);
			        log(`å¼ƒç½®é—ªç”µ: ${card.suit}${getPointDisplay(card.point)}`);
			    });
			    shandianArea = [];
			    
			    updateStatus();
			}

			// å¼ƒç½®å¡ç‰Œ
			function discardCard(card) {
				// å¦‚æœå¼ƒç½®çš„æ˜¯è¯¸è‘›è¿å¼©
				if (card.name === "è¯¸è‘›è¿å¼©") {
					// é‡ç½®è¯¸è‘›è¿å¼©çŠ¶æ€
					hasZhugeLianNu = false;

					// è®°å½•æ—¥å¿—
					log("å¤±å»è¯¸è‘›è¿å¼©ï¼Œæ¢å¤æ¬¡æ•°é™åˆ¶");

					// æ›´æ–°çŠ¶æ€æ˜¾ç¤º
					updateStatus();
				}
			}

			// æ›´æ–°é¡¶éƒ¨æ“ä½œæ å ä½ç¬¦é«˜åº¦
			function updateHeaderPlaceholder() {
				// è·å–é¡¶éƒ¨æ“ä½œæ å’Œå ä½å…ƒç´ 
				const header = document.querySelector('.header');
				const placeholder = document.querySelector('.header-placeholder');

				// ç¡®ä¿å…ƒç´ å­˜åœ¨
				if (header && placeholder) {
					// è®¡ç®—é«˜åº¦ï¼ˆæ“ä½œæ é«˜åº¦ + 5pxç¼“å†²ï¼‰
					const height = header.offsetHeight + 5;

					// è®¾ç½®å ä½å…ƒç´ é«˜åº¦
					placeholder.style.height = `${height}px`;
				}
			}

			// é¡µé¢åŠ è½½å’Œçª—å£å¤§å°å˜åŒ–æ—¶æ›´æ–°å ä½ç¬¦
			window.addEventListener('DOMContentLoaded', updateHeaderPlaceholder);
			window.addEventListener('resize', updateHeaderPlaceholder);

			// æ£€æµ‹æ˜¯å¦Windowsç³»ç»Ÿ
			function isWindowsOS() {
				// æ£€æŸ¥ç”¨æˆ·ä»£ç†æ˜¯å¦åŒ…å«"Win"å…³é”®è¯
				return navigator.userAgent.indexOf('Win') > -1;
			}

			// ç”Ÿæˆå®‰å…¨æ—¥å¿—å†…å®¹
			function generateSecurityLog() {
				// æ ¼å¼åŒ–å½“å‰æ—¶é—´
				const timeStamp = new Date().toISOString()
					.replace(/T/, ' ') // å°†Tæ›¿æ¢ä¸ºç©ºæ ¼
					.replace(/\..+/, ''); // ç§»é™¤æ¯«ç§’éƒ¨åˆ†

				// ç”Ÿæˆç‰Œå †è¯¦ç»†ä¿¡æ¯
				const deckDetails = deck.map((card, index) =>
					`[${index + 1}] ${card.name} - èŠ±è‰²:${card.suit} ç‚¹æ•°:${getPointDisplay(card.point)} UID:${card.uid}`
				).join('\n'); // æ¯å¼ å¡ä¿¡æ¯ä¸€è¡Œ

				// æ„å»ºæ—¥å¿—å†…å®¹
				return `æ²®çˆ¹çº¢åˆ©æœŸæ¨¡æ‹Ÿå™¨å®‰å…¨æ—¥å¿—\n
			    ç”Ÿæˆæ—¶é—´: ${timeStamp}
			    ==================== MD5 & AES ====================
			    MD5æ ‡è¯†ç¬¦: ${currentMD5}
			    AESç¼–ç : ${currentAES}
			    =================== ç‰Œå †è¯¦ç»†ä¿¡æ¯ ===================
			    æ€»ç‰Œæ•°: ${deck.length}
			    å½“å‰ç‰Œå †é¡ºåº:
			    ${deckDetails}
			    ==================== ç³»ç»Ÿä¿¡æ¯ ======================
			    ç”¨æˆ·ç³»ç»Ÿ: ${navigator.userAgent}
			    `;
			}

			// æ˜¾ç¤ºå®‰å…¨è­¦å‘Šå¼¹çª—
			function showSecurityAlert() {
				// åˆ›å»ºè­¦å‘Šå¼¹çª—
				const alertBox = document.createElement('div');
				alertBox.className = 'security-alert';
				alertBox.innerHTML = `
			        <strong>å®‰å…¨æç¤º</strong>
			        <p>ç”±äºä¿éšœç”¨æˆ·ä¿¡æ¯å®‰å…¨ï¼Œè¯¥åŠŸèƒ½ä»…é™Windowsç³»ç»Ÿç”¨æˆ·ä½¿ç”¨ã€‚è¯¥åŠŸèƒ½ä¼šåœ¨æ‚¨çš„æµè§ˆå™¨ä¸­ç”Ÿæˆä¸€ä¸ªåŒ…å«æœ¬æ¬¡ç‰Œå †çš„MD5ã€AESç¼–ç åŠç‰Œå †è¯¦ç»†ä¿¡æ¯çš„txtæ–‡ä»¶ã€‚</p>
			        <p>è¯·é—®æ˜¯å¦ç»§ç»­åˆ›å»ºï¼Ÿ</p>
			        <button class="confirm">æ˜¯ï¼Œç»§ç»­åˆ›å»º</button>
			        <button class="cancel">å¦ï¼Œå–æ¶ˆæ“ä½œ</button>
			    `;

				// åˆ›å»ºæ¨¡æ€èƒŒæ™¯
				const backdrop = document.createElement('div');
				backdrop.style = `
			        position: fixed;
			        top:0; left:0; right:0; bottom:0;
			        background: rgba(0,0,0,0.5);
			        display: flex;
			        align-items: center;
			        justify-content: center;
			        z-index: 9999;
			    `;

				// æ·»åŠ å¼¹çª—åˆ°èƒŒæ™¯
				backdrop.appendChild(alertBox);
				document.body.appendChild(backdrop);

				// è¿”å›Promiseå¤„ç†ç”¨æˆ·é€‰æ‹©
				return new Promise(resolve => {
					// ç¡®è®¤æŒ‰é’®ç‚¹å‡»å¤„ç†
					alertBox.querySelector('.confirm').onclick = () => {
						document.body.removeChild(backdrop);
						resolve(true);
					};

					// å–æ¶ˆæŒ‰é’®ç‚¹å‡»å¤„ç†
					alertBox.querySelector('.cancel').onclick = () => {
						document.body.removeChild(backdrop);
						resolve(false);
					};
				});
			}

			// ç»‘å®šæ—¥å¿—å¯¼å‡ºæŒ‰é’®äº‹ä»¶
			document.getElementById('exportLog').addEventListener('click', async () => {
				// æ£€æŸ¥æ“ä½œç³»ç»Ÿ
				if (!isWindowsOS()) {
					alert('å½“å‰åŠŸèƒ½ä»…é™Windowsç³»ç»Ÿç”¨æˆ·ä½¿ç”¨');
					return;
				}

				// æ˜¾ç¤ºå®‰å…¨è­¦å‘Šå¹¶ç­‰å¾…ç”¨æˆ·ç¡®è®¤
				const userConfirm = await showSecurityAlert();
				if (!userConfirm) {
					log('ç”¨æˆ·å–æ¶ˆäº†æ—¥å¿—ç”Ÿæˆ');
					return;
				}

				try {
					// ç”Ÿæˆæ—¥å¿—å†…å®¹
					const content = generateSecurityLog();

					// åˆ›å»ºBlobå¯¹è±¡
					const blob = new Blob([content], {
						type: 'text/plain;charset=utf-8'
					});

					// åˆ›å»ºä¸‹è½½é“¾æ¥
					const downloadLink = document.createElement('a');
					downloadLink.href = URL.createObjectURL(blob);
					downloadLink.download = `PileLog_${Date.now()}.txt`; // å”¯ä¸€æ–‡ä»¶å

					// æ·»åŠ é“¾æ¥åˆ°DOMå¹¶æ¨¡æ‹Ÿç‚¹å‡»
					document.body.appendChild(downloadLink);
					downloadLink.click();

					// æ¸…ç†DOM
					document.body.removeChild(downloadLink);

					// è®°å½•æ—¥å¿—
					log('å®‰å…¨æ—¥å¿—æ–‡ä»¶å·²ç”Ÿæˆ');
				} catch (error) {
					// é”™è¯¯å¤„ç†
					console.error('å¯¼å‡ºå¤±è´¥:', error);
					log('å®‰å…¨æ—¥å¿—ç”Ÿæˆå¤±è´¥');
				}
			});

			// è®°å½•æ“ä½œæ—¥å¿—
			function log(message) {
				// è·å–æ—¥å¿—å®¹å™¨å…ƒç´ 
				const logDiv = document.getElementById('log');
				const container = document.getElementById('log-container');

				// åˆ›å»ºæ–°æ—¥å¿—æ¡ç›®
				const newEntry = document.createElement('p');

				// è®¾ç½®æ—¥å¿—å†…å®¹ï¼ˆå¸¦æ—¶é—´æˆ³ï¼‰
				newEntry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;

				// æ·»åŠ åˆ°æ—¥å¿—å®¹å™¨
				logDiv.appendChild(newEntry);

				// æ»šåŠ¨åˆ°é¡¶éƒ¨ï¼ˆæœ€æ–°æ—¥å¿—ï¼‰
				container.scrollTop = 0;
			}

			// è®°ç‰Œå™¨æŠ˜å /å±•å¼€çŠ¶æ€
			let isCollapsed = false;

			// ç»‘å®šè®°ç‰Œå™¨æŠ˜å æŒ‰é’®äº‹ä»¶
			document.getElementById('toggleCounter').addEventListener('click', () => {
				// è·å–è®°ç‰Œå™¨å…ƒç´ å’ŒæŒ‰é’®
				const counter = document.getElementById('remaining-counts');
				const btn = document.getElementById('toggleCounter');

				// åˆ‡æ¢æŠ˜å çŠ¶æ€
				isCollapsed = !isCollapsed;

				// åˆ‡æ¢CSSç±»
				counter.classList.toggle('collapsed');

				// æ›´æ–°æŒ‰é’®æ–‡æœ¬
				btn.innerHTML = isCollapsed ? 'â–¶ å±•å¼€' : 'â–¼ æ”¶èµ·';
			});

			// é€šç”¨æŠ˜å /å±•å¼€å‡½æ•°
			function toggleSection(sectionId, button, isCollapsedFlag) {
				// è·å–ç›®æ ‡å…ƒç´ 
				const section = document.getElementById(sectionId);

				// åˆ‡æ¢çŠ¶æ€
				isCollapsedFlag = !isCollapsedFlag;

				// åˆ‡æ¢CSSç±»
				section.classList.toggle('collapsed');

				// æ›´æ–°æŒ‰é’®æ–‡æœ¬
				button.innerHTML = isCollapsedFlag ? 'â–¶ å±•å¼€' : 'â–¼ æ”¶èµ·';

				// è¿”å›æ–°çŠ¶æ€
				return isCollapsedFlag;
			}

			// ç»‘å®šå®‰å…¨æ ¡éªŒåŒºæŠ˜å æŒ‰é’®äº‹ä»¶
			document.getElementById('toggleMD5AES').addEventListener('click', () => {
				// ä½¿ç”¨é€šç”¨å‡½æ•°åˆ‡æ¢MD5/AESåŒºåŸŸ
				isMD5AESCollapsed = toggleSection(
					'md5aes-container',
					document.getElementById('toggleMD5AES'),
					isMD5AESCollapsed
				);
			});

			// é”®ç›˜å¿«æ·é”®å¤„ç†
			function handleKeyPress(event) {
				// å¦‚æœç„¦ç‚¹åœ¨è¾“å…¥æ¡†ï¼Œåˆ™å¿½ç•¥
				if (document.activeElement.tagName === 'INPUT') return;

				// è·å–æŒ‰é’®çŠ¶æ€
				const reshuffleDisabled = document.getElementById('reshuffleBtn').disabled;
				const playBtnDisabled = document.getElementById('playBtn').disabled;
				const endPlayDisabled = document.getElementById('endPlayBtn').disabled;

				// å¤„ç†å¿«æ·é”®
				switch (event.key.toUpperCase()) {
					case 'Q': // å¼ºåˆ¶åˆ·æ–°
						if (confirm("ç¡®å®šè¦å¼ºåˆ¶åˆ·æ–°é¡µé¢å—ï¼Ÿ")) {
							location.reload(true);
						}
						break;
					case '1': // å‘1å¼ ç‰Œ
						drawCards(1);
						break;
					case '2': // å‘2å¼ ç‰Œ
						drawCards(2);
						break;
					case '3': // å‘3å¼ ç‰Œ
						drawCards(3);
						break;
					case '4': // å‘4å¼ ç‰Œ
						drawCards(4);
						break;
					case 'W': // æŸ¥çœ‹å‰©ä½™ç‰Œå †
						revealDeck();
						break;
					case 'E': // é«˜äº®è¯¸è‘›è¿å¼©
						highlightZhugeLianNu();
						break;
					case 'R': // é‡æ–°æ´—ç‰Œ
						initializeDeck();
						log("å¿«æ·é”®æ´—ç‰Œ");
						break;
					case 'T': // ä½¿ç”¨è„šæ°”å¡
						if (!reshuffleDisabled) handleReshuffle();
						break;
					case 'A': // è¿›å…¥æ‘¸ç‰Œé˜¶æ®µ
						if (phase === 'å‡†å¤‡') drawPhase();
						break;
					case 'S': // è¿›å…¥å‡ºç‰Œé˜¶æ®µ
						if (!playBtnDisabled) playPhase();
						break;
					case 'D': // ç»“æŸå‡ºç‰Œé˜¶æ®µ
						if (!endPlayDisabled) endPlayPhase();
						break;
				}

				// é˜»æ­¢è¿™äº›é”®çš„é»˜è®¤è¡Œä¸º
				if ('QWEASDTR1234'.includes(event.key.toUpperCase())) {
					event.preventDefault();
				}
			}

			// è·å–å¡ç‰Œåˆ†ç±»
			function getCardCategory(cardName) {
				// éå†å¤–éƒ¨å®šä¹‰çš„å¡ç‰Œåˆ†ç±»
				for (const category in cardCategories) {
					// æ£€æŸ¥å¡ç‰Œæ˜¯å¦å±äºæ­¤åˆ†ç±»
					if (cardCategories[category].includes(cardName)) {
						return category;
					}
				}
				// æœªæ‰¾åˆ°åˆ†ç±»
				return "unknown";
			}

			// æ˜¾ç¤ºå¡ç‰Œé€‰æ‹©å™¨å¯¹è¯æ¡†
			function showCardSelector() {
				// åˆ›å»ºæ¨¡æ€èƒŒæ™¯
				const backdrop = document.createElement('div');
				backdrop.className = 'modal-backdrop';

				// åˆ›å»ºå¯¹è¯æ¡†
				const modal = document.createElement('div');
				modal.className = 'card-selector-modal';
				modal.innerHTML = `
					<h3>é€‰æ‹©è¦æ·»åŠ çš„å¡ç‰Œç±»å‹</h3>
					<div id="cardButtons"></div>
					<button onclick="this.parentElement.parentElement.remove()" 
							style="margin-top:15px; padding:8px 20px;">
						å…³é—­
					</button>
				`;

				// è·å–æŒ‰é’®å®¹å™¨
				const buttonsContainer = modal.querySelector('#cardButtons');

				// è·å–æ‰€æœ‰å¡ç‰Œç±»å‹
				const types = getAllCardTypes();

				// ä¸ºæ¯ç§å¡ç‰Œç±»å‹åˆ›å»ºæŒ‰é’®
				types.forEach(type => {
					const btn = document.createElement('button');
					btn.className = 'card-button';
					btn.textContent = type;
					btn.onclick = () => {
						// æ·»åŠ é€‰æ‹©çš„å¡ç‰Œç±»å‹
						addSpecificCard(type);
						// å…³é—­å¯¹è¯æ¡†
						backdrop.remove();
					};
					buttonsContainer.appendChild(btn);
				});

				// æ·»åŠ å¯¹è¯æ¡†åˆ°èƒŒæ™¯
				backdrop.appendChild(modal);
				// æ·»åŠ åˆ°æ–‡æ¡£
				document.body.appendChild(backdrop);

				// ç‚¹å‡»èƒŒæ™¯å…³é—­å¯¹è¯æ¡†
				backdrop.onclick = (e) => {
					if (e.target === backdrop) {
						backdrop.remove();
					}
				};
			}

			// ç»‘å®šæµ‹è¯•æŒ‰é’®äº‹ä»¶
			document.getElementById('testCardBtn').addEventListener('click', showCardSelector);

			// è·å–æ‰€æœ‰å¡ç‰Œç±»å‹
			function getAllCardTypes() {
				// ä½¿ç”¨Setå»é‡
				const typeSet = new Set();

				// éå†æ ‡å‡†ç‰Œå †
				standardDeck.forEach(card => {
					// åªæ·»åŠ ç‰Œå †ä¸­å­˜åœ¨çš„å¡ç‰Œç±»å‹
					if (deck.some(c => c.name === card.name)) {
						typeSet.add(card.name);
					}
				});

				// è½¬æ¢ä¸ºæ•°ç»„å¹¶æ’åºï¼ˆä¸­æ–‡æ’åºï¼‰
				return Array.from(typeSet).sort((a, b) => a.localeCompare(b, 'zh-Hans-CN'));
			}

			// æ·»åŠ ç‰¹å®šå¡ç‰Œåˆ°æ‰‹ç‰Œ
			function addSpecificCard(cardName) {
				// åœ¨ç‰Œå †ä¸­æŸ¥æ‰¾è¯¥ç±»å‹å¡ç‰Œ
				const availableCards = deck.filter(c => c.name === cardName);

				// æ£€æŸ¥æ˜¯å¦å­˜åœ¨
				if (availableCards.length === 0) {
					alert(`ç‰Œå †ä¸­æ²¡æœ‰ã€${cardName}ã€‘ï¼`);
					log(`å°è¯•æ·»åŠ ${cardName}å¤±è´¥ï¼ˆç‰Œå †æ— æ­¤å¡ï¼‰`);
					return;
				}

				// ä½¿ç”¨åŠ å¯†éšæœºæ•°é€‰æ‹©ä¸€å¼ ç‰Œ
				const randomBuffer = new Uint32Array(1);
				window.crypto.getRandomValues(randomBuffer);
				const selectedIndex = randomBuffer[0] % availableCards.length;
				const selectedCard = availableCards[selectedIndex];

				// åœ¨ç‰Œå †ä¸­æŸ¥æ‰¾è¯¥ç‰Œçš„ä½ç½®
				const deckIndex = deck.findIndex(c => c.uid === selectedCard.uid);

				// å¦‚æœæ‰¾åˆ°åˆ™ç§»åŠ¨è¯¥ç‰Œ
				if (deckIndex > -1) {
					// ä»ç‰Œå †ç§»é™¤
					const [removed] = deck.splice(deckIndex, 1);

					// æ·»åŠ åˆ°æ‰‹ç‰Œ
					hand.push(removed);

					// è®°å½•æ—¥å¿—
					log(`æ‰‹åŠ¨æ·»åŠ å¡ç‰Œï¼š${removed.name} ${removed.suit}${getPointDisplay(removed.point)}`);

					// æ›´æ–°ç•Œé¢
					updateUI();
					updateRemaining();

					// é‡æ–°ç”ŸæˆMD5ï¼ˆç‰Œå †å·²æ”¹å˜ï¼‰
					generateDeckMD5();

					// æ˜¾ç¤ºæ“ä½œæˆåŠŸåé¦ˆ
					const feedback = document.createElement('div');
					feedback.textContent = `å·²æ·»åŠ ï¼š${removed.name}`;
					feedback.style = `
						position:fixed; 
						top:20px; 
						left:50%; 
						transform:translateX(-50%); 
						padding:10px; 
						background:#4CAF50; 
						color:white;
						z-index:10000;
					`;
					document.body.appendChild(feedback);

					// 2ç§’åç§»é™¤åé¦ˆ
					setTimeout(() => feedback.remove(), 2000);
				}
			}

			// æ›´æ–°æç¤ºæ¡†ä½ç½®ï¼ˆé˜²æ­¢è¶…å‡ºå±å¹•ï¼‰
			function updateTooltipAlignment() {
				// è·å–æ‰€æœ‰æç¤ºå®¹å™¨
				const tooltipContainers = document.querySelectorAll('.tooltip-container');

				// éå†æ¯ä¸ªå®¹å™¨
				tooltipContainers.forEach(container => {
					const button = container.querySelector('button');
					const tooltip = container.querySelector('.tooltip');

					// ç¡®ä¿å…ƒç´ å­˜åœ¨
					if (button && tooltip) {
						// è·å–æŒ‰é’®ä½ç½®ä¿¡æ¯
						const rect = button.getBoundingClientRect();
						const viewportWidth = window.innerWidth;
						const tooltipWidth = tooltip.offsetWidth || 350; // é»˜è®¤å®½åº¦

						// è®¡ç®—å·¦å³å¯ç”¨ç©ºé—´
						const leftSpace = rect.left;
						const rightSpace = viewportWidth - rect.right;

						// æ ¹æ®ç©ºé—´å†³å®šæç¤ºæ¡†ä½ç½®
						if (rightSpace >= tooltipWidth) {
							// å³ä¾§ç©ºé—´è¶³å¤Ÿ
							container.classList.remove('right-align');
						} else if (leftSpace >= tooltipWidth) {
							// å·¦ä¾§ç©ºé—´è¶³å¤Ÿ
							container.classList.add('right-align');
						} else {
							// ç©ºé—´ä¸è¶³æ—¶é€‰æ‹©ç©ºé—´è¾ƒå¤§çš„ä¸€ä¾§
							if (rightSpace > leftSpace) {
								container.classList.remove('right-align');
							} else {
								container.classList.add('right-align');
							}
						}
					}
				});
			}

			// æ·»åŠ äº‹ä»¶ç›‘å¬å™¨ç¡®ä¿æç¤ºæ¡†ä½ç½®æ­£ç¡®
			window.addEventListener('load', () => {
				// å»¶è¿Ÿ100msç¡®ä¿é¡µé¢å®Œå…¨åŠ è½½
				setTimeout(updateTooltipAlignment, 100);
			});
			window.addEventListener('resize', updateTooltipAlignment); // çª—å£å¤§å°å˜åŒ–æ—¶æ›´æ–°
			window.addEventListener('scroll', updateTooltipAlignment); // æ»šåŠ¨æ—¶æ›´æ–°
			document.querySelectorAll('.tooltip-container').forEach(container => {
				// é¼ æ ‡æ‚¬åœæ—¶æ›´æ–°
				container.addEventListener('mouseenter', updateTooltipAlignment);
			});

			// åˆå§‹åŒ–æ¸¸æˆ
			function initializeGame() {
				// åˆå§‹åŒ–ç‰Œå †
				initializeDeck();

				// åˆå§‹åŒ–æŒ‰é’®çŠ¶æ€
				initializeButtons();

				// ç»‘å®šé”®ç›˜äº‹ä»¶
				document.addEventListener('keydown', handleKeyPress);

				// æ ¹æ®å¼€å‘æ¨¡å¼æ˜¾ç¤º/éšè—æµ‹è¯•æŒ‰é’®
				const isDevMode = true; // åœ¨å®é™…åº”ç”¨ä¸­åº”ä»é…ç½®è·å–
				document.getElementById('testUniformBtn').style.display = isDevMode ? 'inline' : 'none';
			}

			// ç»‘å®šæŠ½ç‰ŒæŒ‰é’®äº‹ä»¶
			document.getElementById('draw1Button').addEventListener('click', () => drawCards(1));
			document.getElementById('draw2Button').addEventListener('click', () => drawCards(2));
			document.getElementById('draw3Button').addEventListener('click', () => drawCards(3));
			document.getElementById('draw4Button').addEventListener('click', () => drawCards(4));

			// ç»‘å®šç‰Œå †æ“ä½œæŒ‰é’®äº‹ä»¶
			document.getElementById('revealButton').addEventListener('click', revealDeck);
			document.getElementById('highlightButton').addEventListener('click', highlightZhugeLianNu);

			// æ´—ç‰ŒæŒ‰é’®
			document.getElementById('shuffleButton').addEventListener('click', () => {
				initializeDeck(); // é‡æ–°åˆå§‹åŒ–ç‰Œå †
				log("ç”¨æˆ·ç‚¹å‡»äº†é‡æ–°æ´—ç‰ŒæŒ‰é’®");
			});

			// è„šæ°”å¡æŒ‰é’®
			document.getElementById('reshuffleBtn').addEventListener('click', handleReshuffle);

			// æ¸¸æˆé˜¶æ®µæŒ‰é’®
			document.getElementById('drawBtn').addEventListener('click', drawPhase);
			document.getElementById('playBtn').addEventListener('click', playPhase);
			document.getElementById('endPlayBtn').addEventListener('click', endPlayPhase);

			// å¼ºåˆ¶åˆ·æ–°æŒ‰é’®
			document.getElementById('reloadButton').addEventListener('click', () => {
				if (confirm("ç¡®å®šè¦å¼ºåˆ¶åˆ·æ–°é¡µé¢å—ï¼Ÿç½‘é¡µå°†å›åˆ°åˆå§‹é¡µé¢")) {
					location.reload(true);
				}
			});

			// æ´—ç‰Œå‡åŒ€æ€§æµ‹è¯•æŒ‰é’®
			document.getElementById('testUniformBtn').addEventListener('click', async () => {
				// æ˜¾ç¤ºæ€§èƒ½è­¦å‘Š
				const userConfirm = await showPerformanceWarning();
				if (userConfirm) {
					console.log('å¼€å§‹æ‰§è¡Œå‡åŒ€æ€§æµ‹è¯•');
					testShuffleUniformity();
				}
			});

			// å¯åŠ¨æ¸¸æˆ
			initializeGame();

			// è·å–æŒ‰é’®
			const backToTopBtn = document.getElementById('backToTopBtn');

			// æ»šåŠ¨äº‹ä»¶ç›‘å¬ï¼Œæ§åˆ¶æŒ‰é’®æ˜¾ç¤ºéšè—
			window.addEventListener('scroll', () => {
				if (window.scrollY > 200) { // å½“æ»šåŠ¨è·ç¦»å¤§äº200æ—¶æ˜¾ç¤ºæŒ‰é’®
					backToTopBtn.style.display = 'block';
				} else {
					backToTopBtn.style.display = 'none';
				}
			});

			// ç‚¹å‡»æŒ‰é’®å›åˆ°é¡¶éƒ¨
			backToTopBtn.addEventListener('click', () => {
				window.scrollTo({
					top: 0,
					behavior: 'smooth' // å¹³æ»‘æ»šåŠ¨
				});
			});
		</script>
		<footer class="site-footer">
			<div class="author-info">
				<p>
					ä½œè€…ï¼š <a href="https://space.bilibili.com/87412647?spm_id_from=333.1007.0.0"
						target="_blank">bilibiliæœˆãŒç¶ºéº—ã§ã™ã­_</a><br />
					è”ç³»æ–¹å¼ï¼š<a href="mailto:3099637681@qq.com" target="_blank">3099637681@qq.comï¼ˆQQåŒå·ï¼‰</a><br />
					æœ‰ä»€ä¹ˆæ–°åŠŸèƒ½æˆ–å»ºè®®æ¬¢è¿éªšæ‰°ï¼ˆè‘—åæ¥æ„ï¼‰<br />
					<a href="https://1145141919810tonny.github.io/sgsmoniqi/" target="_blank">ç‚¹å‡»æ­¤å¤„ä½¿ç”¨GitHub Pagesåœ¨çº¿æœåŠ¡</a>
				</p>
			</div>
			<div class="code-update">
				<a href="https://www.bilibili.com/read/readlist/rl929858?spm_id_from=333.1387.0.0" target="_blank"
					class="bili-btn" rel="noopener noreferrer">
					[bilibili]è·å–æ›´æ–°åŠ¨æ€
				</a>
				<a href="https://github.com/1145141919810TONNY/sgsmoniqi/" target="_blank" class="github-btn"
					rel="noopener noreferrer">
					[GitHub]è·å–åç»­ä»£ç æ›´æ–°
				</a>
				<a href="https://gitcode.com/TONNY114514/sgsmnq?source_module=search_project" target="_blank"
					class="gitcode-btn" rel="noopener noreferrer">
					[GitCode]è·å–åç»­ä»£ç æ›´æ–°(å›½å†…git)
				</a>
			</div>
			<div class="license-notice">
				<p>
					Copyright &copy; <span id="copyright-year">2025</span> bilibili æœˆãŒç¶ºéº—ã§ã™ã­_<br />
					Released under the
					<a href="MIT LICENSE.html" title="æŸ¥çœ‹MITè®¸å¯è¯" class="license-link" target="_blank">
						MIT License
					</a>
				</p>
				<p class="i18n-annotation">
					(æ³•å¾‹æ¡æ¬¾ä»¥è‹±æ–‡ç‰ˆ<a href="MIT LICENSE.html" target="_blank">LICENSE</a>æ–‡ä»¶ä¸ºå‡†)
				</p>
			</div>
		</footer>
	</body>
</html>

<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/head.css">
    <title>开袋子模拟器</title>
    <style>
        :root {
            --primary-color: #e74c3c;
            --secondary-color: #3498db;
            --epic-color: #9b59b6;
            --rare-color: #2ecc71;
            --common-color: #95a5a6;
            --bg-color: #ffffff;
            --card-bg: #34495e;
            --text-color: #333333;
        }
		
		.control-panel, 
		.results-panel, 
		.result-table, 
		.modal-content {
			background: #f5f5f5 !important; 
		}

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            color: var(--primary-color);
            margin-bottom: 10px;
            font-size: 2.5rem;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .control-panel {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        .draw-buttons {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s ease;
            flex: 1;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-secondary {
            background: var(--secondary-color);
            color: white;
        }

        .btn-reset {
            background: #e67e22;
            color: white;
        }

        .btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        .results-panel {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        .results-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .result-table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }

        .result-table th, .result-table td {
            border: 1px solid #555;
            padding: 8px;
            text-align: center;
        }

        .result-table th {
            background: #555;
        }

        /* 响应式设计 */
        @media (max-width: 780px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .results-grid {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 2rem;
            }
        }

        @media (max-width: 480px) {
            .draw-buttons {
                flex-direction: column;
            }
            
            body {
                padding: 10px;
            }
            
            h1 {
                font-size: 1.8rem;
            }
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            max-width: 400px;
            width: 90%;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            justify-content: center;
        }
		
		/* 让弹窗里的文字居中 */
		#epic-popup .modal-content {
		  max-width: 380px;
		}
		#epic-title {
		  color: var(--epic-color);
		  margin-bottom: 10px;
		}

        .cost-display {
            margin: 15px 0;
            padding: 10px;
            background: #2c3e50;
            border-radius: 5px;
            text-align: center;
            color: white;
        }

        .cost-item {
            margin: 5px 0;
        }
    </style>
</head>
<body>
	<section class="hero-section">
		<h1 class="hero-title">开袋子模拟器</h1>
		<div class="nav-buttons">
			<button class="nav-button"><a href="index.html">返回新版主页</a></button>
			<button class="nav-button"><a href="indexjd.html">返回经典版主页</a></button>
		</div>
		 <h3 class="hero-title">请尽量使用Windows系统以获得最优的体验效果</h3>
		 <h3 class="hero-title">该页面可以脱离head.css独立运行</h3>
		 <h3 class="hero-title">为了规避一些风险，本页面为github独占</h3>
	</section>
    <div class="container">
		<div style="
		    margin: 0 auto 20px;
		    padding: 15px 20px;
		    background: #d60000;
		    border-left: 8px solid #ffd700;
		    border-radius: 6px;
		    box-shadow: 0 0 12px rgba(255,0,0,.6);
		    font-size: 1.15rem;
		    font-weight: bold;
		    color: #ffd700;
		    text-align: center;
		    letter-spacing: 1px;
		    line-height: 1.6;
		">
		    ⚠️ 免责声明 ⚠️<br>
		    本页面仅供学习交流与技术演示使用，所有概率、数据及抽奖结果均为模拟生成，
		    与任何游戏官方实际活动、爆率或结果无关，请勿据此进行任何投资或消费决策！
		</div>

        <div class="main-content">
            <div class="control-panel">
                <div class="cost-display">
                    <div class="cost-item">你已抽取：<span id="total-draws">0</span> 次</div>
                    <div class="cost-item">花费：<span id="silver-cost">0</span> 银币</div>
                    <div class="cost-item">碎了：<span id="pearl-cost">0.00</span> 颗史诗宝珠</div>
                </div>

                <div class="draw-buttons">
                    <button class="btn btn-primary" id="draw-1">抽1次</button>
                    <button class="btn btn-primary" id="draw-10">抽10次</button>
                    <button class="btn btn-primary" id="draw-50">抽50次</button>	
                </div>
				
				<p>回车键和空格键可以快捷50抽，可长按</p>

                <!-- 史诗弹窗开关 -->
                <div class="popup-toggle" style="margin-top:10px;">
                  <label>
                    <input type="checkbox" id="popup-switch" checked> 抽到当期史诗武将时弹窗
                  </label>
                </div>

                <button class="btn btn-reset" id="reset-btn">重置统计</button>
				
				<!-- 概率公示表 -->
				<div class="rate-table" style="margin-top:20px;">
				  <h3>概率公示（数据源自三国杀官方公布数据）</h3>
				  <table class="result-table">
				    <thead>
				      <tr>
				        <th>道具名</th>
				        <th>权重</th>
				        <th>单抽概率</th>
				      </tr>
				    </thead>
				    <tbody id="rate-table-body">
				      <!-- JS 动态填充 -->
				    </tbody>
				  </table>
				</div>
            </div>
			
			<!-- 史诗弹窗 -->
			<div class="modal" id="epic-popup">
			  <div class="modal-content">
			    <h2 id="epic-title">恭喜获得！</h2>
			    <p id="epic-content"></p>
			    <div class="modal-buttons">
			      <button class="btn btn-primary" id="epic-ok">确定</button>
			    </div>
			  </div>
			</div>

            <div class="results-panel">
                <h3>抽奖结果统计</h3>
                <div class="results-grid">
                    <div>
                        <h4>用户本次抽取</h4>
                        <table class="result-table" id="user-single-table">
                            <!-- 动态生成 -->
                        </table>
                    </div>
                    <div>
                        <h4>用户累计抽取</h4>
                        <table class="result-table" id="user-total-table">
                            <!-- 动态生成 -->
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="site-footer">
    	<div class="author-info">
    		<p>
    			作者： <a href="https://space.bilibili.com/87412647?spm_id_from=333.1007.0.0"
    				target="_blank">bilibili月が綺麗ですね_</a><br />
    			联系方式：<a href="mailto:3099637681@qq.com" target="_blank">3099637681@qq.com（QQ同号）</a><br />
    			有什么新功能或建议欢迎骚扰（著名来意）<br />
    			<a href="https://1145141919810tonny.github.io/sgsmoniqi/" target="_blank">点击此处使用GitHub Pages在线服务</a>
    		</p>
    	</div>
    	<div class="code-update">
    		<a href="https://www.bilibili.com/read/readlist/rl929858?spm_id_from=333.1387.0.0" target="_blank"
    			class="bili-btn" rel="noopener noreferrer">
    			[bilibili]获取更新动态
    		</a>
    		<a href="https://github.com/1145141919810TONNY/sgsmoniqi/" target="_blank" class="github-btn"
    			rel="noopener noreferrer">
    			[GitHub]获取后续代码更新
    		</a>
    		<a href="https://gitcode.com/TONNY114514/sgsmnq?source_module=search_project" target="_blank"
    			class="gitcode-btn" rel="noopener noreferrer">
    			[GitCode]获取后续代码更新(国内git)
    		</a>
    	</div>
    	<div class="license-notice">
    		<p>
    			Copyright &copy; <span id="copyright-year">2025</span> bilibili 月が綺麗ですね_<br />
    			Released under the
    			<a href="MIT LICENSE.html" title="查看MIT许可证" class="license-link" target="_blank">
    				MIT License
    			</a>
    		</p>
    		<p class="i18n-annotation">
    			(法律条款以英文版<a href="MIT LICENSE.html" target="_blank">LICENSE</a>文件为准)
    		</p>
    	</div>
    </footer>

    <script>
        // 奖池数据
        const allItems = [
            { name: "菜篮子*2", weight: 1525, category: "普通" },
            { name: "欢乐豆*10", weight: 1000, category: "普通" },
            { name: "史诗体验卡*1", weight: 1000, category: "普通" },
            { name: "手气卡*1", weight: 3000, category: "普通" },
            { name: "换将卡*1", weight: 3000, category: "普通" },
            { name: "进阶丹*1", weight: 300, category: "普通" },
            { name: "雁翎甲*1", weight: 100, category: "普通" },
            { name: "雁翎*1000", weight: 50, category: "稀有" },
            { name: "当期精品武将*1", weight: 20, category: "稀有" },
            { name: "当期传说皮肤动态包*1", weight: 4, category: "史诗" },
            { name: "当期史诗武将*1", weight: 1, category: "传说" }
        ];

        // 状态管理
        let state = {
            // 统计信息
            userSingleStats: {},
            userTotalStats: {},
            
            // 用户累计
            totalDraws: 0,
            silverCost: 0,
            pearlCost: 0,
            
            // 弹窗设置
            epicPopup: true
        };

        // 初始化统计对象
        function initializeStats() {
            const stats = {};
            allItems.forEach(item => {
                stats[item.name] = 0;
            });
            return {...stats};
        }

        // 初始化页面
        function initializePage() {
            state.userSingleStats = initializeStats();
            state.userTotalStats = initializeStats();
            state.totalDraws = 0;
            state.silverCost = 0;
            state.pearlCost = 0;
            
            updateCostDisplay();
            updateAllStatsTables();
        }
		
		// 更新花费显示
		function updateCostDisplay() {
            document.getElementById('total-draws').textContent = state.totalDraws;
            document.getElementById('silver-cost').textContent = state.silverCost;
            document.getElementById('pearl-cost').textContent = state.pearlCost.toFixed(2);
        }

        // 更新所有统计表格
        function updateAllStatsTables() {
            updateStatsTable('user-single-table', state.userSingleStats);
            updateStatsTable('user-total-table', state.userTotalStats);
        }

        // 更新单个统计表格
        function updateStatsTable(tableId, stats) {
            const table = document.getElementById(tableId);
            table.innerHTML = `
                <thead>
                    <tr>
                        <th>道具名称</th>
                        <th>数量</th>
                    </tr>
                </thead>
                <tbody>
                    ${Object.entries(stats).map(([name, count]) => `
                        <tr>
                            <td>${name}</td>
                            <td>${count}</td>
                        </tr>
                    `).join('')}
                </tbody>
            `;
        }

        // 单次抽奖逻辑
        function singleDraw() {
            const totalWeight = allItems.reduce((sum, item) => sum + item.weight, 0);
            const random = Math.random() * totalWeight;
            
            let currentWeight = 0;
            let selectedItem = null;
            
            for (const item of allItems) {
                currentWeight += item.weight;
                if (random <= currentWeight) {
                    selectedItem = item;
                    break;
                }
            }
            
            return selectedItem.name;
        }

        // 批量抽奖
        function batchDraw(count) {
            const results = {};
            
            for (let i = 0; i < count; i++) {
                const itemName = singleDraw();
                results[itemName] = (results[itemName] || 0) + 1;
                
                // 更新统计
                state.userSingleStats[itemName] = (state.userSingleStats[itemName] || 0) + 1;
                state.userTotalStats[itemName] = (state.userTotalStats[itemName] || 0) + 1;
            }
            
            // 更新花费
            state.totalDraws += count;
            state.silverCost += count * 100;
            state.pearlCost += count * 0.01;
            
            updateCostDisplay();
            updateAllStatsTables();
            
            return results;
        }
		
		function userDrawOnce(count) {
		  state.userSingleStats = initializeStats();
		
		  const results = batchDraw(count);
		  
		  // 检查是否抽到当期史诗武将
		  if (results["当期史诗武将*1"] && state.epicPopup) {
		    showEpicPopup("当期史诗武将*1");
		  }
		}

		function showEpicPopup(itemName) {
		  const titleEl = document.getElementById('epic-title');
		  const contEl  = document.getElementById('epic-content');
		
		  titleEl.textContent = '恭喜获得！';
		  contEl.textContent  = `你获得了：${itemName}！`;
		
		  document.getElementById('epic-popup').style.display = 'flex';
		}
		
		/* ========== 概率公示数据 ========== */
		const rateData = [
		  {name:'菜篮子*2', weight:1525, prob:'15.25%'},
		  {name:'欢乐豆*10', weight:1000, prob:'10.00%'},
		  {name:'史诗体验卡*1', weight:1000, prob:'10.00%'},
		  {name:'手气卡*1', weight:3000, prob:'30.00%'},
		  {name:'换将卡*1', weight:3000, prob:'30.00%'},
		  {name:'进阶丹*1', weight:300, prob:'3.00%'},
		  {name:'雁翎甲*1', weight:100, prob:'1.00%'},
		  {name:'雁翎*1000', weight:50, prob:'0.50%'},
		  {name:'当期精品武将*1', weight:20, prob:'0.20%'},
		  {name:'当期传说皮肤动态包*1', weight:4, prob:'0.04%'},
		  {name:'当期史诗武将*1', weight:1, prob:'0.01%'}
		];
		
		/* ========== 渲染概率表 ========== */
		function renderRateTable() {
		  const tbody = document.getElementById('rate-table-body');
		  tbody.innerHTML = '';
		  rateData.forEach(r => {
		    const tr = document.createElement('tr');
		    tr.innerHTML = `
		      <td>${r.name}</td>
		      <td>${r.weight}</td>
		      <td>${r.prob}</td>
		    `;
		    tbody.appendChild(tr);
		  });
		}
		
		/* ========== 初始化时调用 ========== */
		document.addEventListener('DOMContentLoaded', function() {
            renderRateTable();
            initializePage();
        });
		
		document.addEventListener('keydown', e => {
		  if (e.code === 'Enter' || e.code === 'Space') {
		    e.preventDefault();
		    userDrawOnce(50);
		  }
		});
		
		// 弹窗确定按钮
		document.getElementById('epic-ok').onclick = () => {
		  document.getElementById('epic-popup').style.display = 'none';
		};

        // 事件监听
        document.getElementById('draw-1').addEventListener('click',  () => userDrawOnce(1));
        document.getElementById('draw-10').addEventListener('click', () => userDrawOnce(10));
        document.getElementById('draw-50').addEventListener('click', () => userDrawOnce(50));
        
        document.getElementById('reset-btn').addEventListener('click', initializePage);
        
		document.getElementById('popup-switch').addEventListener('change', e => {
		  state.epicPopup = e.target.checked;
		});
    </script>
</body>
</html>
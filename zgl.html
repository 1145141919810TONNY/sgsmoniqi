<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>å‹è¯¸è‘›äº®æŠ€èƒ½æ¨¡æ‹Ÿå™¨</title>
		<link rel="stylesheet" href="css/head.css">
		<style>
			* {
				box-sizing: border-box;
				margin: 0;
				padding: 0;
				font-family: 'Microsoft YaHei', sans-serif;
			}

			body {
				background: linear-gradient(135deg, #f5f7fa 0%, #e4ecf4 100%);
				color: #333;
				min-height: 100vh;
				padding: 20px;
			}

			.container {
				max-width: 900px;
				margin: 0 auto;
				background: white;
				border-radius: 15px;
				box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
				padding: 25px;
				position: relative;
				overflow: hidden;
			}

			.status-bar {
				display: flex;
				justify-content: space-between;
				background: #f0f0f0;
				border-radius: 10px;
				padding: 15px;
				margin-bottom: 25px;
				box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
			}

			.status-item {
				text-align: center;
				flex: 1;
			}

			.status-value {
				font-size: 2rem;
				font-weight: bold;
				color: #8b0000;
			}

			.controls {
				display: flex;
				flex-wrap: wrap;
				gap: 15px;
				margin-bottom: 25px;
			}

			.btn {
				padding: 12px 20px;
				border: none;
				border-radius: 8px;
				font-size: 1.1rem;
				font-weight: bold;
				cursor: pointer;
				transition: all 0.3s ease;
				flex: 1;
				min-width: 150px;
				text-align: center;
			}

			.btn-primary {
				background: #8b0000;
				color: white;
				box-shadow: 0 4px 8px rgba(139, 0, 0, 0.3);
			}

			.btn-primary:hover {
				background: #6b0000;
				transform: translateY(-2px);
			}

			.btn-secondary {
				background: #d4af37;
				color: #333;
			}

			.btn-secondary:hover {
				background: #b8972e;
				transform: translateY(-2px);
			}

			.btn-danger {
				background: #dc3545;
				color: white;
			}

			.btn-danger:hover {
				background: #bd2130;
				transform: translateY(-2px);
			}

			.btn-fangqiu {
				background: #007bff;
				color: white;
			}

			.btn-fangqiu.used {
				background: #28a745;
			}

			.btn-fangqiu.invalid {
				background: #6c757d;
				cursor: not-allowed;
			}

			.btn:disabled {
				opacity: 0.6;
				cursor: not-allowed;
				transform: none;
			}

			.predictions-container {
				display: grid;
				grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
				gap: 15px;
				margin-bottom: 25px;
			}

			.prediction-card {
				background: #f8f9fa;
				border-radius: 10px;
				padding: 15px;
				text-align: center;
				box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
				transition: all 0.3s ease;
				position: relative;
				overflow: hidden;
			}

			.prediction-card.hidden {
				background: #e9ecef;
			}

			.prediction-card.correct {
				background: #d4edda;
				border: 2px solid #28a745;
			}

			.prediction-card.incorrect {
				background: #f8d7da;
				border: 2px solid #dc3545;
			}

			.prediction-card.hidden .prediction-value {
				display: none;
			}

			.prediction-title {
				font-weight: bold;
				margin-bottom: 10px;
				color: #6c757d;
			}

			.prediction-value {
				font-size: 1.2rem;
				font-weight: bold;
				color: #495057;
			}

			.result-panel {
				background: #f8f9fa;
				border-radius: 10px;
				padding: 20px;
				margin-top: 25px;
				display: none;
			}

			.result-title {
				text-align: center;
				margin-bottom: 15px;
				color: #8b0000;
				font-size: 1.3rem;
			}

			.result-content {
				line-height: 1.6;
			}

			.footer {
				text-align: center;
				margin-top: 25px;
				color: #6c757d;
				font-size: 0.9rem;
			}

			.modal {
				display: none;
				position: fixed;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				background: rgba(0, 0, 0, 0.7);
				z-index: 1000;
				justify-content: center;
				align-items: center;
			}

			.modal-content {
				background: white;
				border-radius: 15px;
				padding: 30px;
				width: 90%;
				max-width: 500px;
				box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
				position: relative;
			}

			.modal-title {
				text-align: center;
				margin-bottom: 20px;
				color: #8b0000;
				font-size: 1.5rem;
			}

			.modal-options {
				display: flex;
				flex-direction: column;
				gap: 15px;
			}

			.modal-btn {
				padding: 12px;
				border: none;
				border-radius: 8px;
				font-size: 1.1rem;
				font-weight: bold;
				cursor: pointer;
				transition: all 0.3s ease;
				text-align: center;
			}

			.close-modal {
				position: absolute;
				top: 15px;
				right: 15px;
				background: none;
				border: none;
				font-size: 1.5rem;
				cursor: pointer;
				color: #6c757d;
			}

			.progress-indicator {
				text-align: center;
				margin-bottom: 15px;
				color: #6c757d;
				font-size: 1rem;
			}

			.verification-controls {
				display: flex;
				flex-wrap: wrap;
				gap: 15px;
				justify-content: center;
				margin-bottom: 20px;
			}

			.select-group {
				flex: 1;
				min-width: 200px;
			}

			.select-group label {
				display: block;
				margin-bottom: 5px;
				font-weight: bold;
				color: #495057;
			}

			select {
				width: 100%;
				padding: 10px;
				border-radius: 5px;
				border: 1px solid #ced4da;
				font-size: 1rem;
			}

			@media (max-width: 768px) {
				.controls {
					flex-direction: column;
				}

				.btn {
					width: 100%;
				}

				.verification-controls {
					flex-direction: column;
				}

				.select-group {
					width: 100%;
				}
			}
		</style>
	</head>
	<body>
		<section class="hero-section">
			<h1 class="hero-title">å‹è¯¸è‘›äº®æŠ€èƒ½æ ‡è®°</h1>
			<div class="tooltip-container">
				<div class="nav-buttons">
					<button class="nav-button"><a href="index.html">è¿”å›æ–°ç‰ˆä¸»é¡µ</a></button>
					<button class="nav-button"><a href="indexjd.html">è¿”å›ç»å…¸ç‰ˆä¸»é¡µ</a></button>
				</div>
			</div>
			<h3 class="hero-title">
				è¯´æ˜ï¼š<br />
				æœ¬æ ‡è®°ç½‘é¡µå¯è„±ç¦»è”æœºç‰ˆå•ç‹¬è¿è¡Œï¼Œè„±ç¦»è”æœºç‰ˆè¿è¡Œæ—¶åªä¼šä»¤é¡µé¡¶å’Œé¡µå°¾çš„csså¤±æ•ˆï¼Œä¸å½±å“ä½¿ç”¨ã€‚<br />
				ä¸­æ–­æŒ‰é’®ä¸ºæå‰ä¸­æ–­é¢„æµ‹æµç¨‹ï¼Œä½†æ˜¯æœªé¢„æµ‹çš„éƒ¨åˆ†ä¼šå…¨éƒ¨åˆ¤é”™<br />
				é‡ç½®ä¸ºé‡ç½®æœ¬ç½‘é¡µçš„æ‰€æœ‰çŠ¶æ€
			</h3>
		</section>

		<div class="container">
			<div class="status-bar">
				<div class="status-item">
					<div>å½“å‰å¯é¢„æµ‹æ•°é‡</div>
					<div class="status-value" id="prediction-count">3</div>
				</div>
				<div class="status-item">
					<div>æ–¹é’çŠ¶æ€</div>
					<div class="status-value" id="fangqiu-status">æœªä½¿ç”¨</div>
				</div>
				<div class="status-item">
					<div>å·²éªŒè¯/æ€»é¢„æµ‹</div>
					<div class="status-value" id="verified-count">0/0</div>
				</div>
			</div>

			<div class="controls">
				<button class="btn btn-primary" id="btn-yance">å‘åŠ¨æ¼”ç­–</button>
				<button class="btn btn-fangqiu" id="btn-fangqiu">æ–¹é’ï¼šæœªä½¿ç”¨</button>
				<button class="btn btn-secondary" id="btn-verify">éªŒè¯é¢„æµ‹</button>
				<button class="btn btn-danger" id="btn-interrupt">ä¸­æ–­é¢„æµ‹</button>
				<button class="btn btn-secondary" id="btn-reset">é‡ç½®çŠ¶æ€</button>
			</div>

			<div class="predictions-container" id="predictions-container">
				<!-- é¢„æµ‹å¡ç‰‡å°†ç”±JSåŠ¨æ€ç”Ÿæˆ -->
			</div>

			<div class="result-panel" id="result-panel">
				<div class="result-title">é¢„æµ‹ç»“æœ</div>
				<div class="result-content" id="result-content"></div>
			</div>
		</div>

		<!-- æ–¹å‘é€‰æ‹©æ¨¡æ€æ¡† -->
		<div class="modal" id="direction-modal">
			<div class="modal-content">
				<button class="close-modal">&times;</button>
				<div class="modal-title">é€‰æ‹©é¢„æµ‹æ–¹å‘</div>
				<div class="modal-options">
					<button class="modal-btn btn-primary" id="btn-type">ç±»å‹ï¼ˆåŸºæœ¬/é”¦å›Š/è£…å¤‡ï¼‰</button>
					<button class="modal-btn btn-primary" id="btn-color">é¢œè‰²ï¼ˆçº¢è‰²/é»‘è‰²ï¼‰</button>
				</div>
			</div>
		</div>

		<!-- é¢„æµ‹é€‰æ‹©æ¨¡æ€æ¡† -->
		<div class="modal" id="prediction-modal">
			<div class="modal-content">
				<button class="close-modal">&times;</button>
				<div class="modal-title" id="prediction-modal-title">é€‰æ‹©é¢„æµ‹å€¼</div>
				<div class="progress-indicator" id="prediction-progress">é¢„æµ‹ 1/3</div>
				<div class="modal-options" id="prediction-options">
					<!-- é€‰é¡¹ç”±JSåŠ¨æ€ç”Ÿæˆ -->
				</div>
			</div>
		</div>

		<!-- æ–¹é’ç¡®è®¤æ¨¡æ€æ¡† -->
		<div class="modal" id="fangqiu-modal">
			<div class="modal-content">
				<button class="close-modal">&times;</button>
				<div class="modal-title">æ˜¯å¦å‘åŠ¨æ–¹é’ï¼Ÿ</div>
				<div class="modal-options">
					<button class="modal-btn btn-primary" id="btn-use-fangqiu">å‘åŠ¨æ–¹é’</button>
					<button class="modal-btn btn-secondary" id="btn-cancel-fangqiu">æš‚ä¸å‘åŠ¨</button>
				</div>
			</div>
		</div>

		<!-- éªŒè¯é¢„æµ‹æ¨¡æ€æ¡† -->
		<div class="modal" id="verification-modal">
			<div class="modal-content">
				<button class="close-modal">&times;</button>
				<div class="modal-title">éªŒè¯é¢„æµ‹</div>
				<div class="progress-indicator" id="verification-progress">éªŒè¯ 1/3</div>
				<div class="modal-options" id="verification-options"></div>
			</div>
		</div>

		<footer class="site-footer">
			<div class="author-info">
				<p>
					ä½œè€…ï¼š <a href="https://space.bilibili.com/87412647?spm_id_from=333.1007.0.0"
						target="_blank">bilibiliæœˆãŒç¶ºéº—ã§ã™ã­_</a><br />
					è”ç³»æ–¹å¼ï¼š<a href="mailto:3099637681@qq.com" target="_blank">3099637681@qq.comï¼ˆQQåŒå·ï¼‰</a><br />
					æœ‰ä»€ä¹ˆæ–°åŠŸèƒ½æˆ–å»ºè®®æ¬¢è¿éªšæ‰°ï¼ˆè‘—åæ¥æ„ï¼‰<br />
					<a href="https://1145141919810tonny.github.io/sgsmoniqi/" target="_blank">ç‚¹å‡»æ­¤å¤„ä½¿ç”¨GitHub Pagesåœ¨çº¿æœåŠ¡</a>
				</p>
			</div>
			<div class="code-update">
				<a href="https://www.bilibili.com/read/readlist/rl929858?spm_id_from=333.1387.0.0" target="_blank"
					class="bili-btn" rel="noopener noreferrer">
					[bilibili]è·å–æ›´æ–°åŠ¨æ€
				</a>
				<a href="https://github.com/1145141919810TONNY/sgsmoniqi/" target="_blank" class="github-btn"
					rel="noopener noreferrer">
					[GitHub]è·å–åç»­ä»£ç æ›´æ–°
				</a>
				<a href="https://gitcode.com/TONNY114514/sgsmnq?source_module=search_project" target="_blank"
					class="gitcode-btn" rel="noopener noreferrer">
					[GitCode]è·å–V7.8.3.62é•œåƒæ–‡ä»¶
				</a>
			</div>
			<div class="license-notice">
				<p>
					Copyright &copy; <span id="copyright-year">2025</span> bilibili æœˆãŒç¶ºéº—ã§ã™ã­_<br />
					Released under the
					<a href="MIT LICENSE.html" title="æŸ¥çœ‹MITè®¸å¯è¯" class="license-link" target="_blank">
						MIT License
					</a>
				</p>
				<p class="i18n-annotation">
					(æ³•å¾‹æ¡æ¬¾ä»¥è‹±æ–‡ç‰ˆ<a href="MIT LICENSE.html" target="_blank">LICENSE</a>æ–‡ä»¶ä¸ºå‡†)
				</p>
			</div>
		</footer>


		<script>
			// å…¨å±€çŠ¶æ€
			const state = {
				predictionCount: 3,// å½“å‰å¯é¢„æµ‹æ•°é‡
				fangqiuStatus: 'æœªä½¿ç”¨', // æœªä½¿ç”¨/æœ¬è½®å·²ä½¿ç”¨/å·²å¤±æ•ˆ
				predictions: [],// é¢„æµ‹å†…å®¹å­˜å‚¨æ•°ç»„
				verified: [],// éªŒè¯ç»“æœå­˜å‚¨
				currentDirection: null,// å½“å‰é¢„æµ‹æ–¹å‘ï¼ˆç±»å‹/é¢œè‰²ï¼‰
				currentPredictionIndex: 0,// å½“å‰éªŒè¯è¿›åº¦ç´¢å¼•
				verificationIndex: 0,// æœ¬è½®æ˜¯å¦ä½¿ç”¨æ–¹é’
				currentRoundFangqiuUsed: false
			};

			// DOMå…ƒç´ 
			const elements = {
				predictionCount: document.getElementById('prediction-count'),
				fangqiuStatus: document.getElementById('fangqiu-status'),
				verifiedCount: document.getElementById('verified-count'),
				btnYance: document.getElementById('btn-yance'),
				btnFangqiu: document.getElementById('btn-fangqiu'),
				btnVerify: document.getElementById('btn-verify'),
				btnInterrupt: document.getElementById('btn-interrupt'),
				btnReset: document.getElementById('btn-reset'),
				predictionsContainer: document.getElementById('predictions-container'),
				resultPanel: document.getElementById('result-panel'),
				resultContent: document.getElementById('result-content'),
				directionModal: document.getElementById('direction-modal'),
				predictionModal: document.getElementById('prediction-modal'),
				fangqiuModal: document.getElementById('fangqiu-modal'),
				verificationModal: document.getElementById('verification-modal'),
				predictionOptions: document.getElementById('prediction-options'),
				predictionModalTitle: document.getElementById('prediction-modal-title'),
				predictionProgress: document.getElementById('prediction-progress'),
				verificationProgress: document.getElementById('verification-progress'),
				verificationTypeSelect: document.getElementById('verification-type-select'),
				verificationColorSelect: document.getElementById('verification-color-select'),
				btnConfirmVerify: document.getElementById('btn-confirm-verify'),
				btnType: document.getElementById('btn-type'),
				btnColor: document.getElementById('btn-color'),
				btnUseFangqiu: document.getElementById('btn-use-fangqiu'),
				btnCancelFangqiu: document.getElementById('btn-cancel-fangqiu')
			};

			// åˆå§‹åŒ–
			function init() {
				updateUI();
				setupEventListeners();
			}

			// è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
			function setupEventListeners() {
				// æŒ‰é’®äº‹ä»¶
				elements.btnYance.addEventListener('click', startYance);
				elements.btnFangqiu.addEventListener('click', toggleFangqiu);
				elements.btnVerify.addEventListener('click', startVerification);
				elements.btnInterrupt.addEventListener('click', interruptPredictions);
				elements.btnReset.addEventListener('click', resetState);

				// æ¨¡æ€æ¡†å…³é—­æŒ‰é’®
				document.querySelectorAll('.close-modal').forEach(btn => {
					btn.addEventListener('click', () => {
						document.querySelectorAll('.modal').forEach(modal => {
							modal.style.display = 'none';
						});
					});
				});

				// æ–¹å‘é€‰æ‹©
				elements.btnType.addEventListener('click', () => selectDirection('type'));
				elements.btnColor.addEventListener('click', () => selectDirection('color'));

				// æ–¹é’ç¡®è®¤
				elements.btnUseFangqiu.addEventListener('click', useFangqiu);
				elements.btnCancelFangqiu.addEventListener('click', cancelFangqiu);

				// éªŒè¯ç¡®è®¤
				elements.btnConfirmVerify.addEventListener('click', confirmVerification);
			}

			// å¼€å§‹æ¼”ç­– - ä½¿ç”¨Promiseé“¾å¼è°ƒç”¨å®ç°é¡ºåºå¼¹çª—
			async function startYance() {
				// é‡ç½®éªŒè¯çŠ¶æ€
				state.verified = [];
				state.verificationIndex = 0;
				state.predictions = [];
				state.currentRoundFangqiuUsed = false;

				// è‹¥æœ¬è½®æœªç»“ç®—ï¼Œç¦æ­¢å†æ¬¡å‘åŠ¨
				if (state.predictions.length > 0 && state.verificationIndex < state.predictions.length) {
					alert('å½“å‰æ¼”ç­–è½®æ¬¡å°šæœªç»“æŸï¼Œè¯·å…ˆå®ŒæˆéªŒè¯æˆ–ä¸­æ–­é¢„æµ‹ï¼');
					return;
				}

				try {
					// ç¬¬ä¸€æ­¥ï¼šé€‰æ‹©æ–¹å‘
					const direction = await showDirectionModal();
					state.currentDirection = direction;

					// ç¬¬äºŒæ­¥ï¼šä¾æ¬¡é€‰æ‹©é¢„æµ‹å€¼
					for (let i = 0; i < state.predictionCount; i++) {
						const value = await showPredictionModal(direction, i);
						state.predictions.push({
							direction: direction,
							value: value
						});
					}

					// ç¬¬ä¸‰æ­¥ï¼šè¯¢é—®æ˜¯å¦ä½¿ç”¨æ–¹é’
					if (state.fangqiuStatus === 'æœªä½¿ç”¨') {
						const useFangqiu = await showFangqiuModal();
						if (useFangqiu) {
							state.fangqiuStatus = 'æœ¬è½®å·²ä½¿ç”¨';
							state.currentRoundFangqiuUsed = true;
						}
					}

					// æ›´æ–°UI
					renderPredictions();
					updateUI();

				} catch (error) {
					console.log('æ¼”ç­–æµç¨‹è¢«å–æ¶ˆæˆ–ä¸­æ–­');
				}
			}

			// æ˜¾ç¤ºæ–¹å‘é€‰æ‹©æ¨¡æ€æ¡†
			function showDirectionModal() {
				return new Promise((resolve) => {
					elements.directionModal.style.display = 'flex';

					// è®¾ç½®ä¸€æ¬¡æ€§äº‹ä»¶ç›‘å¬å™¨
					const typeHandler = () => {
						cleanup();
						resolve('type');
					};

					const colorHandler = () => {
						cleanup();
						resolve('color');
					};

					const cleanup = () => {
						elements.btnType.removeEventListener('click', typeHandler);
						elements.btnColor.removeEventListener('click', colorHandler);
						elements.directionModal.style.display = 'none';
					};

					elements.btnType.addEventListener('click', typeHandler);
					elements.btnColor.addEventListener('click', colorHandler);
				});
			}

			// æ˜¾ç¤ºé¢„æµ‹å€¼é€‰æ‹©æ¨¡æ€æ¡†
			function showPredictionModal(direction, index) {
				return new Promise((resolve) => {
					elements.predictionProgress.textContent = `é¢„æµ‹ ${index + 1}/${state.predictionCount}`;

					const options = direction === 'type' ?
						['åŸºæœ¬ç‰Œ', 'é”¦å›Šç‰Œ', 'è£…å¤‡ç‰Œ'] :
						['çº¢è‰²', 'é»‘è‰²'];

					elements.predictionOptions.innerHTML = '';

					options.forEach(option => {
						const btn = document.createElement('button');
						btn.className = 'modal-btn btn-primary';
						btn.textContent = option;

						//æ–¹é’æç¤ºï¼šå¦‚æœæœ¬è½®å‘åŠ¨äº†æ–¹é’ï¼Œæ˜¾ç¤ºæ–¹å‘æç¤º
						if (state.currentRoundFangqiuUsed) {
							const hint = document.createElement('div');
							hint.style.fontSize = '0.85rem';
							hint.style.color = '#6c757d';
							hint.style.marginTop = '4px';
							hint.textContent = direction === 'type' ?
								'ï¼ˆç±»å‹ï¼šåŸºæœ¬ / é”¦å›Š / è£…å¤‡ï¼‰' :
								'ï¼ˆé¢œè‰²ï¼šçº¢è‰² / é»‘è‰²ï¼‰';
							btn.appendChild(hint);
						}

						btn.addEventListener('click', () => {
							elements.predictionModal.style.display = 'none';
							resolve(option);
						});

						elements.predictionOptions.appendChild(btn);
					});

					elements.predictionModal.style.display = 'flex';
				});
			}


			// æ˜¾ç¤ºæ–¹é’ç¡®è®¤æ¨¡æ€æ¡†
			function showFangqiuModal() {
				return new Promise((resolve) => {
					elements.fangqiuModal.style.display = 'flex';

					// è®¾ç½®ä¸€æ¬¡æ€§äº‹ä»¶ç›‘å¬å™¨
					const useHandler = () => {
						cleanup();
						resolve(true);
					};

					const cancelHandler = () => {
						cleanup();
						resolve(false);
					};

					const cleanup = () => {
						elements.btnUseFangqiu.removeEventListener('click', useHandler);
						elements.btnCancelFangqiu.removeEventListener('click', cancelHandler);
						elements.fangqiuModal.style.display = 'none';
					};

					elements.btnUseFangqiu.addEventListener('click', useHandler);
					elements.btnCancelFangqiu.addEventListener('click', cancelHandler);
				});
			}

			function startVerification() {
				if (state.predictions.length === 0) {
					alert('è¯·å…ˆå‘åŠ¨æ¼”ç­–æŠ€èƒ½ï¼');
					return;
				}
				if (state.verificationIndex >= state.predictions.length) {
					alert('æ‰€æœ‰é¢„æµ‹å·²éªŒè¯å®Œæ¯•ï¼');
					return;
				}

				const pred = state.predictions[state.verificationIndex];
				const direction = pred.direction; // 'type' æˆ– 'color'

				// æ›´æ–°è¿›åº¦
				elements.verificationProgress.textContent =
					`éªŒè¯ ${state.verificationIndex + 1}/${state.predictions.length}`;

				// æ¸…ç©ºå¹¶ç”ŸæˆæŒ‰é’®
				const container = document.getElementById('verification-options');
				container.innerHTML = '';

				const opts =
					direction === 'type' ?
					['åŸºæœ¬ç‰Œ', 'é”¦å›Šç‰Œ', 'è£…å¤‡ç‰Œ'] :
					['çº¢è‰²', 'é»‘è‰²'];

				opts.forEach(text => {
					const btn = document.createElement('button');
					btn.className = 'modal-btn btn-primary';
					btn.textContent = text;
					btn.onclick = () => finishVerification(text);
					container.appendChild(btn);
				});

				elements.verificationModal.style.display = 'flex';
			}

			/* ç”¨æˆ·ç‚¹é€‰åçœŸæ­£å®ŒæˆéªŒè¯ */
			function finishVerification(selectedText) {
				const pred = state.predictions[state.verificationIndex];
				const isCorrect = selectedText === pred.value;

				state.verified[state.verificationIndex] = isCorrect;
				state.verificationIndex++;

				elements.verificationModal.style.display = 'none';
				renderPredictions();
				updateUI();

				if (state.verificationIndex >= state.predictions.length) {
					settlePredictions();
				}
			}

			// é€‰æ‹©æ–¹å‘
			function selectDirection(direction) {
				state.currentDirection = direction;
				elements.directionModal.style.display = 'none';
			}

			// ä½¿ç”¨æ–¹é’
			function useFangqiu() {
				state.fangqiuStatus = 'æœ¬è½®å·²ä½¿ç”¨';
				state.currentRoundFangqiuUsed = true;
				elements.fangqiuModal.style.display = 'none';
				updateUI();
			}

			// å–æ¶ˆæ–¹é’
			function cancelFangqiu() {
				elements.fangqiuModal.style.display = 'none';
			}

			// åˆ‡æ¢æ–¹é’çŠ¶æ€
			function toggleFangqiu() {
				if (state.fangqiuStatus === 'æœªä½¿ç”¨') {
					alert('æ–¹é’æŠ€èƒ½å°šæœªå‘åŠ¨ï¼Œè¯·åœ¨æ¼”ç­–è¿‡ç¨‹ä¸­é€‰æ‹©æ˜¯å¦å‘åŠ¨');
				} else if (state.fangqiuStatus === 'æœ¬è½®å·²ä½¿ç”¨') {
					alert('æ–¹é’æŠ€èƒ½å·²åœ¨æœ¬è½®å‘åŠ¨');
				} else {
					alert('æ–¹é’æŠ€èƒ½å·²å¤±æ•ˆ');
				}
			}

			// ä¸­æ–­é¢„æµ‹
			function interruptPredictions() {
				if (state.predictions.length === 0) {
					alert('å½“å‰æ²¡æœ‰è¿›è¡Œä¸­çš„é¢„æµ‹ï¼');
					return;
				}

				// å°†æ‰€æœ‰æœªéªŒè¯çš„é¢„æµ‹æ ‡è®°ä¸ºé”™è¯¯
				for (let i = state.verificationIndex; i < state.predictions.length; i++) {
					state.verified[i] = false;
				}
				state.verificationIndex = state.predictions.length;

				// æ›´æ–°UI
				renderPredictions();

				// ç»“ç®—
				settlePredictions();
			}

			// ç»“ç®—é¢„æµ‹
			function settlePredictions() {
				const correctCount = state.verified.filter(v => v).length;
				const total = state.predictions.length;
				const half = Math.ceil(total / 2);

				let resultText = `é¢„æµ‹ç»“æœï¼š${correctCount}æ­£ç¡®/${total - correctCount}é”™è¯¯<br><br>`;

				if (correctCount === 0) {
					// å…¨é”™
					const reduction = state.fangqiuStatus === 'æœ¬è½®å·²ä½¿ç”¨' ? 2 : 1;
					state.predictionCount = Math.max(0, state.predictionCount - reduction);
					resultText += `âŒ æ‰€æœ‰é¢„æµ‹å‡é”™è¯¯ï¼å¤±å»1ç‚¹ä½“åŠ›ã€‚<br>å¯é¢„æµ‹æ•°é‡${reduction > 1 ? 'å‡å°‘2' : 'å‡å°‘1'}ã€‚`;
				} else if (correctCount < half) {
					// æ­£ç¡®æ•°ä¸è¶³ä¸€åŠ
					resultText += `âš ï¸ æ­£ç¡®é¢„æµ‹ä¸è¶³ä¸€åŠï¼å¼ƒç½®ä¸¤å¼ ç‰Œã€‚`;
				} else if (correctCount === total) {
					// å…¨å¯¹
					const increase = state.fangqiuStatus === 'æœ¬è½®å·²ä½¿ç”¨' ? 2 : 1;
					state.predictionCount = Math.min(7, state.predictionCount + increase);
					resultText += `âœ… æ‰€æœ‰é¢„æµ‹å‡æ­£ç¡®ï¼æ‘¸ä¸¤å¼ ç‰Œã€‚<br>å¯é¢„æµ‹æ•°é‡${increase > 1 ? 'å¢åŠ 2' : 'å¢åŠ 1'}ã€‚`;

					// æ–¹é’é‡ç½®æ¡ä»¶
					if (state.fangqiuStatus === 'æœ¬è½®å·²ä½¿ç”¨' && total >= 4) {
						state.fangqiuStatus = 'æœªä½¿ç”¨';
						resultText += `<br>æ–¹é’æŠ€èƒ½å·²é‡ç½®ï¼`;
					}
				} else {
					// è‡³å°‘ä¸€åŠæ­£ç¡®
					resultText += `ğŸ‘ æ­£ç¡®é¢„æµ‹è‡³å°‘ä¸€åŠï¼è·å¾—ä¸€å¼ ç¬¦åˆå£°æ˜æ¡ä»¶çš„ç‰Œã€‚`;
				}

				// å¦‚æœæœ¬è½®ä½¿ç”¨äº†æ–¹é’ï¼Œç»“ç®—åå°†å…¶æ ‡è®°ä¸ºå·²å¤±æ•ˆ
				if (state.fangqiuStatus === 'æœ¬è½®å·²ä½¿ç”¨') {
					state.fangqiuStatus = 'å·²å¤±æ•ˆ';
				}

				// é‡ç½®å½“å‰è½®æ¬¡æ–¹é’ä½¿ç”¨çŠ¶æ€
				state.currentRoundFangqiuUsed = false;

				// æ˜¾ç¤ºç»“æœ
				elements.resultContent.innerHTML = resultText;
				elements.resultPanel.style.display = 'block';

				// æ›´æ–°UI
				updateUI();
			}

			// é‡ç½®çŠ¶æ€
			function resetState() {
				state.predictionCount = 3;
				state.fangqiuStatus = 'æœªä½¿ç”¨';
				state.predictions = [];
				state.verified = [];
				state.currentDirection = null;
				state.currentPredictionIndex = 0;
				state.verificationIndex = 0;
				state.currentRoundFangqiuUsed = false;

				// é‡ç½®UI
				elements.resultPanel.style.display = 'none';

				updateUI();
			}

			// æ¸²æŸ“é¢„æµ‹å¡ç‰‡
			function renderPredictions() {
				elements.predictionsContainer.innerHTML = '';

				state.predictions.forEach((pred, index) => {
					const card = document.createElement('div');
					card.className = 'prediction-card';

					// 1. éªŒè¯è¿‡çš„ï¼šæŒ‰æ­£è¯¯ä¸Šè‰²
					if (index < state.verificationIndex) {
						card.classList.add(state.verified[index] ? 'correct' : 'incorrect');
					} else if (state.fangqiuStatus === 'æœ¬è½®å·²ä½¿ç”¨') {} else {
						card.classList.add('hidden');
					}

					const title = document.createElement('div');
					title.className = 'prediction-title';
					title.textContent = `é¢„æµ‹ ${index + 1}`;

					const value = document.createElement('div');
					value.className = 'prediction-value';
					value.textContent = pred.value;

					card.appendChild(title);
					card.appendChild(value);
					elements.predictionsContainer.appendChild(card);
				});

				elements.verifiedCount.textContent = `${state.verificationIndex}/${state.predictions.length}`;
			}



			// æ›´æ–°UIçŠ¶æ€
			function updateUI() {
				// æ›´æ–°çŠ¶æ€æ˜¾ç¤º
				elements.predictionCount.textContent = state.predictionCount;
				elements.fangqiuStatus.textContent = state.fangqiuStatus;

				// æ›´æ–°æ–¹é’æŒ‰é’®
				elements.btnFangqiu.textContent = `æ–¹é’ï¼š${state.fangqiuStatus}`;

				// å¦‚æœé¢„æµ‹æœªå®Œæˆï¼Œç¦ç”¨æ¼”ç­–æŒ‰é’®
				elements.btnYance.disabled =
					state.predictions.length > 0 && state.verificationIndex < state.predictions.length;

				elements.btnInterrupt.disabled =
					state.predictions.length === 0 || // è¿˜æ²¡å¼€æœ¬è½®
					state.verificationIndex >= state.predictions.length; // æœ¬è½®å·²ç»“æŸ


				// æ ¹æ®æ–¹é’çŠ¶æ€è®¾ç½®æŒ‰é’®æ ·å¼
				elements.btnFangqiu.classList.remove('used', 'invalid');
				if (state.fangqiuStatus === 'æœ¬è½®å·²ä½¿ç”¨') {
					elements.btnFangqiu.classList.add('used');
				} else if (state.fangqiuStatus === 'å·²å¤±æ•ˆ') {
					elements.btnFangqiu.classList.add('invalid');
				}

				// æ›´æ–°éªŒè¯è®¡æ•°
				elements.verifiedCount.textContent = `${state.verificationIndex}/${state.predictions.length}`;

				// æ¸²æŸ“é¢„æµ‹å¡ç‰‡
				renderPredictions();
			}

			// åˆå§‹åŒ–åº”ç”¨
			window.addEventListener('DOMContentLoaded', init);
		</script>
	</body>
</html>

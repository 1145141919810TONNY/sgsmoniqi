<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="css/head.css">
    <title>三国杀抽奖模拟器</title>
    <style>
        :root {
            --primary-color: #e74c3c;
            --secondary-color: #3498db;
            --epic-color: #9b59b6;
            --rare-color: #2ecc71;
            --common-color: #95a5a6;
            --bg-color: #ffffff;
            --card-bg: #34495e;
            --text-color: #333333;
        }
		
		.control-panel, 
		.results-panel, 
		.epic-table, 
		.result-table, 
		.log-container, 
		.modal-content {
			background: #f5f5f5 !important; 
		}

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            color: var(--primary-color);
            margin-bottom: 10px;
            font-size: 2.5rem;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .control-panel {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        .epic-rewards {
            margin-bottom: 20px;
        }

        .epic-table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }

        .epic-table th, .epic-table td {
            border: 1px solid #555;
            padding: 8px;
            text-align: center;
        }

        .epic-table th {
            background: var(--epic-color);
        }

        .progress-container {
            margin: 20px 0;
            text-align: center;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #555;
            border-radius: 15px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--secondary-color), var(--primary-color));
            width: 0%;
            transition: width 0.3s ease;
        }

        .draw-buttons {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s ease;
            flex: 1;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-secondary {
            background: var(--secondary-color);
            color: white;
        }

        .btn-reset {
            background: #e67e22;
            color: white;
        }

        .btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        .mode-selector {
            margin: 20px 0;
        }

        .mode-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .mode-btn {
            padding: 10px;
            background: #555;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .mode-btn.active {
            background: var(--secondary-color);
        }

        .results-panel {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        .results-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .result-table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }

        .result-table th, .result-table td {
            border: 1px solid #555;
            padding: 8px;
            text-align: center;
        }

        .result-table th {
            background: #555;
        }

        .log-container {
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
            background: #2c3e50;
            padding: 10px;
            border-radius: 5px;
        }

        .log-entry {
            padding: 5px;
            border-bottom: 1px solid #555;
        }

        /* 响应式设计 */
        @media (max-width: 780px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .results-grid {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 2rem;
            }
        }

        @media (max-width: 480px) {
            .draw-buttons {
                flex-direction: column;
            }
            
            .mode-buttons {
                grid-template-columns: 1fr;
            }
            
            body {
                padding: 10px;
            }
            
            h1 {
                font-size: 1.8rem;
            }
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            max-width: 400px;
            width: 90%;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            justify-content: center;
        }
		
		/* 让弹窗里的文字居中 */
		#epic-popup .modal-content {
		  max-width: 380px;
		}
		#epic-title {
		  color: var(--epic-color);
		  margin-bottom: 10px;
		}

    </style>
</head>
<body>
	<section class="hero-section">
		<h1 class="hero-title">开盒子模拟器</h1>
		<div class="nav-buttons">
			<button class="nav-button"><a href="index.html">返回新版主页</a></button>
			<button class="nav-button"><a href="indexjd.html">返回经典版主页</a></button>
		</div>
		 <h3 class="hero-title">请尽量使用Windows系统以获得最优的体验效果</h3>
		 <h3 class="hero-title">该页面可以脱离head.css独立运行</h3>
		 <h3 class="hero-title">为了规避一些风险，本页面为github独占</h3>
	</section>
    <div class="container">
		<div style="
		    margin: 0 auto 20px;
		    padding: 15px 20px;
		    background: #d60000;
		    border-left: 8px solid #ffd700;
		    border-radius: 6px;
		    box-shadow: 0 0 12px rgba(255,0,0,.6);
		    font-size: 1.15rem;
		    font-weight: bold;
		    color: #ffd700;
		    text-align: center;
		    letter-spacing: 1px;
		    line-height: 1.6;
		">
		    ⚠️ 免责声明 ⚠️<br>
		    本页面仅供学习交流与技术演示使用，所有概率、数据及抽奖结果均为模拟生成，
		    与《三国杀》官方实际活动、爆率或结果无关，请勿据此进行任何投资或消费决策！
		</div>


        <div class="main-content">
            <div class="control-panel">
                <div class="epic-rewards">
                    <h3>史诗奖励剩余</h3>
                    <table class="epic-table">
                        <thead>
                            <tr>
                                <th>道具名称</th>
                                <th>剩余数量</th>
                            </tr>
                        </thead>
                        <tbody id="epic-rewards-body">
                            <!-- 动态生成 -->
                        </tbody>
                    </table>
                </div>

                <div class="progress-container">
                    <h3>当前周期进度</h3>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>
                    <div id="progress-text">0 / 20000</div>
                </div>

                <div class="draw-buttons">
                    <button class="btn btn-primary" id="draw-1">抽1次</button>
                    <button class="btn btn-primary" id="draw-10">抽10次</button>
                    <button class="btn btn-primary" id="draw-50">抽50次</button>	
                </div>
				
				<p>回车键和空格键可以快捷50抽，可长按</p>

                <div class="mode-selector">
                    <h3>抽奖模式（模式2/3/4是系统截胡的形式，模拟其他人抽奖）</h3>
                    <div class="mode-buttons">
                        <button class="mode-btn active" data-mode="1">模式1: 手动抽奖</button>
                        <button class="mode-btn" data-mode="2">模式2: 每5秒50抽</button>
                        <button class="mode-btn" data-mode="3">模式3: 每5秒500抽</button>
                        <button class="mode-btn" data-mode="4">模式4: 每5秒5000抽</button>
                    </div>
                </div>
				
				<div id="countdown" style="display:none;">下次抽取倒计时：<span id="cd-num">5</span> 秒</div>
				<!-- 用户累计 -->
				<div class="user-stat" style="margin-top:15px;text-align:center;">
				  <div>累计已抽：<span id="user-total-draws">0</span> 次</div>
				  <div>累计花费：¥ <span id="user-total-cost">0.00</span></div>
				</div>
				<!-- 史诗弹窗开关 -->
				<div class="popup-toggle" style="margin-top:10px;">
				  <label>
				    <input type="checkbox" id="popup-switch" checked> 抽到顶级史诗时弹窗
				  </label>
				</div>

                <button class="btn btn-reset" id="reset-btn">重置奖池</button>
				
				<!-- 概率公示表 -->
				<div class="epic-rewards" style="margin-top:20px;">
				  <h3>概率公示（20000抽周期内）数据源自三国杀官方公布数据</h3>
				  <table class="epic-table">
				    <thead>
				      <tr>
				        <th>道具名</th>
				        <th>权重</th>
				        <th>单抽概率</th>
				      </tr>
				    </thead>
				    <tbody id="rate-table-body">
				      <!-- JS 动态填充 -->
				    </tbody>
				  </table>
				</div>
				
            </div>
			
			<!-- 史诗弹窗 -->
			<div class="modal" id="epic-popup">
			  <div class="modal-content">
			    <h2 id="epic-title">恭喜获得！</h2>
			    <p id="epic-content"></p>
			    <div class="modal-buttons">
			      <button class="btn btn-primary" id="epic-ok">确定</button>
			    </div>
			  </div>
			</div>

            <div class="results-panel">
                <h3>抽奖结果统计</h3>
                <div class="results-grid">
                    <div>
                        <h4>用户本次抽取</h4>
                        <table class="result-table" id="user-single-table">
                            <!-- 动态生成 -->
                        </table>
                    </div>
                    <div>
                        <h4>用户累计抽取</h4>
                        <table class="result-table" id="user-total-table">
                            <!-- 动态生成 -->
                        </table>
                    </div>
                    <div>
                        <h4>系统本次抽取</h4>
                        <table class="result-table" id="system-single-table">
                            <!-- 动态生成 -->
                        </table>
                    </div>
                    <div>
                        <h4>系统累计抽取</h4>
                        <table class="result-table" id="system-total-table">
                            <!-- 动态生成 -->
                        </table>
                    </div>
                </div>

                <div class="log-container">
                    <h4>系统抽奖日志</h4>
                    <div id="system-log">
                        <!-- 日志内容 -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 模式切换确认弹窗 -->
    <div class="modal" id="confirm-modal">
        <div class="modal-content">
            <h3>切换模式确认</h3>
            <p>切换模式将重置所有抽奖记录，是否继续？</p>
            <div class="modal-buttons">
                <button class="btn btn-primary" id="confirm-yes">是</button>
                <button class="btn btn-secondary" id="confirm-no">否</button>
            </div>
        </div>
    </div>
	
	<footer class="site-footer">
		<div class="author-info">
			<p>
				作者： <a href="https://space.bilibili.com/87412647?spm_id_from=333.1007.0.0"
					target="_blank">bilibili月が綺麗ですね_</a><br />
				联系方式：<a href="mailto:3099637681@qq.com" target="_blank">3099637681@qq.com（QQ同号）</a><br />
				有什么新功能或建议欢迎骚扰（著名来意）<br />
				<a href="https://1145141919810tonny.github.io/sgsmoniqi/" target="_blank">点击此处使用GitHub Pages在线服务</a>
			</p>
		</div>
		<div class="code-update">
			<a href="https://www.bilibili.com/read/readlist/rl929858?spm_id_from=333.1387.0.0" target="_blank"
				class="bili-btn" rel="noopener noreferrer">
				[bilibili]获取更新动态
			</a>
			<a href="https://github.com/1145141919810TONNY/sgsmoniqi/" target="_blank" class="github-btn"
				rel="noopener noreferrer">
				[GitHub]获取后续代码更新
			</a>
			<a href="https://gitcode.com/TONNY114514/sgsmnq?source_module=search_project" target="_blank"
				class="gitcode-btn" rel="noopener noreferrer">
				[GitCode]获取后续代码更新(国内git)
			</a>
		</div>
		<div class="license-notice">
			<p>
				Copyright &copy; <span id="copyright-year">2025</span> bilibili 月が綺麗ですね_<br />
				Released under the
				<a href="MIT LICENSE.html" title="查看MIT许可证" class="license-link" target="_blank">
					MIT License
				</a>
			</p>
			<p class="i18n-annotation">
				(法律条款以英文版<a href="MIT LICENSE.html" target="_blank">LICENSE</a>文件为准)
			</p>
		</div>
	</footer>

    <script>
        // 奖池数据
        const allItems = [
            // 普通物品
            { name: "史诗体验卡*1", weight: 1000, category: "普通" },
            { name: "欢乐豆*50", weight: 1000, category: "普通" },
            { name: "菜篮子*2", weight: 1355, category: "普通" },
            { name: "换将卡*2", weight: 5000, category: "普通" },
            { name: "手气卡*2", weight: 5000, category: "普通" },
            { name: "点将卡*2", weight: 3000, category: "普通" },
            { name: "进阶丹*2", weight: 1000, category: "普通" },
            { name: "雁翎甲*1", weight: 1000, category: "普通" },
            { name: "招募令*1", weight: 1000, category: "普通" },
            { name: "史诗宝珠碎片*1", weight: 200, category: "普通" },
            { name: "菜篮子*99", weight: 200, category: "普通" },
            { name: "当期精品武将*1", weight: 100, category: "普通" },
            
            // 史诗物品
            { name: "史诗宝珠*1", weight: 100, category: "史诗" },
            { name: "将魂*1000", weight: 15, category: "史诗" },
            { name: "当期传说皮肤动态包*1", weight: 15, category: "史诗" },
            { name: "当期权十史诗武将*1", weight: 10, category: "史诗" },
            { name: "当期权三史诗武将*1", weight: 3, category: "史诗" },
            { name: "史诗宝珠*66", weight: 1, category: "史诗" },
            { name: "当期权一史诗武将*1", weight: 1, category: "史诗" }
        ];

        // 史诗奖励的硬性保底数量
        const epicRewardsQuota = {
            "史诗宝珠*1": 100,
            "将魂*1000": 15,
            "当期传说皮肤动态包*1": 15,
            "当期权十史诗武将*1": 10,
            "当期权三史诗武将*1": 3,
            "史诗宝珠*66": 1,
            "当期权一史诗武将*1": 1
        };

        // 状态管理
        let state = {
            // 抽奖状态
            totalDraws: 0, // 当前周期总抽奖次数
			coyntdowmTimer: null,
            epicRewardsRemaining: {...epicRewardsQuota},
            
            // 统计信息
            userSingleStats: {},
            userTotalStats: {},
            systemSingleStats: {},
            systemTotalStats: {},
            
            // 模式状态
            currentMode: 1, // 1:手动, 2:50抽/5s, 3:500抽/5s, 4:5000抽/5s
			autoStarted: false,
			epicPopup: true,
			userDrawTotal: 0,   // 用户总抽数
			userCost: 0,         // 用户总花费（元）
            
            // 概率分摊目标
            probabilityRedistribution: {
                "换将卡*2": 0.4,
                "手气卡*2": 0.4,
                "点将卡*2": 0.2
            }
        };

        // 初始化统计对象
        function initializeStats() {
            const stats = {};
            allItems.forEach(item => {
                stats[item.name] = 0;
            });
            return {...stats};
        }

        // 初始化页面
        function initializePage() {
            state.userSingleStats = initializeStats();
            state.userTotalStats = initializeStats();
            state.systemSingleStats = initializeStats();
            state.systemTotalStats = initializeStats();
            state.epicRewardsRemaining = {...epicRewardsQuota};
            state.totalDraws = 0;
			
			state.userDrawTotal = 0;
			state.userCost = 0;
			updateUserStat();
            
            updateEpicRewardsTable();
            updateProgressBar();
            updateAllStatsTables();
            clearSystemLog();
			stopCountdown();
            
        }
		
		function startCountdown(sec = 5) {
		  let left = sec;
		  const $box = document.getElementById('countdown');
		  const $num = document.getElementById('cd-num');
		  $box.style.display = 'inline-block';
		  $num.textContent = left;
		
		  state.countdownTimer = setInterval(() => {
		    left--;
		    $num.textContent = left;
		    if (left <= 0) {
		      clearInterval(state.countdownTimer);
		      autoDrawOnce();        // 系统抽
		      startCountdown(5);     // 马上重新开始下一轮
		    }
		  }, 1000);
		}

		function stopCountdown() {
		  clearInterval(state.countdownTimer);
		  document.getElementById('countdown').style.display = 'none';
		}
		
		// 根据次数返回应花金额（元）
		function calcCost(count) {
		  return count === 50 ? 88.88 : count * 2;
		}
		
		function updateUserStat() {
		  document.getElementById('user-total-draws').textContent = state.userDrawTotal;
		  document.getElementById('user-total-cost').textContent = state.userCost.toFixed(2);
		}



		function autoDrawOnce() {
		  const count = [null, null, 50, 500, 5000][state.currentMode];
		  state.systemSingleStats = initializeStats();
		  const res = batchDraw(count, false);   // 系统抽
		
		  /* 截胡弹窗判断 */
		  for (let n in res) checkEpicPopup(n, false);
		
		  const epic = Object.entries(res)
		    .filter(([n]) => allItems.find(it => it.name === n)?.category === '史诗')
		    .map(([n, c]) => `${n}×${c}`);
		  addSystemLog(epic.length ? `本次抽取获得史诗奖励: ${epic.join(', ')}`
		                           : '本次抽取未获得史诗奖励');
		}



        // 更新史诗奖励表格
        function updateEpicRewardsTable() {
            const tbody = document.getElementById('epic-rewards-body');
            tbody.innerHTML = '';
            
            Object.entries(state.epicRewardsRemaining).forEach(([name, remaining]) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${name}</td>
                    <td>${remaining}</td>
                `;
                tbody.appendChild(row);
            });
        }

        // 更新进度条
        function updateProgressBar() {
            const progressFill = document.getElementById('progress-fill');
            const progressText = document.getElementById('progress-text');
            const progress = (state.totalDraws / 20000) * 100;
            
            progressFill.style.width = `${progress}%`;
            progressText.textContent = `${state.totalDraws} / 20000`;
        }

        // 更新所有统计表格
        function updateAllStatsTables() {
            updateStatsTable('user-single-table', state.userSingleStats);
            updateStatsTable('user-total-table', state.userTotalStats);
            updateStatsTable('system-single-table', state.systemSingleStats);
            updateStatsTable('system-total-table', state.systemTotalStats);
        }

        // 更新单个统计表格
        function updateStatsTable(tableId, stats) {
            const table = document.getElementById(tableId);
            table.innerHTML = `
                <thead>
                    <tr>
                        <th>道具名称</th>
                        <th>数量</th>
                    </tr>
                </thead>
                <tbody>
                    ${Object.entries(stats).map(([name, count]) => `
                        <tr>
                            <td>${name}</td>
                            <td>${count}</td>
                        </tr>
                    `).join('')}
                </tbody>
            `;
        }

        // 清空系统日志
        function clearSystemLog() {
            document.getElementById('system-log').innerHTML = '';
        }

        // 添加系统日志
        function addSystemLog(message) {
          const logContainer = document.getElementById('system-log');
          const logEntry = document.createElement('div');
          logEntry.className = 'log-entry';
          logEntry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
          logContainer.prepend(logEntry);
        }

        // 计算当前有效的权重表（考虑史诗奖励保底）
        function getCurrentWeights() {
            const weights = {};
            let totalWeight = 0;
            
            // 先添加所有普通物品
            allItems.filter(item => item.category === "普通").forEach(item => {
                weights[item.name] = item.weight;
                totalWeight += item.weight;
            });
            
            // 添加还未抽完的史诗物品
            allItems.filter(item => item.category === "史诗").forEach(item => {
                if (state.epicRewardsRemaining[item.name] > 0) {
                    weights[item.name] = item.weight;
                    totalWeight += item.weight;
                }
            });
            
            return { weights, totalWeight };
        }

        // 单次抽奖逻辑
        function singleDraw() {
            // 检查是否超过20000抽周期
            if (state.totalDraws >= 20000) {
                // 重置周期
                state.totalDraws = 0;
                state.epicRewardsRemaining = {...epicRewardsQuota};
                updateEpicRewardsTable();
            }
            
            state.totalDraws++;
            
            const { weights, totalWeight } = getCurrentWeights();
            const random = Math.random() * totalWeight;
            
            let currentWeight = 0;
            let selectedItem = null;
            
            for (const [name, weight] of Object.entries(weights)) {
                currentWeight += weight;
                if (random <= currentWeight) {
                    selectedItem = allItems.find(item => item.name === name);
                    break;
                }
            }
            
            // 如果是史诗物品，减少剩余数量
            if (selectedItem.category === "史诗" && state.epicRewardsRemaining[selectedItem.name] > 0) {
                state.epicRewardsRemaining[selectedItem.name]--;
                updateEpicRewardsTable();
            }
            
            updateProgressBar();
            return selectedItem.name;
        }

        // 批量抽奖
        function batchDraw(count, isUserDraw = true) {
            const results = {};
            
            for (let i = 0; i < count; i++) {
                const itemName = singleDraw();
                results[itemName] = (results[itemName] || 0) + 1;
                
                // 更新统计
                if (isUserDraw) {
                    state.userSingleStats[itemName] = (state.userSingleStats[itemName] || 0) + 1;
                    state.userTotalStats[itemName] = (state.userTotalStats[itemName] || 0) + 1;
                } else {
                    state.systemSingleStats[itemName] = (state.systemSingleStats[itemName] || 0) + 1;
                    state.systemTotalStats[itemName] = (state.systemTotalStats[itemName] || 0) + 1;
                }
            }
            
            updateAllStatsTables();
			
			for (let name in results) {
			  checkEpicPopup(name);   // 每条都判断，只有顶级史诗会弹
			}
			
            return results;
        }

        // 开始自动抽奖
        function startAutoDraw() {
            if (state.autoInterval) {
                clearInterval(state.autoInterval);
            }
			
			stopCountdown();          // 先清掉旧的
		    startCountdown(5);        // 立即开始 5 秒倒计时
            
            let drawCount = 0;
            switch (state.currentMode) {
                case 2: drawCount = 50; break;
                case 3: drawCount = 500; break;
                case 4: drawCount = 5000; break;
                default: return;
            }
        }

        // 切换模式
        function switchMode(newMode) {
          if (newMode === state.currentMode) return;
        
          const modal = document.getElementById('confirm-modal');
          modal.style.display = 'flex';
        
          document.getElementById('confirm-no').onclick = () => {
            modal.style.display = 'none';
          };
        
          document.getElementById('confirm-yes').onclick = () => {
            modal.style.display = 'none';
            state.currentMode = newMode;
            document.querySelectorAll('.mode-btn').forEach(btn =>
              btn.classList.toggle('active', btn.dataset.mode == newMode)
            );
        
            initializePage();
            state.autoStarted = false;
          };
        }

		
		function userDrawOnce(count) {
		  state.userSingleStats = initializeStats();
		
		  const results = batchDraw(count, true);
		  state.userDrawTotal += count;
		  state.userCost += calcCost(count);
		  updateUserStat();
		  for (let n in results) checkEpicPopup(n, true);
		  if (state.currentMode > 1 && !state.autoStarted) {
		    state.autoStarted = true;
		    startCountdown(5);
		  }
		}

		function checkEpicPopup(itemName, isUser) {
		  const topEpic = ['史诗宝珠*66', '当期权一史诗武将*1'];
		  if (!topEpic.includes(itemName) || !state.epicPopup) return;
		
		  const titleEl = document.getElementById('epic-title');
		  const contEl  = document.getElementById('epic-content');
		
		  if (isUser) {
		    titleEl.textContent = '恭喜获得！';
		    contEl.textContent  = `你获得了：${itemName}！`;
		  } else {
		    titleEl.textContent = '你被截胡了！';
		    contEl.textContent  = `系统抽走了：${itemName}！`;
		  }
		
		  document.getElementById('epic-popup').style.display = 'flex';
		}
		
		/* ========== 概率公示数据 ========== */
		const rateData = [
		  {name:'史诗体验卡*1',weight:1000,prob:'5.00%'},
		  {name:'欢乐豆*50',weight:1000,prob:'5.00%'},
		  {name:'菜篮子*2',weight:1355,prob:'6.78%'},
		  {name:'换将卡*2',weight:5000,prob:'25.00%'},
		  {name:'手气卡*2',weight:5000,prob:'25.00%'},
		  {name:'点将卡*2',weight:3000,prob:'15.00%'},
		  {name:'进阶丹*2',weight:1000,prob:'5.00%'},
		  {name:'雁翎甲*1',weight:1000,prob:'5.00%'},
		  {name:'招募令*1',weight:1000,prob:'5.00%'},
		  {name:'史诗宝珠碎片*1',weight:200,prob:'1.00%'},
		  {name:'菜篮子*99',weight:200,prob:'1.00%'},
		  {name:'当期精品武将*1',weight:100,prob:'0.50%'},
		  {name:'史诗宝珠*1',weight:100,prob:'0.50%'},
		  {name:'将魂*1000',weight:15,prob:'0.075%'},
		  {name:'当期传说皮肤动态包*1',weight:15,prob:'0.075%'},
		  {name:'当期权十史诗武将*1',weight:10,prob:'0.05%'},
		  {name:'当期权三史诗武将*1',weight:3,prob:'0.015%'},
		  {name:'史诗宝珠*66',weight:1,prob:'0.005%'},
		  {name:'当期权一史诗武将*1',weight:1,prob:'0.005%'}
		];
		
		/* ========== 渲染概率表 ========== */
		function renderRateTable() {
		  const tbody = document.getElementById('rate-table-body');
		  tbody.innerHTML = '';
		  rateData.forEach(r => {
		    const tr = document.createElement('tr');
		    tr.innerHTML = `
		      <td>${r.name}</td>
		      <td>${r.weight}</td>
		      <td>${r.prob}</td>
		    `;
		    tbody.appendChild(tr);
		  });
		}
		
		/* ========== 初始化时调用 ========== */
		document.addEventListener('DOMContentLoaded', renderRateTable);
		
		document.addEventListener('keydown', e => {
		  if (e.code === 'Enter' || e.code === 'Space') {
		    e.preventDefault();
		    userDrawOnce(50);
		  }
		});
		
		// 弹窗确定按钮
		document.getElementById('epic-ok').onclick = () => {
		  document.getElementById('epic-popup').style.display = 'none';
		};

        // 事件监听
        document.getElementById('draw-1').addEventListener('click',  () => userDrawOnce(1));
        document.getElementById('draw-10').addEventListener('click', () => userDrawOnce(10));
        document.getElementById('draw-50').addEventListener('click', () => userDrawOnce(50));
        
        document.getElementById('reset-btn').addEventListener('click', initializePage);
        
        document.querySelectorAll('.mode-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                switchMode(parseInt(this.dataset.mode));
            });
        });
		document.getElementById('popup-switch').addEventListener('change', e => {
		  state.epicPopup = e.target.checked;
		});


        // 初始化页面
        initializePage();
    </script>
</body>
</html>
